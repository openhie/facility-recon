webpackJsonp([1],{"2Jjk":function(e,t){},"7zck":function(e,t){},"8qoT":function(e,t){},"J/Fn":function(e,t){e.exports={BACKEND_HOST:".",BACKEND_PORT:"3000",BACKEND_PROTOCOL:"http"}},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("mvHQ"),s=r.n(a),o=r("7+uW"),i=r("BO1k"),n=r.n(i),c=r("Dd8w"),l=r.n(c),u=r("fZjL"),d=r.n(u),v=r("mtWM"),h=r.n(v),p={data:function(){return{roles:[]}},computed:{canAddDataset:function(){if(this.$store.state.config.generalConfig.reconciliation.singleDataSource){var e=0,t=!0,r=!1,a=void 0;try{for(var s,o=n()(this.$store.state.dataSources);!(t=(s=o.next()).done);t=!0){s.value._id!==this.$store.state.config.generalConfig.reconciliation.fixSource2To&&e++}}catch(e){r=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw a}}return!(e>=1)||(this.datasetLimitWarn=!0,!1)}return!0}},methods:{clearProgress:function(e){h.a.get("/clearProgress/"+e+"/"+this.$store.state.clientId)},getGeneralConfig:function(e){var t=this,r=s()(this.$store.state.config.generalConfig);h.a.get("/getGeneralConfig?defaultGenerConfig="+r).then(function(r){return r&&(t.$store.state.config.generalConfig=r.data),e()}).catch(function(){return e()})},toTitleCase:function(e){return e.toLowerCase().split(" ").map(function(e){return e.replace(e[0],e[0].toUpperCase())}).join("")},translateDataHeader:function(e,t){var r=this.$store.state.config.userConfig.reconciliation.useCSVHeader,a=this.$store.state.levelMapping;if(!r||r&&a[e]["level"+t]==="level"+t)return"Level "+t;if(d()(this.$store.state.levelMapping[e]).length>0){var s=this.$store.state.levelMapping[e],o=1;for(var i in s)0===i.indexOf("level")&&o++;var n=void 0;"source1"===e&&(n=this.$store.state.totalSource1Levels),"source2"===e&&(n=this.$store.state.totalSource2Levels),t+=o- --n;var c=this.$store.state.levelMapping[e]["level"+t];return c&&"null"!==c&&"undefined"!==c&&"false"!==c?c:this.$store.state.levelMapping[e].facility}return"Level "+t},getActiveDataSourcePair:function(){var e=this,t=void 0,r={};return this.$store.state.dataSourcePairs.forEach(function(a){a.userID._id===e.$store.state.auth.userID&&"active"===a.status&&(r=a),d()(r).length>0?t=void 0:a.userID._id!==e.$store.state.auth.userID&&-1!==a.shared.activeUsers.indexOf(e.$store.state.auth.userID)&&(t=a)}),t&&(r=t),r},getDatasourceOwner:function(){var e={source1Owner:"",source2Owner:""};return this.$store.state.activePair.source1.hasOwnProperty("userID")&&(e.source1Owner=this.$store.state.activePair.source1.userID),this.$store.state.activePair.source2.hasOwnProperty("userID")&&(e.source2Owner=this.$store.state.activePair.source2.userID),e},getLimitOrgIdOnActivePair:function(){var e=this,t={source1LimitOrgId:"",source2LimitOrgId:""},r=this.$store.state.dataSources.find(function(t){return t._id===e.$store.state.activePair.source1.id}),a=this.$store.state.dataSources.find(function(t){return t._id===e.$store.state.activePair.source2.id});if(r&&r.hasOwnProperty("userID")&&r.userID._id!==this.$store.state.auth.userID){var s=r.sharedLocation.find(function(t){return t.user===e.$store.state.auth.userID});s?t.source1LimitOrgId=s.location:r.shareToAll.activated&&r.shareToAll.limitByUserLocation&&(t.source1LimitOrgId=this.$store.state.dhis.user.orgId,t.source1LimitOrgId||(t.source1LimitOrgId="undefined"))}if(a&&a.hasOwnProperty("userID")&&a.userID._id!==this.$store.state.auth.userID){var o=a.sharedLocation.find(function(t){return t.user===e.$store.state.auth.userID});o?t.source2LimitOrgId=o.location:a.shareToAll.activated&&a.shareToAll.limitByUserLocation&&(t.source2LimitOrgId=this.$store.state.dhis.user.orgId,t.source2LimitOrgId||(t.source2LimitOrgId="undefined"))}return t},getLimitOrgIdOnDataSource:function(e){var t=this,r=void 0;if(e&&e.hasOwnProperty("userID")&&e.userID._id!==this.$store.state.auth.userID){var a=e.sharedLocation.find(function(e){return e.user===t.$store.state.auth.userID});a?r=a.location:e.shareToAll.activated&&e.shareToAll.limitByUserLocation&&((r=this.$store.state.dhis.user.orgId)||(r="undefined"))}return r},getRoles:function(){var e=this;h.a.get("/getRoles").then(function(t){var r=!0,a=!1,s=void 0;try{for(var o,i=n()(t.data);!(r=(o=i.next()).done);r=!0){var c=o.value;e.roles.push({text:c.name,value:c._id})}}catch(e){a=!0,s=e}finally{try{!r&&i.return&&i.return()}finally{if(a)throw s}}}).catch(function(e){console.log(e.response)})},saveConfiguration:function(e,t){var r=this,a=this.$store.state.auth.userID,o=new FormData;o.append("config",s()(this.$store.state.config)),o.append("userID",a);var i=void 0;i="generalConfig"===e?"/updateGeneralConfig":"/updateUserConfig",h.a.post(""+i,o,{headers:{"Content-Type":"multipart/form-data"}}).then(function(){"useCSVHeader"===t&&tt.$emit("changeCSVHeaderNames"),"authDisabled"===t&&r.$router.push({name:"Logout"})})},setDHIS2Credentials:function(){return this.$store.state.auth.token="",!(location.href.split("api").length<2)&&(this.$store.state.dhis.host=location.href.split("api").shift(),h.a.defaults.params={authDisabled:!0},!0)}}},g={mixins:[p],data:function(){return{scoreProgressTitle:"Waiting for progress status",scoreProgressPercent:null,progressType:"",scoreProgressTimer:!1,loadingSource2Unmatched:!1,loadingSource1Unmatched:!1,topTree:""}},methods:{checkScoreProgress:function(){var e=this,t=this.$store.state.clientId;h()({method:"get",url:"/progress/scoreResults/"+t}).then(function(t){if(!t.data||!(t.data.status||t.data.percent||t.data.error||0!==e.$store.state.scoreResults.length))return e.scoreDialog=!1,e.scoreProgressTitle="Waiting for progress status",e.$store.state.errorTitle="An error has occured",e.$store.state.errorDescription="An error has occured while reaching out to server, please click recalculate scores to restart automatch",e.$store.state.errorColor="error",void(e.$store.state.dialogError=!0);if(null===t.data.status&&null===t.data.percent&&null===t.data.error&&e.$store.state.scoreResults.length>0)return e.scoreDialog=!1,void(e.scoreProgressTitle="Waiting for progress status");if(e.scoreProgressTitle=t.data.status,t.data.percent&&("percent"!==e.progressType&&(e.progressType="percent"),e.scoreProgressPercent=t.data.percent),"Done"===t.data.status&&0===e.$store.state.scoreResults.length){e.clearProgress("scoreResults"),e.loadingSource1Unmatched=!1,e.loadingSource2Unmatched=!1;var r=t.data.responseData;e.$store.state.source2UnMatched=r.source2Unmatched,e.$store.state.source1UnMatched=[],e.$store.state.matchedContent=[],e.$store.state.noMatchContent=[],e.$store.state.ignoreContent=[],e.$store.state.flagged=[],e.$store.state.scoreResults=r.scoreResults,e.$store.state.source2TotalRecords=r.source2TotalRecords,e.$store.state.source2TotalAllRecords=r.source2TotalAllRecords,e.$store.state.totalAllMapped=r.totalAllMapped,e.$store.state.totalAllFlagged=r.totalAllFlagged,e.$store.state.totalAllNoMatch=r.totalAllNoMatch,e.$store.state.totalAllIgnore=r.totalAllIgnore,e.$store.state.source1TotalAllNotMapped=r.source1TotalAllNotMapped,e.$store.state.source1TotalAllRecords=r.source1TotalAllRecords;var a=!0,s=!1,o=void 0;try{for(var i,c=n()(e.$store.state.scoreResults);!(a=(i=c.next()).done);a=!0){var l=i.value;if(l.source1.hasOwnProperty("tag")&&"flagged"===l.source1.tag)e.$store.state.flagged.push({source1Name:l.source1.name,source1Id:l.source1.id,source1Parents:l.source1.parents,source2Name:l.exactMatch.name,source2Id:l.exactMatch.id,source2Parents:l.exactMatch.parents,flagComment:l.source1.flagComment});else if(l.source1.hasOwnProperty("tag")&&"noMatch"===l.source1.tag){var u=l.source1.parents;e.$store.state.noMatchContent.push({source1Name:l.source1.name,source1Id:l.source1.id,parents:u})}else if(l.source1.hasOwnProperty("tag")&&"ignore"===l.source1.tag){var v=l.source1.parents;e.$store.state.ignoreContent.push({source1Name:l.source1.name,source1Id:l.source1.id,parents:v})}else if(d()(l.exactMatch).length>0)e.$store.state.matchedContent.push({source1Name:l.source1.name,source1Id:l.source1.id,source1Parents:l.source1.parents,source2Name:l.exactMatch.name,source2Id:l.exactMatch.id,source2Parents:l.exactMatch.parents,matchComments:l.exactMatch.matchComments});else{for(var h=e.topTree,p=l.source1.parents.length-1;p>=0;p--)h[l.source1.parents[p]]||(h[l.source1.parents[p]]={}),h=h[l.source1.parents[p]];e.$store.state.source1UnMatched.push({name:l.source1.name,id:l.source1.id,parents:l.source1.parents})}}}catch(e){s=!0,o=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw o}}e.$store.state.source1Parents=e.topTree,e.scoreDialog=!1,e.scoreProgressTitle="Waiting for progress status"}else e.checkScoreProgress()}).catch(function(t){console.log("Error "+t),e.checkScoreProgress()})},getScores:function(){var e=this,t=this.getSource1(),r=this.getSource2(),a=this.getDatasourceOwner();if(this.$store.state.source1UnMatched=[],this.$store.state.source2UnMatched=[],this.$store.state.matchedContent=[],this.$store.state.noMatchContent=[],this.$store.state.ignoreContent=[],this.$store.state.flagged=[],this.$store.state.source1TotalAllRecords=0,this.$store.state.totalAllMapped=0,this.$store.state.totalAllFlagged=0,this.$store.state.totalAllNoMatch=0,this.$store.state.totalAllIgnore=0,this.$store.state.source2TotalRecords=0,this.$store.state.scoreResults=[],t&&r){this.loadingSource1Unmatched=!0,this.loadingSource2Unmatched=!0,this.scoreDialog=!0,this.scoreProgressTitle="Waiting for progress status",this.progressType="indeterminate";var o=this.$store.state.recoLevel,i=this.$store.state.totalSource1Levels,n=this.$store.state.totalSource2Levels,c=this.$store.state.clientId;this.topTree=this.$store.state.source1Parents.slice(0,this.$store.state.source1Parents.length),this.$store.state.levelArray=[];for(var l=1;l<this.$store.state.totalSource1Levels;l++){var u;l+1>this.$store.state.recoLevel||(u=this.translateDataHeader("source1",l),this.$store.state.levelArray.push({text:u,value:l+1}))}var d=this.$store.state.activePair.userID._id,v="source1="+t+"&source2="+r+"&source1Owner="+a.source1Owner+"&source2Owner="+a.source2Owner+"&source1LimitOrgId="+this.getLimitOrgIdOnActivePair().source1LimitOrgId+"&source2LimitOrgId="+this.getLimitOrgIdOnActivePair().source2LimitOrgId+"&totalSource1Levels="+i+"&totalSource2Levels="+n;v+="&recoLevel="+o+"&clientId="+c+"&userID="+d+"&parentConstraint="+s()(this.$store.state.config.generalConfig.reconciliation.parentConstraint),h.a.get("/reconcile/?"+v).then(function(){e.checkScoreProgress()})}},getSource2Unmached:function(){var e=this,t=this.getSource1(),r=this.getSource2(),a=this.$store.state.activePair.userID._id,s=this.getDatasourceOwner(),o=s.source1Owner,i=s.source2Owner,n=this.getLimitOrgIdOnActivePair().source1LimitOrgId,c=this.getLimitOrgIdOnActivePair().source2LimitOrgId;if(t&&r){var l=this.$store.state.recoLevel,u=this.$store.state.totalSource1Levels,d=this.$store.state.totalSource2Levels,v=l;l===u&&(v=d),h.a.get("/getUnmatched/"+t+"/"+r+"/"+o+"/"+i+"/"+v+"/"+a+"?source1LimitOrgId="+n+"&source2LimitOrgId="+c).then(function(t){e.loadingSource2Unmatched=!1,e.$store.state.source2UnMatched=t.data})}},getSource1:function(){var e=this.$store.state.activePair.source1.name;return e&&(e=this.toTitleCase(e)),e},getSource2:function(){var e=this.$store.state.activePair.source2.name;return e&&(e=this.toTitleCase(e)),e},getSource1Name:function(){return this.$store.state.activePair.source1.name},getSource2Name:function(){return this.$store.state.activePair.source2.name}},created:function(){var e=this;tt.$on("changeCSVHeaderNames",function(){e.$store.state.levelArray=[];for(var t=1;t<e.$store.state.totalSource1Levels;t++){var r;t+1>e.$store.state.recoLevel||(r=e.translateDataHeader("source1",t),e.$store.state.levelArray.push({text:r,value:t+1}))}}),this.scoreProgressTitle=this.$store.state.scoresProgressData.scoreProgressTitle,this.scoreProgressPercent=this.$store.state.scoresProgressData.scoreProgressPercent,this.$store.state.scoresProgressData.scoreDialog?this.scoreDialog=this.$store.state.scoresProgressData.scoreDialog:this.scoreDialog=!1,this.progressType=this.$store.state.scoresProgressData.progressType,this.scoreProgressTimer=this.$store.state.scoresProgressData.scoreProgressTimer,this.scoreDialog&&(this.scoreProgressTimer=setInterval(this.checkScoreProgress,1e3))},destroyed:function(){this.$store.state.scoresProgressData.scoreProgressTitle=this.scoreProgressTitle,this.$store.state.scoresProgressData.scoreProgressPercent=this.scoreProgressPercent,this.$store.state.scoresProgressData.scoreDialog=this.scoreDialog,this.$store.state.scoresProgressData.progressType=this.progressType,this.$store.state.scoresProgressData.scoreProgressTimer=this.scoreProgressTimer,clearInterval(this.scoreProgressTimer)}},f={methods:{createDatasourcePair:function(e,t){var r=this;if(0===d()(e).length||0===d()(t).length)return this.$store.state.dialogError=!0,this.$store.state.errorTitle="Info",void(this.$store.state.errorDescription="Please select data source");if(e.name===t.name&&e.source===t.source)return this.$store.state.dialogError=!0,this.$store.state.errorTitle="Error",void(this.$store.state.errorDescription="Data source pair of the same data source is not allowed, change one of the source");this.$store.state.dynamicProgress=!0,this.$store.state.progressTitle="Creating Data Source Pair";var a=null;this.$store.state.activePair.hasOwnProperty("shared")&&this.$store.state.activePair.shared.hasOwnProperty("activeUsers")&&-1!==this.$store.state.activePair.shared.activeUsers.indexOf(this.$store.state.auth.userID)&&(a=this.$store.state.activePair._id);var o=!1;this.$store.state.dhis.user.orgId&&this.$store.state.config.generalConfig.reconciliation.singlePair&&(o=!0),a||(a=!1);var i=new FormData;i.append("source1",s()(e)),i.append("source2",s()(t)),i.append("userID",this.$store.state.auth.userID),i.append("orgId",this.$store.state.dhis.user.orgId),i.append("singlePair",o),i.append("activePairID",a),h.a.post("/addDataSourcePair",i,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){r.$store.state.levelMapping.source1=JSON.parse(e.data).levelMapping1,r.$store.state.levelMapping.source2=JSON.parse(e.data).levelMapping2,tt.$emit("getDataSourcePair"),r.$store.state.dynamicProgress=!1}).catch(function(e){r.alertError=!0,r.$store.state.dialogError=!0,e.response.data.error?(r.$store.state.errorDescription=e.response.data.error,r.$store.state.errorTitle="Pair was not created",r.alertMsg=e.response.data.error):r.alertMsg="Something went wrong while saving data source pairs.",r.$store.state.dynamicProgress=!1,console.log(e)})},activateSharedPair:function(e){var t=this;this.$store.state.dynamicProgress=!0,this.$store.state.progressTitle="Activating Shared Data Source Pair";var r=new FormData;r.append("pairID",e),r.append("userID",this.$store.state.auth.userID),h.a.post("/activateSharedPair",r,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){tt.$emit("getDataSourcePair"),t.$store.state.dynamicProgress=!1}).catch(function(e){t.alertError=!0,t.alertMsg="Something went wrong while activating data source pair",t.$store.state.dynamicProgress=!1,console.log(e.response.data)})},activatePair:function(){var e=this;this.activeDataSourcePair.userID._id!==this.$store.state.auth.userID?this.activateSharedPair(this.activeDataSourcePair._id):(this.source1=this.$store.state.dataSources.find(function(t){return t._id===e.activeDataSourcePair.source1._id}),this.source2=this.$store.state.dataSources.find(function(t){return t._id===e.activeDataSourcePair.source2._id}),this.createDatasourcePair(this.source1,this.source2))}}},m=r("fzx2"),_=r("ppUw"),$=r.n(_),S={mixins:[f,g,p],props:["generalConfig"],data:function(){return{fixed:!1,title:this.$t("App.title"),locale:"en",locales:[{text:"English",value:"en"},{text:"French",value:"fr"}],activeDataSourcePair:{}}},watch:{locale:function(e){this.$i18n.locale=e}},methods:{closeDialogError:function(){this.$store.state.errorColor="primary",this.$store.state.dialogError=!1},renderInitialPage:function(){var e=this,t=this.$store.state.activePair.source1.name,r=this.$store.state.activePair.source2.name;if(t&&r||!(this.$store.state.dataSources.length>1||this.$store.state.dataSourcePairs.length>0))if(t&&r){t=this.toTitleCase(t),r=this.toTitleCase(r);var a=this.getDatasourceOwner();h.a.get("/uploadAvailable/"+t+"/"+r+"/"+a.source1Owner+"/"+a.source2Owner).then(function(t){e.$store.state.initializingApp=!1,t.data.dataUploaded?(e.$store.state.recalculateScores=!0,e.$router.push({name:"FacilityReconScores"})):e.$router.push({name:"AddDataSources"})}).catch(function(t){console.log(t),e.$router.push({name:"AddDataSources"})})}else this.$router.push({name:"AddDataSources"});else this.$router.push({name:"DataSourcesPair"})},getTotalLevels:function(){var e=this,t=this.$store.state.activePair.source1.name,r=this.$store.state.activePair.source2.name;if(!t||!r)return this.$store.state.totalSource1Levels=5,this.$store.state.totalSource2Levels=5,this.$store.state.initializingApp=!1,this.renderInitialPage(),this.$store.state.recoLevel=2,void this.getRecoStatus();t=this.toTitleCase(t),r=this.toTitleCase(r);var a=s()(this.getDatasourceOwner()),o=s()(this.getLimitOrgIdOnActivePair());h.a.get("/countLevels/"+t+"/"+r+"/"+a+"/"+o).then(function(t){e.$store.state.levelMapping.source1=t.data.levelMapping.levelMapping1,e.$store.state.levelMapping.source2=t.data.levelMapping.levelMapping2,e.$store.state.totalSource1Levels=t.data.totalSource1Levels,e.$store.state.totalSource2Levels=t.data.totalSource2Levels,e.$store.state.recoLevel=2,e.renderInitialPage(),e.getRecoStatus()}).catch(function(t){console.log(t),e.$store.state.recoLevel=2,e.renderInitialPage(),e.getRecoStatus()})},getRecoStatus:function(){var e=this;if(0!==d()(this.$store.state.activePair.source1).length&&0!==d()(this.$store.state.activePair.source2).length){var t=this.toTitleCase(this.$store.state.activePair.source1.name),r=this.toTitleCase(this.$store.state.activePair.source2.name),a=this.$store.state.activePair.userID._id;h.a.get("/recoStatus/"+t+"/"+r+"/"+a).then(function(s){s.data.status?e.$store.state.recoStatus=s.data.status:h.a.get("/markRecoUnDone/"+t+"/"+r+"/"+a).then(function(t){t.data.status&&(e.$store.state.recoStatus=t.data.status)}).catch(function(e){console.log(e.response.data.error)})}).catch(function(e){console.log(e.response.data.error)})}},getDataSources:function(){var e=this;this.$store.state.loadingServers=!0,this.$store.state.dataSources=[];var t=this.$store.state.auth.userID,r=this.$store.state.auth.role,a=this.$store.state.dhis.user.orgId;h.a.get("/getDataSources/"+t+"/"+r+"/"+a).then(function(t){e.$store.state.loadingServers=!1,e.$store.state.dataSources=t.data.servers,e.getDataSourcePair()}).catch(function(t){e.$store.state.loadingServers=!1,console.log(s()(t))})},getUserConfig:function(){var e=this,t=this.$store.state.auth.userID;h.a.get("/getUserConfig/"+t).then(function(t){t.data&&(e.$store.state.config.userConfig=l()({},e.$store.state.config.userConfig,t.data)),e.getGeneralConfig(function(){e.getDataSources()})}).catch(function(){e.getGeneralConfig(function(){e.getDataSources()})})},getDataSourcePair:function(){var e=this;this.$store.state.activePair.source1={},this.$store.state.activePair.source2={};var t=this.$store.state.auth.userID;h.a.get("/getDataSourcePair/"+t+"/"+this.$store.state.dhis.user.orgId).then(function(t){e.$store.state.dataSourcePairs=t.data;var r=e.getActiveDataSourcePair();d()(r).length>0&&(e.$store.state.activePair.source1.id=r.source1._id,e.$store.state.activePair.source1.name=r.source1.name,e.$store.state.activePair.source1.userID=r.source1.userID,e.$store.state.activePair.source2.id=r.source2._id,e.$store.state.activePair.source2.name=r.source2.name,e.$store.state.activePair.source2.userID=r.source2.userID,e.$store.state.activePair._id=r._id,e.$store.state.activePair.shared=r.shared,e.$store.state.activePair.userID=r.userID),e.autoActivateDatasourcePair(function(t){t||e.autoCreateDatasourcePair()}),e.getTotalLevels()}).catch(function(t){console.log(s()(t)),e.$store.state.dialogError=!0,e.$store.state.errorTitle="Error",e.$store.state.errorDescription="An error occured while getting data source pairs, reload the app to retry",e.getTotalLevels()})},autoCreateDatasourcePair:function(){if(this.$store.state.config.generalConfig.reconciliation.singleDataSource){if(d()(this.$store.state.activePair.source1).length>0)return!1;if(this.$store.state.dataSources.length>2)return!1;var e=this.$store.state.config.generalConfig.reconciliation.fixSource2To,t={},r={},a=!0,s=!1,o=void 0;try{for(var i,c=n()(this.$store.state.dataSources);!(a=(i=c.next()).done);a=!0){var l=i.value;l._id===e?r=l:t=l}}catch(e){s=!0,o=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw o}}if(0===d()(t).length||0===d()(r).length)return!1;this.createDatasourcePair(t,r)}},autoActivateDatasourcePair:function(e){if(d()(this.$store.state.activePair.source1).length>0){return e(!1)}if(this.$store.state.dataSourcePairs.length>1||0===this.$store.state.dataSourcePairs.length){return e(!1)}if(this.$store.state.dhis.user.orgId&&this.$store.state.config.generalConfig.reconciliation.singlePair){this.$store.state.dataSourcePairs.status="active",this.activeDataSourcePair=this.$store.state.dataSourcePairs[0];e(!0),this.activatePair()}}},computed:{dhisLink:function(){return!!this.$store.state.dhis.user.orgId&&window.location.protocol+"//"+window.location.hostname}},created:function(){var e=this;this.$router.push({name:"AddDataSources"}),this.$store.state.config.generalConfig=this.generalConfig,$.a.get("token")&&$.a.get("userID")&&(this.$store.state.auth.token=$.a.get("token"),this.$store.state.auth.userID=$.a.get("userID"),this.$store.state.auth.username=$.a.get("username"),this.$store.state.auth.role=$.a.get("role"),this.$store.state.signupFields=$.a.get("signupFields"),this.$store.state.customSignupFields=$.a.get("customSignupFields"),this.$store.state.config.generalConfig.authDisabled?this.$router.push("login"):h.a.get("/isTokenActive/").then(function(t){e.$store.state.clientId=m.a.v4(),e.$store.state.initializingApp=!0,e.$store.state.denyAccess=!1,e.getUserConfig()})),tt.$on("refreshApp",function(){e.getDataSources()}),tt.$on("recalculateScores",function(){e.$store.state.recalculateScores=!0,e.$router.push({name:"FacilityReconScores"})}),tt.$on("getDataSources",function(){e.getDataSources()}),tt.$on("getConfig",function(){e.getUserConfig()}),tt.$on("getGeneralConfig",function(){e.getGeneralConfig()}),tt.$on("getDataSourcePair",function(){e.getDataSourcePair()})},name:"App"},x={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-toolbar",{attrs:{color:"primary",dark:"",app:""}},[a("v-toolbar-title",{domProps:{textContent:e._s(e.title)}}),e._v(" "),a("v-spacer"),e._v(" "),e.$store.state.auth.token||e.$store.state.config.generalConfig.authDisabled?a("v-toolbar-items",[e.dhisLink?a("v-btn",{attrs:{flat:"",href:e.dhisLink}},[a("img",{attrs:{src:r("wxqd")}})]):e._e(),e._v(" "),e.$store.state.denyAccess?e._e():a("v-menu",{attrs:{"open-on-hover":"",bottom:"","offset-y":""}},[a("v-btn",{attrs:{slot:"activator",flat:""},slot:"activator"},[a("v-icon",[e._v("sync")]),e._v(e._s(e.$t("App.menu.dataSourcesParent.msg"))+"\n        ")],1),e._v(" "),a("v-list",[a("v-list-tile",{attrs:{to:"AddDataSources"}},[a("v-list-tile-title",[a("v-icon",[e._v("compare_arrows")]),e._v(e._s(e.$t("App.menu.addDataSources.msg"))+"\n            ")],1)],1),e._v(" "),a("v-list-tile",{attrs:{to:"ViewDataSources"}},[a("v-list-tile-title",[a("v-icon",[e._v("list")]),e._v(e._s(e.$t("App.menu.viewDataSources.msg"))+"\n            ")],1)],1)],1)],1),e._v(" "),a("v-tooltip",{attrs:{bottom:""}},[e.$store.state.denyAccess?e._e():a("v-btn",{attrs:{slot:"activator",to:"view",flat:"",disabled:0===Object.keys(e.$store.state.activePair.source1).length},slot:"activator"},[a("v-icon",[e._v("list")]),e._v(e._s(e.$t("App.menu.view.msg"))+"\n        ")],1),e._v(" "),a("span",[e._v(e._s(e.$t("App.menu.view.tooltip")))])],1),e._v(" "),e.$store.state.denyAccess?e._e():a("v-menu",{attrs:{"open-on-hover":"",bottom:"","offset-y":""}},[a("v-btn",{attrs:{slot:"activator",flat:""},slot:"activator"},[a("v-icon",[e._v("find_in_page")]),e._v(e._s(e.$t("App.menu.recoParent.msg"))+"\n        ")],1),e._v(" "),a("v-list",[a("v-tooltip",{attrs:{top:""}},[e.$store.state.dataSources.length>1||e.$store.state.dataSourcePairs.length>0?a("v-list-tile",{attrs:{slot:"activator",to:"dataSourcesPair"},slot:"activator"},[a("v-list-tile-title",[a("v-icon",[e._v("compare_arrows")]),e._v(e._s(e.$t("App.menu.createPair.msg"))+"\n              ")],1)],1):a("v-list-tile",{attrs:{slot:"activator",to:"dataSourcesPair",disabled:""},slot:"activator"},[a("v-list-tile-title",[a("v-icon",[e._v("compare_arrows")]),e._v(e._s(e.$t("App.menu.createPair.msg"))+"\n              ")],1)],1),e._v(" "),a("span",[e._v(e._s(e.$t("App.menu.createPair.tooltip")))])],1),e._v(" "),a("v-tooltip",{attrs:{top:""}},[0===Object.keys(e.$store.state.activePair.source1).length?a("v-list-tile",{attrs:{slot:"activator",to:"scores",disabled:""},slot:"activator"},[a("v-list-tile-title",[a("v-icon",[e._v("find_in_page")]),e._v(e._s(e.$t("App.menu.reconcile.msg"))+"\n              ")],1)],1):a("v-list-tile",{attrs:{slot:"activator",to:"scores"},slot:"activator"},[a("v-list-tile-title",[a("v-icon",[e._v("find_in_page")]),e._v(e._s(e.$t("App.menu.reconcile.msg"))+"\n              ")],1)],1),e._v(" "),a("span",[e._v(e._s(e.$t("App.menu.reconcile.tooltip")))])],1),e._v(" "),a("v-tooltip",{attrs:{bottom:""}},[0===Object.keys(e.$store.state.activePair.source1).length?a("v-list-tile",{attrs:{slot:"activator",to:"recoStatus",disabled:""},slot:"activator"},[a("v-list-tile-title",[a("v-icon",[e._v("dashboard")]),e._v(" "+e._s(e.$t("App.menu.recoStatus.msg"))+"\n              ")],1)],1):a("v-list-tile",{attrs:{slot:"activator",to:"recoStatus"},slot:"activator"},[a("v-list-tile-title",[a("v-icon",[e._v("dashboard")]),e._v(" "+e._s(e.$t("App.menu.recoStatus.msg"))+"\n              ")],1)],1),e._v(" "),a("span",[e._v(e._s(e.$t("App.menu.recoStatus.tooltip")))])],1),e._v(" "),a("v-tooltip",{attrs:{bottom:""}},[a("v-list-tile",{attrs:{slot:"activator",to:"dbAdmin"},slot:"activator"},[a("v-list-tile-title",[a("v-icon",[e._v("archive")]),e._v(" "+e._s(e.$t("App.menu.archive.msg"))+"\n              ")],1)],1),e._v(" "),a("span",[e._v(e._s(e.$t("App.menu.archive.tooltip")))])],1)],1)],1),e._v(" "),e.$store.state.denyAccess?e._e():a("v-menu",{attrs:{"open-on-hover":"",bottom:"","offset-y":""}},[a("v-btn",{attrs:{slot:"activator",flat:""},slot:"activator"},[a("v-icon",[e._v("perm_identity")]),e._v(e._s(e.$t("App.menu.account.msg"))+"\n        ")],1),e._v(" "),a("v-list",[a("v-tooltip",{attrs:{top:""}},["Admin"===e.$store.state.auth.role?a("v-list-tile",{attrs:{slot:"activator",to:"addUser"},slot:"activator"},[a("v-list-tile-title",[a("v-icon",[e._v("perm_identity")]),e._v(e._s(e.$t("App.menu.addUser.msg"))+"\n              ")],1)],1):e._e(),e._v(" "),a("span",[e._v(e._s(e.$t("App.menu.addUser.tooltip")))])],1),e._v(" "),a("v-tooltip",{attrs:{bottom:""}},["Admin"===e.$store.state.auth.role?a("v-list-tile",{attrs:{slot:"activator",to:"usersList"},slot:"activator"},[a("v-list-tile-title",[a("v-icon",[e._v("perm_identity")]),e._v(e._s(e.$t("App.menu.usersList.msg"))+"\n              ")],1)],1):e._e(),e._v(" "),a("span",[e._v(e._s(e.$t("App.menu.usersList.tooltip")))])],1),e._v(" "),a("v-list-tile",{attrs:{to:"changePassword"}},[a("v-list-tile-title",[a("v-icon",[e._v("perm_identity")]),e._v(e._s(e.$t("App.menu.changePassword.msg"))+"\n            ")],1)],1)],1)],1),e._v(" "),e.$store.state.denyAccess?e._e():a("v-btn",{attrs:{flat:"",to:"configure"}},[a("v-icon",[e._v("settings")]),e._v(" "+e._s(e.$t("App.menu.configure.msg"))+"\n      ")],1),e._v(" "),e.$store.state.denyAccess||e.$store.state.config.generalConfig.authDisabled?e._e():a("v-btn",{attrs:{flat:"",to:"logout"}},[a("v-icon",[e._v("logout")]),e._v(" "+e._s(e.$t("App.menu.logout.msg"))+"\n      ")],1)],1):e._e(),e._v(" "),a("v-spacer"),e._v(" "),a("v-toolbar-items")],1),e._v(" "),a("v-content",[a("v-dialog",{attrs:{persistent:"",width:"300"},model:{value:e.$store.state.dynamicProgress,callback:function(t){e.$set(e.$store.state,"dynamicProgress",t)},expression:"$store.state.dynamicProgress"}},[a("v-card",{attrs:{color:"primary",dark:""}},[a("v-card-text",[e._v("\n          "+e._s(e.$store.state.progressTitle)+"\n          "),a("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1),e._v(" "),a("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:e.$store.state.dialogError,callback:function(t){e.$set(e.$store.state,"dialogError",t)},expression:"$store.state.dialogError"}},[a("v-card",[a("v-toolbar",{attrs:{color:e.$store.state.errorColor,dark:""}},[a("v-toolbar-title",[e._v("\n            "+e._s(e.$store.state.errorTitle)+"\n          ")]),e._v(" "),a("v-spacer"),e._v(" "),a("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.$store.state.dialogError=!1}}},[a("v-icon",[e._v("close")])],1)],1),e._v(" "),a("v-card-text",[e._v("\n          "+e._s(e.$store.state.errorDescription)+"\n        ")]),e._v(" "),a("v-card-actions",[a("v-btn",{attrs:{color:"primary"},nativeOn:{click:function(t){return e.closeDialogError(t)}}},[e._v("Ok")])],1)],1)],1),e._v(" "),a("v-dialog",{attrs:{persistent:"",width:"300"},model:{value:e.$store.state.initializingApp,callback:function(t){e.$set(e.$store.state,"initializingApp",t)},expression:"$store.state.initializingApp"}},[a("v-card",{attrs:{color:"primary",dark:""}},[a("v-card-text",[e._v("\n          "+e._s(e.$t("App.initApp"))+"\n          "),a("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1),e._v(" "),a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs6:""}},[Object.keys(e.$store.state.activePair.source1).length>0&&!e.$store.state.denyAccess?[e._v("\n          "+e._s(e.$t("App.source"))+" 1: "),a("b",[e._v(e._s(e.$store.state.activePair.source1.name))]),e._v(",     "+e._s(e.$t("App.source"))+" 2: "),a("b",[e._v(e._s(e.$store.state.activePair.source2.name))]),e._v(",\n              Recon Status: "),"in-progress"===e.$store.state.recoStatus?a("v-icon",{attrs:{small:""}},[e._v("lock_open")]):a("v-icon",{attrs:{small:""}},[e._v("lock")]),e._v(" "),a("b",[e._v(e._s(e.$store.state.recoStatus))])]:e._e()],2),e._v(" "),a("v-spacer"),e._v(" "),a("v-flex",{attrs:{xs1:""}},[a("v-select",{attrs:{items:e.locales},model:{value:e.locale,callback:function(t){e.locale=t},expression:"locale"}})],1)],1),e._v(" "),a("router-view")],1),e._v(" "),a("v-footer",{attrs:{dark:"",color:"primary",fixed:e.fixed,app:""}})],1)},staticRenderFns:[]},y=r("VU/8")(S,x,!1,null,null,null).exports,b=r("/ocq"),w=r("+cKO"),D={validations:{username:{required:w.required},password:{required:w.required}},data:function(){return{username:"",password:"",authStatus:!1,signupEnabled:!1}},methods:{authenticate:function(){var e=this,t=new FormData;t.append("username",this.username),t.append("password",this.password),h.a.post("/authenticate/",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){e.$store.state.auth.token=t.data.token,e.$store.state.auth.username=e.username,e.$store.state.auth.userID=t.data.userID,e.$store.state.auth.role=t.data.role,$.a.config("30d"),$.a.set("token",e.$store.state.auth.token,"infinity"),$.a.set("userID",e.$store.state.auth.userID,"infinity"),$.a.set("role",e.$store.state.auth.role,"infinity"),$.a.set("username",e.$store.state.auth.username,"infinity"),e.$store.state.auth.role=t.data.role,t.data.token?(e.$store.state.clientId=m.a.v4(),e.$store.state.initializingApp=!0,e.$store.state.denyAccess=!1,tt.$emit("getConfig")):e.authStatus=!0}).catch(function(e){e.hasOwnProperty("response")&&console.log(e.response.data.error)})},displaySignup:function(){this.$router.push({name:"Signup"})}},computed:{usernameErrors:function(){var e=[];return this.$v.username.$dirty?(!this.$v.username.required&&e.push("Username is required"),e):e},passwordErrors:function(){var e=[];return this.$v.password.$dirty?(!this.$v.password.required&&e.push("Password is required"),e):e}},created:function(){var e=this;h.a.get("/getSignupConf").then(function(t){t.data&&(e.signupEnabled=!0,e.$store.state.signupFields=t.data.allSignupFields,e.$store.state.customSignupFields=t.data.customSignupFields,$.a.set("signupFields",t.data.allSignupFields,"infinity"),$.a.set("customSignupFields",t.data.customSignupFields,"infinity"))})},beforeCreate:function(){this.$store.state.config.generalConfig.authDisabled&&(this.$store.state.clientId=m.a.v4(),this.$store.state.initializingApp=!0,this.$store.state.denyAccess=!1,this.$router.push({name:"DHIS2Auth"}))}},P={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("center",[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs3:""}}),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-alert",{attrs:{type:"error",value:e.authStatus}},[e._v("\n          Authentication Failed\n        ")])],1)],1),e._v(" "),r("v-card",{attrs:{width:"430px",hover:""}},[r("v-card-title",{attrs:{"primary-title":""}},[r("v-toolbar",{staticStyle:{color:"white"},attrs:{color:"primary"}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs2:"","text-xs-left":""}},[r("v-icon",{attrs:{"x-large":"",color:"white"}},[e._v("lock")])],1),e._v(" "),r("v-flex",{attrs:{xs9:"","text-xs-right":""}},[r("b",[e._v("Login")])])],1)],1)],1),e._v(" "),r("v-card-text",[r("v-form",{ref:"form",staticClass:"pa-3 pt-4"},[r("v-text-field",{attrs:{required:"","error-messages":e.usernameErrors,box:"",color:"deep-purple",label:"Username"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.authenticate()},blur:function(t){return e.$v.username.$touch()},change:function(t){return e.$v.username.$touch()}},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e._v(" "),r("v-text-field",{attrs:{required:"","error-messages":e.passwordErrors,box:"",type:"password",color:"deep-purple",label:"Password"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.authenticate()},blur:function(t){return e.$v.password.$touch()},change:function(t){return e.$v.password.$touch()}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1)],1),e._v(" "),r("v-card-actions",[r("v-toolbar",[e.$store.state.config.generalConfig.selfRegistration?r("v-btn",{attrs:{color:"success"},on:{click:e.displaySignup}},[e._v("Signup")]):e._e(),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{staticClass:"white--text",attrs:{disabled:e.$v.$invalid,color:"success",depressed:""},on:{click:function(t){return e.authenticate()}}},[e._v("Login")])],1)],1)],1)],1)],1)},staticRenderFns:[]},C=r("VU/8")(D,P,!1,null,null,null).exports,k={validations:{username:{required:w.required},retype_password:{required:w.required},password:{required:w.required},firstname:{required:w.required},surname:{required:w.required}},data:function(){return{firstname:"",othername:"",surname:"",username:"",password:"",retype_password:"",customFields:[],alertFail:!1,alertSuccess:!1,alertMsg:""}},methods:{signup:function(){var e=this;this.password!==this.retype_password&&(this.$store.state.dialogError=!0,this.$store.state.errorTitle="Error",this.$store.state.errorDescription="Password mismatch"),this.$store.state.dynamicProgress=!0,this.$store.state.progressTitle="Creating Account";var t=new FormData;for(var r in t.append("firstName",this.firstname),t.append("otherName",this.othername),t.append("password",this.password),t.append("userName",this.username),t.append("surname",this.surname),this.customFields)t.append(r,this.customFields[r]);h.a.post("/addUser/",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(){var t=d()(e.$v.$params),r=!0,a=!1,s=void 0;try{for(var o,i=n()(t);!(r=(o=i.next()).done);r=!0){var c=o.value;e.$v[c].$reset()}}catch(e){a=!0,s=e}finally{try{!r&&i.return&&i.return()}finally{if(a)throw s}}e.$refs.form.reset(),e.$store.state.dynamicProgress=!1,e.alertSuccess=!0,e.alertMsg="Account created successfully"}).catch(function(t){e.$store.state.dynamicProgress=!1,e.alertFail=!0,e.alertMsg="This account was not added, try different username",console.log(t.response.data.error)})},displayLogin:function(){this.$router.push({name:"Login"})}},computed:{codeErrors:function(){var e=[];return this.$v.code.$dirty?(!this.$v.code.required&&e.push("Code is required"),e):e},firstnameErrors:function(){var e=[];return this.$v.firstname.$dirty?(!this.$v.firstname.required&&e.push("First Name is required"),e):e},surnameErrors:function(){var e=[];return this.$v.surname.$dirty?(!this.$v.surname.required&&e.push("Surname is required"),e):e},usernameErrors:function(){var e=[];return this.$v.username.$dirty?(!this.$v.username.required&&e.push("Username is required"),e):e},passwordErrors:function(){var e=[];return this.$v.password.$dirty?(!this.$v.password.required&&e.push("Password is required"),e):e},retype_passwordErrors:function(){var e=[];return this.$v.retype_password.$dirty?(!this.$v.retype_password.required&&e.push("Re-type Password"),e):e}},created:function(){this.$store.state.signupFields=$.a.get("signupFields"),this.$store.state.customSignupFields=$.a.get("customSignupFields")}},I={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"success",dismissible:"",transition:"scale-transition"},model:{value:e.alertSuccess,callback:function(t){e.alertSuccess=t},expression:"alertSuccess"}},[e._v("\n        "+e._s(e.alertMsg)+"\n      ")]),e._v(" "),r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"error",dismissible:"",transition:"scale-transition"},model:{value:e.alertFail,callback:function(t){e.alertFail=t},expression:"alertFail"}},[e._v("\n        "+e._s(e.alertMsg)+"\n      ")]),e._v(" "),r("v-card",{staticClass:"mx-auto",staticStyle:{"max-width":"500px"}},[r("v-system-bar",{attrs:{color:"deep-purple darken-4",dark:""}}),e._v(" "),r("v-toolbar",{attrs:{color:"deep-purple accent-4",cards:"",dark:"",flat:""}},[r("v-card-title",{staticClass:"title font-weight-regular"},[e._v("Create Account")])],1),e._v(" "),r("v-form",{ref:"form",staticClass:"pa-3 pt-4"},[r("v-text-field",{attrs:{required:"","error-messages":e.firstnameErrors,box:"",color:"deep-purple",label:"First Name"},on:{blur:function(t){return e.$v.firstname.$touch()},change:function(t){return e.$v.firstname.$touch()}},model:{value:e.firstname,callback:function(t){e.firstname=t},expression:"firstname"}}),e._v(" "),r("v-text-field",{attrs:{box:"",color:"deep-purple",label:"Middle Names"},model:{value:e.othername,callback:function(t){e.othername=t},expression:"othername"}}),e._v(" "),r("v-text-field",{attrs:{required:"","error-messages":e.surnameErrors,box:"",color:"deep-purple",label:"Surname"},on:{blur:function(t){return e.$v.surname.$touch()},change:function(t){return e.$v.surname.$touch()}},model:{value:e.surname,callback:function(t){e.surname=t},expression:"surname"}}),e._v(" "),r("v-text-field",{attrs:{required:"","error-messages":e.usernameErrors,box:"",color:"deep-purple",label:"Username"},on:{blur:function(t){return e.$v.username.$touch()},change:function(t){return e.$v.surname.$touch()}},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e._v(" "),e._l(e.$store.state.customSignupFields,function(t,a){return r("label",{key:a},[(t.required,r("v-text-field",{attrs:{required:"",box:"",color:"deep-purple",label:t.display},model:{value:e.customFields[a],callback:function(t){e.$set(e.customFields,a,t)},expression:"customFields[name]"}}))],1)}),e._v(" "),r("v-text-field",{attrs:{required:"","error-messages":e.passwordErrors,type:"password",box:"",color:"deep-purple",label:"Password"},on:{blur:function(t){return e.$v.password.$touch()},change:function(t){return e.$v.password.$touch()}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),r("v-text-field",{attrs:{required:"","error-messages":e.retype_passwordErrors,type:"password",box:"",color:"deep-purple",label:"Re-type Password"},on:{blur:function(t){return e.$v.retype_password.$touch()},change:function(t){return e.$v.retype_password.$touch()}},model:{value:e.retype_password,callback:function(t){e.retype_password=t},expression:"retype_password"}})],2),e._v(" "),r("v-divider"),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{flat:""},on:{click:function(t){return e.$refs.form.reset()}}},[r("v-icon",[e._v("clear")]),e._v("Clear\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{flat:""},on:{click:e.displayLogin}},[r("v-icon",[e._v("lock")]),e._v("Back To Login\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{staticClass:"white--text",attrs:{disabled:e.$v.$invalid,color:"deep-purple accent-4",depressed:""},on:{click:function(t){return e.signup()}}},[r("v-icon",{attrs:{left:""}},[e._v("how_to_reg")]),e._v("Add\n          ")],1)],1)],1)],1),e._v(" "),r("v-spacer")],1)],1)},staticRenderFns:[]},T=r("VU/8")(k,I,!1,null,null,null).exports,L=r("Gu7T"),A=r.n(L),N={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-dialog",{attrs:{persistent:"",width:"300"},model:{value:e.syncProgrIndeter,callback:function(t){e.syncProgrIndeter=t},expression:"syncProgrIndeter"}},[r("v-card",{attrs:{color:"primary",dark:""}},[r("v-card-text",[e._v("\n        "+e._s(e.syncStatus)+"\n        "),r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",width:"270"},model:{value:e.syncProgrPercent,callback:function(t){e.syncProgrPercent=t},expression:"syncProgrPercent"}},[r("v-card",{attrs:{color:"white",dark:""}},[r("v-card-text",[r("center",[r("font",{staticStyle:{color:"blue"}},[e._v(e._s(e.syncStatus))]),r("br"),e._v(" "),r("v-progress-circular",{attrs:{rotate:-90,size:100,width:15,value:e.syncPercent,color:"primary"}},[r("v-avatar",{attrs:{color:"indigo",size:"50px"}},[r("span",{staticClass:"white--text"},[r("b",[e._v(e._s(e.syncPercent)+"%")])])])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]},M={props:["syncType","serverName","userID","sourceOwner","mode"],data:function(){return{syncProgrIndeter:!1,syncStatus:"Waiting for sync status",syncPercent:null,syncProgrPercent:!1,syncProgressTimer:"",syncRunning:!1}},methods:{sync:function(){var e=this,t=this.mode;t||(t="full");var r=new FormData,a=this.$store.state.clientId;r.append("name",this.serverName),r.append("userID",this.userID),r.append("sourceOwner",this.sourceOwner),r.append("clientId",a),r.append("mode",t),this.syncRunning=!0,this.syncProgrIndeter=!0,h.a.post("/"+this.syncType+"/",r,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){e.syncProgressTimer=setInterval(e.checkSyncProgress,1e3)}).catch(function(t){e.$store.state.dialogError=!0,e.$store.state.errorTitle="Error",e.$store.state.errorDescription=t.response.data.error+". cross check host,user and password",clearInterval(e.syncProgressTimer),console.log(t.response.data.error)})},checkSyncProgress:function(){var e=this,t=this.$store.state.clientId,r=void 0;"dhisSync"===this.syncType?r="dhisSyncRequest":"fhirSync"===this.syncType&&(r="fhirSyncRequest"),h.a.get("/progress/"+r+"/"+t).then(function(t){return null===t.data||void 0===t.data||!1===t.data?(e.$store.state.uploadRunning=!1,e.syncProgrIndeter=!1,e.syncProgrPercent=!1,void clearInterval(e.syncProgressTimer)):null!==t.data.error?(e.$store.state.uploadRunning=!1,e.syncProgrIndeter=!1,e.syncProgrPercent=!1,e.$store.state.dialogError=!0,e.$store.state.errorTitle="Error",e.$store.state.errorDescription=t.data.error,clearInterval(e.syncProgressTimer),void console.log(t.data.error)):null===t.data.status?(e.$store.state.uploadRunning=!1,e.syncProgrIndeter=!1,e.syncProgrPercent=!1,void clearInterval(e.syncProgressTimer)):(e.syncStatus=t.data.status,t.data.percent&&(e.syncProgrPercent||(e.syncProgrIndeter=!1,e.syncProgrPercent=!0),e.syncPercent=t.data.percent),void("Done"===t.data.status&&(e.syncStatus="Waiting for sync status",clearInterval(e.syncProgressTimer),e.syncProgrPercent=!1,e.$store.state.uploadRunning=!1,tt.$emit("getDataSources"))))}).catch(function(t){e.$store.state.dialogError=!0,e.$store.state.errorTitle="Error",console.log(t.response.data.error+". cross check host,user and password"),e.$store.state.errorDescription=t.response.data.error+". cross check host,user and password",clearInterval(e.syncProgressTimer)})}},created:function(){tt.$on("runRemoteSync",this.sync)},beforeDestroy:function(){tt.$off("runRemoteSync",this.sync)},components:{appSyncProgress:r("VU/8")({props:["syncProgrIndeter","syncStatus","syncProgrPercent","syncPercent"]},N,!1,null,null,null).exports}},R={render:function(){var e=this.$createElement,t=this._self._c||e;return t("v-container",[t("app-syncProgress",{attrs:{syncProgrIndeter:this.syncProgrIndeter,syncStatus:this.syncStatus,syncProgrPercent:this.syncProgrPercent,syncPercent:this.syncPercent}})],1)},staticRenderFns:[]},O=r("VU/8")(M,R,!1,null,null,null).exports,U={mixins:[p],validations:{facility:{required:w.required},code:{required:w.required},uploadName:{required:w.required}},data:function(){return{autoDisableSingleDatasourceDialog:!1,selectDatasourceDialog:!1,fixSource2To:"",searchDatasource:"",dataSourceHeaders:[{sortable:!1},{text:"Source Name",align:"left",value:"name"},{text:"Owner",value:"owner",sortable:!1},{text:"Created Time",value:"createdTime"}],cronDataSourceHeaders:[{text:"Source Name",align:"left",value:"name"},{text:"Owner",value:"owner",sortable:!1},{text:"Created Time",value:"createdTime"},{text:"Enabled",value:"enabled"}],datasetsAutosyncState:{},useCSVHeader:!1,moreFields:!1,fieldLabel:"",fieldName:"",required:"No",requiredText:["Yes","No"],signupFields:[],notification_endpoint:"",notification_username:"",notification_password:"",dhis2Roles:[],loadingDhis2Roles:!1,datasetNameErrors:[],defineSuperuserRole:!1}},methods:{controlDatasetsCronjobs:function(e){var t=new FormData;t.append("id",e._id),t.append("enabled",this.datasetsAutosyncState[e._id]),h.a.post("/updateDatasetAutosync",t)},checkDatasetsAdditionWays:function(e){if(0===this.$store.state.config.generalConfig.datasetsAdditionWays.length){this.$store.state.errorTitle="Cant disable both ways",this.$store.state.errorDescription="There must be atleast one way of adding a dataset",this.$store.state.dialogError=!0;var t=void 0;"remote"===e?t="Remote Servers Sync":"upload"===e&&(t="CSV Upload"),this.$store.state.config.generalConfig.datasetsAdditionWays.push(t)}else this.saveConfiguration("generalConfig","datasetsAdditionWays")},autoDisableSingleDatasource:function(e){"ok"===e?(this.$store.state.config.generalConfig.reconciliation.singleDataSource=!1,this.saveConfiguration("generalConfig","fixSource2"),this.saveConfiguration("generalConfig","singleDataSource")):"cancel"===e&&(this.$store.state.config.generalConfig.reconciliation.fixSource2=!0),this.autoDisableSingleDatasourceDialog=!1},singleDatasource:function(){var e=this;this.$store.state.config.generalConfig.reconciliation.singleDataSource?this.$store.state.config.generalConfig.reconciliation.fixSource2To&&this.$store.state.config.generalConfig.reconciliation.fixSource2?this.saveConfiguration("generalConfig","singleDataSource"):(this.$store.state.dialogError=!0,this.$store.state.errorTitle="Error",this.$store.state.errorColor="error",this.$store.state.errorDescription="This feature can only be enabled if there is a defined datasource to serve as Source 2 for all reconciliation",setTimeout(function(){e.$store.state.config.generalConfig.reconciliation.singleDataSource=!1})):this.saveConfiguration("generalConfig","singleDataSource")},displayDatasourceDialog:function(){!0===this.$store.state.config.generalConfig.reconciliation.fixSource2?(this.fixSource2To=this.$store.state.config.generalConfig.reconciliation.fixSource2To,this.selectDatasourceDialog=!0,this.saveConfiguration("generalConfig","fixSource2")):this.$store.state.config.generalConfig.reconciliation.singleDataSource?this.autoDisableSingleDatasourceDialog=!0:this.saveConfiguration("generalConfig","fixSource2")},closeDatasourceDialog:function(){this.selectDatasourceDialog=!1,this.$store.state.config.generalConfig.reconciliation.fixSource2To||(this.$store.state.config.generalConfig.reconciliation.fixSource2=!1,this.saveConfiguration("generalConfig","fixSource2"))},savefixSource2To:function(){this.$store.state.config.generalConfig.reconciliation.fixSource2To=this.fixSource2To,this.saveConfiguration("generalConfig","fixSource2To"),this.selectDatasourceDialog=!1},disableGOFRAuth:function(){var e=this;if(this.$store.state.config.generalConfig.authDisabled){if(this.$store.state.config.generalConfig.authDisabled){if(!this.setDHIS2Credentials())return this.$store.state.dialogError=!0,this.$store.state.errorTitle="Error",this.$store.state.errorColor="error",this.$store.state.errorDescription="App doesnt appear to be running inside DHIS2, cant disable authentication",void setTimeout(function(){e.$store.state.config.generalConfig.authDisabled=!1});this.loadingDhis2Roles=!0,this.getDHIS2Roles(function(t){e.loadingDhis2Roles=!1,e.dhis2Roles=[].concat(A()(t.data.userRoles))}),this.defineSuperuserRole=!0}}else this.saveConfiguration("generalConfig","authDisabled")},recoProgressNotificationChanged:function(){this.$store.state.config.generalConfig.hasOwnProperty("recoProgressNotification")||(this.$store.state.config.generalConfig.recoProgressNotification={}),this.$store.state.config.generalConfig.recoProgressNotification.url=this.notification_endpoint,this.$store.state.config.generalConfig.recoProgressNotification.username=this.notification_username,this.$store.state.config.generalConfig.recoProgressNotification.password=this.notification_password,this.saveConfiguration("generalConfig")},addMoreFields:function(){var e=this;if(this.$store.state.progressTitle="Saving field",this.signupFields[0].children.find(function(t){return t.id===e.fieldName}))this.$store.state.dialogError=!0,this.$store.state.errorTitle="Error",this.$store.state.errorDescription="Field name must be unique";else{var t=new FormData,r=void 0;r="Yes"===this.required,t.append("fieldName",this.fieldName),t.append("fieldLabel",this.fieldLabel),t.append("fieldRequired",r),t.append("form","signup"),h.a.post("/addFormField",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(){e.$store.state.dynamicProgress=!1,e.$store.state.dialogError=!0,e.$store.state.errorTitle="Info",e.$store.state.errorDescription="Field added successfully",e.$store.state.signupFields[e.fieldName]={type:"String",display:e.fieldLabel},e.$store.state.customSignupFields[e.fieldName]={type:"String",display:e.fieldLabel},$.a.set("signupFields",e.$store.state.signupFields,"infinity"),$.a.set("customSignupFields",e.$store.state.customSignupFields,"infinity"),e.signupFields[0].children.push({id:e.fieldName,name:e.fieldLabel}),e.fieldName="",e.fieldLabel="",e.required="No"})}},pullOrgUnits:function(){this.saveConfiguration("generalConfig","externalAuth");var e=new FormData;e.append("host",this.$store.state.dhis.host),e.append("sourceType","DHIS2"),e.append("source","syncServer"),e.append("shareToAll",this.$store.state.config.generalConfig.externalAuth.shareOrgUnits),e.append("limitByUserLocation",this.$store.state.config.generalConfig.externalAuth.shareByOrgId),e.append("username",this.$store.state.config.generalConfig.externalAuth.userName),e.append("password",this.$store.state.config.generalConfig.externalAuth.password),e.append("name",this.$store.state.config.generalConfig.externalAuth.datasetName),e.append("userID",this.$store.state.auth.userID),h.a.post("/addDataSource",e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){tt.$emit("runRemoteSync")})},getDHIS2Roles:function(e){var t=this.$store.state.dhis.dev.auth;""===t.username&&(t=""),h.a.get(this.$store.state.dhis.host+"api/userRoles",{auth:t}).then(function(t){e(t)})},ensureNameUnique:function(){if(this.datasetNameErrors=[],""===this.$store.state.config.generalConfig.externalAuth.datasetName)return this.datasetNameErrors.push("Dataset name is required");var e=!0,t=!1,r=void 0;try{for(var a,s=n()(this.$store.state.dataSources);!(e=(a=s.next()).done);e=!0){if(a.value.name===this.uploadName)return this.datasetNameErrors.push("This Name Exists"),!1}}catch(e){t=!0,r=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw r}}}},created:function(){var e=this;for(var t in this.$store.state.config.generalConfig.authDisabled&&"dhis2"===this.$store.state.config.generalConfig.authMethod&&(this.loadingDhis2Roles=!0,this.getDHIS2Roles(function(t){e.loadingDhis2Roles=!1,e.dhis2Roles=[].concat(A()(t.data.userRoles))})),this.signupFields.push({id:"signupFields",name:"Self Registration Fields",children:[]}),this.$store.state.signupFields)this.signupFields[0].children.push({id:t,name:t});this.$store.state.config.generalConfig.hasOwnProperty("recoProgressNotification")&&(this.notification_endpoint=this.$store.state.config.generalConfig.recoProgressNotification.url,this.notification_username=this.$store.state.config.generalConfig.recoProgressNotification.username,this.notification_password=this.$store.state.config.generalConfig.recoProgressNotification.password)},computed:{fixedSource2To:function(){var e="",t=!0,r=!1,a=void 0;try{for(var s,o=n()(this.$store.state.dataSources);!(t=(s=o.next()).done);t=!0){var i=s.value;i._id===this.$store.state.config.generalConfig.reconciliation.fixSource2To&&(e=i)}}catch(e){r=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw a}}return e.name},sharedToAllDatasets:function(){var e=[],t=!0,r=!1,a=void 0;try{for(var s,o=n()(this.$store.state.dataSources);!(t=(s=o.next()).done);t=!0){var i=s.value;i.shareToAll.activated,e.push(i)}}catch(e){r=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw a}}return e},remoteDatasets:function(){var e=[],t=!0,r=!1,a=void 0;try{for(var s,o=n()(this.$store.state.dataSources);!(t=(s=o.next()).done);t=!0){var i=s.value;"syncServer"===i.source&&(i.enableAutosync?this.datasetsAutosyncState[i._id]=!0:this.datasetsAutosyncState[i._id]=!1,e.push(i))}}catch(e){r=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw a}}return e}},beforeCreate:function(){if(this.$store.state.config.generalConfig.hasOwnProperty("authMethod")||this.$set(this.$store.state.config.generalConfig,"authMethod","dhis2"),!this.$store.state.config.generalConfig.hasOwnProperty("externalAuth")){this.$set(this.$store.state.config.generalConfig,"externalAuth",{pullOrgUnits:!0,shareOrgUnits:!1,shareByOrgId:!1,datasetName:"",adminRole:""})}},components:{appRemoteSync:O}},F={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:e.autoDisableSingleDatasourceDialog,callback:function(t){e.autoDisableSingleDatasourceDialog=t},expression:"autoDisableSingleDatasourceDialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"error",dark:""}},[r("v-toolbar-title",[e._v("\n          Disabling Single Data Source Limit\n        ")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){return e.autoDisableSingleDatasource("cancel")}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[e._v("\n        Disabling limiting reconciliation to be done against one choosen data source will also disable the single data source limit, click OK to proceed\n      ")]),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"primary"},nativeOn:{click:function(t){return e.autoDisableSingleDatasource("cancel")}}},[e._v("Cancel")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"error"},nativeOn:{click:function(t){return e.autoDisableSingleDatasource("ok")}}},[e._v("Ok")])],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",width:"620px"},model:{value:e.defineSuperuserRole,callback:function(t){e.defineSuperuserRole=t},expression:"defineSuperuserRole"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n          DHIS2 superuser role that can be an administrator of GOFR\n        ")])],1),e._v(" "),r("v-card-text",[r("v-select",{attrs:{label:"Superuser Role Name","item-text":"displayName","item-value":"id",loading:e.loadingDhis2Roles,required:"",items:e.dhis2Roles},on:{change:function(t){return e.saveConfiguration("generalConfig","externalAuth")}},model:{value:e.$store.state.config.generalConfig.externalAuth.adminRole,callback:function(t){e.$set(e.$store.state.config.generalConfig.externalAuth,"adminRole",t)},expression:"$store.state.config.generalConfig.externalAuth.adminRole"}})],1),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"success",disabled:!e.$store.state.config.generalConfig.externalAuth.adminRole||0===e.dhis2Roles.length},on:{click:function(t){return e.saveConfiguration("generalConfig","authDisabled")}}},[r("v-icon",{attrs:{left:""}},[e._v("save")]),e._v("\n          Save\n        ")],1)],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",width:"800px"},model:{value:e.selectDatasourceDialog,callback:function(t){e.selectDatasourceDialog=t},expression:"selectDatasourceDialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n          Select datasource to fix source 2\n        ")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchDatasource,callback:function(t){e.searchDatasource=t},expression:"searchDatasource"}}),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){return e.closeDatasourceDialog(t)}}},[r("v-icon",[e._v("close")])],1)],1),e._v("\n      This lists only those datasets that have been shared to all users\n      "),r("v-card-text",[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.dataSourceHeaders,items:e.sharedToAllDatasets,dark:"",search:e.searchDatasource},scopedSlots:e._u([{key:"items",fn:function(t){return[r("v-radio-group",{staticStyle:{height:"5px"},model:{value:e.fixSource2To,callback:function(t){e.fixSource2To=t},expression:"fixSource2To"}},[r("td",[r("v-radio",{attrs:{value:t.item._id,color:"blue"}})],1)]),e._v(" "),r("td",[e._v(e._s(t.item.name))]),e._v(" "),r("td",[e._v(e._s(t.item.userID.userName))]),e._v(" "),r("td",[e._v("\n              "+e._s(t.item.createdTime)+"\n            ")])]}}])},[r("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"})],1)],1),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"error"},on:{click:e.closeDatasourceDialog}},[r("v-icon",{attrs:{left:""}},[e._v("cancel")]),e._v("\n          Cancel\n        ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"success",disabled:!e.fixSource2To||0===e.sharedToAllDatasets.length},on:{click:e.savefixSource2To}},[r("v-icon",{attrs:{left:""}},[e._v("save")]),e._v("\n          Save\n        ")],1)],1)],1)],1),e._v(" "),r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[r("b",[e._v("System Configurations")])]),e._v(" "),r("v-card-text",[r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[e._v("\n          User Configurations\n        ")]),e._v(" "),r("v-card-text",[r("v-layout",{attrs:{column:""}},[r("v-flex",[r("v-switch",{attrs:{color:"primary",label:"Apply user defined headers when reconciling"},on:{change:function(t){return e.saveConfiguration("userConfig","useCSVHeader")}},model:{value:e.$store.state.config.userConfig.reconciliation.useCSVHeader,callback:function(t){e.$set(e.$store.state.config.userConfig.reconciliation,"useCSVHeader",t)},expression:"$store.state.config.userConfig.reconciliation.useCSVHeader"}})],1)],1)],1)],1),e._v(" "),r("v-divider"),e._v(" "),r("v-divider"),e._v(" "),r("v-divider"),e._v(" "),"Admin"==e.$store.state.auth.role?r("v-card",[r("v-card-title",[e._v("\n          Admin Configurations\n        ")]),e._v(" "),r("v-card-text",[r("v-layout",{attrs:{column:""}},[r("v-flex",[r("v-switch",{attrs:{color:"primary",label:"Perform match based on parent constraint"},on:{change:function(t){return e.saveConfiguration("generalConfig","parentConstraint")}},model:{value:e.$store.state.config.generalConfig.reconciliation.parentConstraint.enabled,callback:function(t){e.$set(e.$store.state.config.generalConfig.reconciliation.parentConstraint,"enabled",t)},expression:"$store.state.config.generalConfig.reconciliation.parentConstraint.enabled"}}),e._v(" "),e.$store.state.config.generalConfig.reconciliation.parentConstraint.enabled?e._e():r("v-card",{staticStyle:{"margin-left":"100px"},attrs:{color:"grey lighten-3"}},[r("v-checkbox",{attrs:{color:"success",label:"Automatch By ID",disabled:""},on:{change:function(t){return e.saveConfiguration("generalConfig","parConstrIdAuto")}},model:{value:e.$store.state.config.generalConfig.reconciliation.parentConstraint.idAutoMatch,callback:function(t){e.$set(e.$store.state.config.generalConfig.reconciliation.parentConstraint,"idAutoMatch",t)},expression:"$store.state.config.generalConfig.reconciliation.parentConstraint.idAutoMatch"}}),e._v(" "),r("v-checkbox",{attrs:{color:"success",label:"Automatch By Name (when parents differ)"},on:{change:function(t){return e.saveConfiguration("generalConfig","parConstrNameAuto")}},model:{value:e.$store.state.config.generalConfig.reconciliation.parentConstraint.nameAutoMatch,callback:function(t){e.$set(e.$store.state.config.generalConfig.reconciliation.parentConstraint,"nameAutoMatch",t)},expression:"$store.state.config.generalConfig.reconciliation.parentConstraint.nameAutoMatch"}})],1),e._v(" "),r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[e._v("\n                  Choose ways datasets can be added\n                ")]),e._v(" "),r("v-card-text",[r("v-checkbox",{attrs:{label:"CSV Upload",value:"CSV Upload"},on:{change:function(t){return e.checkDatasetsAdditionWays("upload")}},model:{value:e.$store.state.config.generalConfig.datasetsAdditionWays,callback:function(t){e.$set(e.$store.state.config.generalConfig,"datasetsAdditionWays",t)},expression:"$store.state.config.generalConfig.datasetsAdditionWays"}}),e._v(" "),r("v-checkbox",{attrs:{label:"Remote Servers Sync",value:"Remote Servers Sync"},on:{change:function(t){return e.checkDatasetsAdditionWays("remote")}},model:{value:e.$store.state.config.generalConfig.datasetsAdditionWays,callback:function(t){e.$set(e.$store.state.config.generalConfig,"datasetsAdditionWays",t)},expression:"$store.state.config.generalConfig.datasetsAdditionWays"}})],1)],1),e._v(" "),r("v-tooltip",{attrs:{top:""}},[r("v-switch",{attrs:{slot:"activator",color:"primary",label:"Select a data source to serve as Source 2 for all reconciliation"},on:{change:e.displayDatasourceDialog},slot:"activator",model:{value:e.$store.state.config.generalConfig.reconciliation.fixSource2,callback:function(t){e.$set(e.$store.state.config.generalConfig.reconciliation,"fixSource2",t)},expression:"$store.state.config.generalConfig.reconciliation.fixSource2"}}),e._v(" "),r("span",[e._v("This will limit users to perform reconciliations against the chosen data source")])],1),e._v(" "),e.$store.state.config.generalConfig.reconciliation.fixSource2?[e._v("\n                Source2 Limited To: "),r("v-chip",[e._v(e._s(e.fixedSource2To))]),e._v(" "),r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",fab:"",dark:"",color:"primary",small:""},on:{click:e.displayDatasourceDialog},slot:"activator"},[r("v-icon",{attrs:{dark:""}},[e._v("list")])],1),e._v(" "),r("span",[e._v("Change dataset")])],1)]:e._e(),e._v(" "),r("v-switch",{attrs:{color:"primary",label:"Single data source per user"},on:{change:e.singleDatasource},model:{value:e.$store.state.config.generalConfig.reconciliation.singleDataSource,callback:function(t){e.$set(e.$store.state.config.generalConfig.reconciliation,"singleDataSource",t)},expression:"$store.state.config.generalConfig.reconciliation.singleDataSource"}}),e._v(" "),e.$store.state.dhis.user.orgId?r("v-switch",{attrs:{color:"primary",label:"Single data source pair per org unit"},on:{change:function(t){return e.saveConfiguration("generalConfig","singlePair")}},model:{value:e.$store.state.config.generalConfig.reconciliation.singlePair,callback:function(t){e.$set(e.$store.state.config.generalConfig.reconciliation,"singlePair",t)},expression:"$store.state.config.generalConfig.reconciliation.singlePair"}}):e._e()],2),e._v(" "),r("v-flex",[r("v-card",[r("v-card-text",[r("v-switch",{attrs:{color:"primary",label:"Disable Authentication"},on:{change:e.disableGOFRAuth},model:{value:e.$store.state.config.generalConfig.authDisabled,callback:function(t){e.$set(e.$store.state.config.generalConfig,"authDisabled",t)},expression:"$store.state.config.generalConfig.authDisabled"}}),e._v(" "),e.$store.state.config.generalConfig.authDisabled?r("v-card",{staticStyle:{"margin-left":"100px"},attrs:{color:"grey lighten-3"}},[e._v("\n                    External Authentication Method\n                    "),r("v-radio-group",{on:{change:function(t){return e.saveConfiguration("generalConfig","useDhis2Auth")}},model:{value:e.$store.state.config.generalConfig.authMethod,callback:function(t){e.$set(e.$store.state.config.generalConfig,"authMethod",t)},expression:"$store.state.config.generalConfig.authMethod"}},[r("v-radio",{attrs:{label:"dhis2",value:"dhis2",disabled:""}}),e._v(" "),r("v-radio",{attrs:{label:"iHRIS",value:"iHRIS",disabled:""}})],1),e._v(" "),r("v-select",{staticStyle:{width:"350px"},attrs:{label:"Superuser Role Name","item-text":"displayName","item-value":"id",loading:e.loadingDhis2Roles,required:"",items:e.dhis2Roles},on:{change:function(t){return e.saveConfiguration("generalConfig","externalAuth")}},model:{value:e.$store.state.config.generalConfig.externalAuth.adminRole,callback:function(t){e.$set(e.$store.state.config.generalConfig.externalAuth,"adminRole",t)},expression:"$store.state.config.generalConfig.externalAuth.adminRole"}}),e._v(" "),e.$store.state.config.generalConfig.authMethod?r("v-checkbox",{attrs:{label:"Pull org units"},on:{change:function(t){return e.saveConfiguration("generalConfig","externalAuth")}},model:{value:e.$store.state.config.generalConfig.externalAuth.pullOrgUnits,callback:function(t){e.$set(e.$store.state.config.generalConfig.externalAuth,"pullOrgUnits",t)},expression:"$store.state.config.generalConfig.externalAuth.pullOrgUnits"}}):e._e(),e._v(" "),e.$store.state.config.generalConfig.externalAuth.pullOrgUnits?r("v-checkbox",{attrs:{label:"Share orgs with other users"},on:{change:function(t){return e.saveConfiguration("generalConfig","externalAuth")}},model:{value:e.$store.state.config.generalConfig.externalAuth.shareOrgUnits,callback:function(t){e.$set(e.$store.state.config.generalConfig.externalAuth,"shareOrgUnits",t)},expression:"$store.state.config.generalConfig.externalAuth.shareOrgUnits"}}):e._e(),e._v(" "),e.$store.state.config.generalConfig.externalAuth.shareOrgUnits&&e.$store.state.config.generalConfig.externalAuth.pullOrgUnits?r("v-checkbox",{attrs:{label:"Limit orgs sharing by user orgid"},on:{change:function(t){return e.saveConfiguration("generalConfig","externalAuth")}},model:{value:e.$store.state.config.generalConfig.externalAuth.shareByOrgId,callback:function(t){e.$set(e.$store.state.config.generalConfig.externalAuth,"shareByOrgId",t)},expression:"$store.state.config.generalConfig.externalAuth.shareByOrgId"}}):e._e(),e._v(" "),e.$store.state.config.generalConfig.externalAuth.pullOrgUnits?r("v-text-field",{staticStyle:{width:"350px"},attrs:{outline:"",label:"Dataset Name","error-messages":e.datasetNameErrors,required:""},on:{blur:e.ensureNameUnique,input:e.ensureNameUnique},model:{value:e.$store.state.config.generalConfig.externalAuth.datasetName,callback:function(t){e.$set(e.$store.state.config.generalConfig.externalAuth,"datasetName",t)},expression:"$store.state.config.generalConfig.externalAuth.datasetName"}}):e._e(),e._v(" "),e.$store.state.config.generalConfig.externalAuth.pullOrgUnits?r("v-text-field",{staticStyle:{width:"350px"},attrs:{outline:"",label:"Username",required:""},model:{value:e.$store.state.config.generalConfig.externalAuth.userName,callback:function(t){e.$set(e.$store.state.config.generalConfig.externalAuth,"userName",t)},expression:"$store.state.config.generalConfig.externalAuth.userName"}}):e._e(),e._v(" "),e.$store.state.config.generalConfig.externalAuth.pullOrgUnits?r("v-text-field",{staticStyle:{width:"350px"},attrs:{outline:"",label:"Password",type:"password",required:""},model:{value:e.$store.state.config.generalConfig.externalAuth.password,callback:function(t){e.$set(e.$store.state.config.generalConfig.externalAuth,"password",t)},expression:"$store.state.config.generalConfig.externalAuth.password"}}):e._e(),e._v(" "),r("v-flex",{attrs:{xs3:""}},[e.$store.state.config.generalConfig.externalAuth.pullOrgUnits?r("v-btn",{attrs:{color:"primary",disabled:e.datasetNameErrors.length>0||!e.$store.state.config.generalConfig.externalAuth.datasetName,small:"",round:""},on:{click:e.pullOrgUnits}},[e._v("start pulling")]):e._e()],1)],1):e._e()],1)],1)],1),e._v(" "),r("v-flex",[r("v-switch",{attrs:{color:"primary",label:"Enable self registration"},on:{change:function(t){return e.saveConfiguration("generalConfig","selfRegistration")}},model:{value:e.$store.state.config.generalConfig.selfRegistration,callback:function(t){e.$set(e.$store.state.config.generalConfig,"selfRegistration",t)},expression:"$store.state.config.generalConfig.selfRegistration"}}),e._v(" "),e.$store.state.config.generalConfig.selfRegistration?r("v-layout",{attrs:{row:"",wrap:""}},[r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs3:""}},[r("v-treeview",{attrs:{items:e.signupFields}})],1),e._v(" "),r("v-flex",{attrs:{xs8:""}},[r("v-btn",{attrs:{small:"",round:"",color:"success"},on:{click:function(t){e.moreFields=!e.moreFields}}},[e._v("Add More Fields")]),e._v(" "),e.moreFields?r("v-text-field",{attrs:{label:"Field Label"},model:{value:e.fieldLabel,callback:function(t){e.fieldLabel=t},expression:"fieldLabel"}}):e._e(),e._v(" "),e.moreFields?r("v-text-field",{attrs:{label:"Unique Name"},model:{value:e.fieldName,callback:function(t){e.fieldName=t},expression:"fieldName"}}):e._e(),e._v(" "),e.moreFields?r("v-select",{attrs:{items:e.requiredText,label:"Required"},model:{value:e.required,callback:function(t){e.required=t},expression:"required"}}):e._e(),e._v(" "),e.moreFields?r("v-btn",{attrs:{color:"info",small:""},on:{click:e.addMoreFields}},[e._v("Save")]):e._e()],1)],1):e._e()],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[e._v("\n                  Cron Jobs\n                ")]),e._v(" "),r("v-card-text",[e._v("\n                  Autosync Below Remote Datasets\n                  "),r("v-text-field",{staticStyle:{width:"350px"},attrs:{outline:"",name:"cron_time",label:"Cron Time"},on:{blur:function(t){return e.saveConfiguration("generalConfig","datasetsAutosyncTime")}},model:{value:e.$store.state.config.generalConfig.datasetsAutosyncTime,callback:function(t){e.$set(e.$store.state.config.generalConfig,"datasetsAutosyncTime",t)},expression:"$store.state.config.generalConfig.datasetsAutosyncTime"}}),e._v(" "),r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.cronDataSourceHeaders,items:e.remoteDatasets,"hide-actions":"","pagination.sync":"pagination"},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.name))]),e._v(" "),r("td",[e._v(e._s(t.item.userID.userName))]),e._v(" "),r("td",[e._v("\n                        "+e._s(t.item.createdTime)+"\n                      ")]),e._v(" "),r("td",[r("v-switch",{attrs:{color:"primary"},on:{change:function(r){return e.controlDatasetsCronjobs(t.item)}},model:{value:e.datasetsAutosyncState[t.item._id],callback:function(r){e.$set(e.datasetsAutosyncState,t.item._id,r)},expression:"datasetsAutosyncState[props.item._id]"}})],1)]}}],null,!1,1143142968)})],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-switch",{attrs:{color:"primary",label:"Enable Endpoint Notification when reconciliation is done"},on:{change:function(t){return e.saveConfiguration("generalConfig","recoProgressNotification")}},model:{value:e.$store.state.config.generalConfig.recoProgressNotification.enabled,callback:function(t){e.$set(e.$store.state.config.generalConfig.recoProgressNotification,"enabled",t)},expression:"$store.state.config.generalConfig.recoProgressNotification.enabled"}}),e._v(" "),e.$store.state.config.generalConfig.recoProgressNotification.enabled?r("v-card",{staticStyle:{"margin-left":"100px"},attrs:{color:"grey lighten-3"}},[r("v-card-text",[e._v("\n                  End point to send notification when reconciliation is done\n                ")]),e._v(" "),r("v-card-actions",[r("v-layout",{attrs:{column:""}},[r("v-flex",[r("v-text-field",{attrs:{label:"End point URL",box:""},model:{value:e.notification_endpoint,callback:function(t){e.notification_endpoint=t},expression:"notification_endpoint"}})],1),e._v(" "),r("v-flex",[r("v-text-field",{attrs:{label:"End point Username",box:""},model:{value:e.notification_username,callback:function(t){e.notification_username=t},expression:"notification_username"}})],1),e._v(" "),r("v-flex",[r("v-text-field",{attrs:{label:"End point Password",box:""},model:{value:e.notification_password,callback:function(t){e.notification_password=t},expression:"notification_password"}})],1),e._v(" "),r("v-flex",[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-btn",{attrs:{color:"success"},on:{click:e.recoProgressNotificationChanged}},[r("v-icon",[e._v("save")]),e._v("Save\n                          ")],1)],1)],1)],1)],1)],1)],1):e._e()],1)],1)],1)],1):e._e()],1)],1),e._v(" "),r("appRemoteSync",{attrs:{syncType:"dhisSync",serverName:e.$store.state.config.generalConfig.externalAuth.datasetName,userID:e.$store.state.auth.userID,sourceOwner:e.$store.state.auth.userID,mode:"full"}})],1)},staticRenderFns:[]},E=r("VU/8")(U,F,!1,null,null,null).exports,q={mounted:function(){this.$store.state.auth.token="",$.a.remove("token"),$.a.remove("userID"),$.a.remove("role"),$.a.remove("username"),this.$router.push("login")}},H={render:function(){var e=this.$createElement;return(this._self._c||e)("div")},staticRenderFns:[]},V=r("VU/8")(q,H,!1,null,null,null).exports,G={data:function(){return{usersHeader:[{text:"Firstname",value:"firstName"},{text:"Surname",value:"surname"},{text:"Othername",value:"otherName"},{text:"User Name",value:"username"},{text:"Role",value:"role"},{text:"Status",value:"status"}],users:[],loadingUsers:!1,searchUsers:"",alertSuccess:!1,alertFail:!1,alertMsg:""}},methods:{getUsers:function(){var e=this,t=new FormData;t.append("username",this.username),t.append("password",this.password),this.loadingUsers=!0,h.a.get("/getUsers/").then(function(t){e.loadingUsers=!1,e.users=t.data}).catch(function(t){e.loadingUsers=!1,t.hasOwnProperty("response")&&console.log(t.response.data.error)})},accountAction:function(e,t){var r=this,a=t._id,o=new FormData;o.append("id",a),"Active"===e||"Inactive"===e?(o.append("status",e),h.a.post("/changeAccountStatus",o,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){r.alertSuccess=!0,"Active"===e?r.alertMsg="Account activated successfully":"Inactive"===e&&(r.alertMsg="Account deactivated successfully"),r.getUsers()}).catch(function(e){console.log(s()(e)),r.alertFail=!0,r.alertMsg="Action failed"})):"reset"===e&&(o.append("surname",t.surname),h.a.post("/resetPassword",o,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){r.alertSuccess=!0,r.alertMsg="Password reseted successfully",r.getUsers()}).catch(function(e){console.log(s()(e)),r.alertFail=!0,r.alertMsg="Action failed"}))}},created:function(){this.getUsers()}},W={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"success",dismissible:"",transition:"scale-transition"},model:{value:e.alertSuccess,callback:function(t){e.alertSuccess=t},expression:"alertSuccess"}},[e._v("\n    "+e._s(e.alertMsg)+"\n  ")]),e._v(" "),r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"error",dismissible:"",transition:"scale-transition"},model:{value:e.alertFail,callback:function(t){e.alertFail=t},expression:"alertFail"}},[e._v("\n    "+e._s(e.alertMsg)+"\n  ")]),e._v(" "),r("v-card",{attrs:{color:"cyan lighten-5"}},[r("v-card-title",{attrs:{"primary-title":""}},[r("v-toolbar",{staticStyle:{"font-weight":"bold","font-size":"18px"},attrs:{color:"white"}},[e._v("\n        Users List\n        "),r("v-spacer"),e._v(" "),r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchUsers,callback:function(t){e.searchUsers=t},expression:"searchUsers"}})],1)],1),e._v(" "),r("v-card-text",[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.usersHeader,items:e.users,search:e.searchUsers,dark:"",loading:e.$store.state.loadingusers},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.firstName))]),e._v(" "),r("td",[e._v(e._s(t.item.surname))]),e._v(" "),r("td",[e._v(e._s(t.item.otherName))]),e._v(" "),r("td",[e._v(e._s(t.item.userName))]),e._v(" "),r("td",[e._v(e._s(t.item.role.name))]),e._v(" "),r("td",[e._v(e._s(t.item.status))]),e._v(" "),r("td",["Active"===t.item.status?r("v-btn",{attrs:{small:"",color:"error"},on:{click:function(r){return e.accountAction("Inactive",t.item)}}},[e._v("Deactivate")]):r("v-btn",{attrs:{small:"",color:"success"},on:{click:function(r){return e.accountAction("Active",t.item)}}},[e._v("Activate")]),e._v(" "),r("v-btn",{attrs:{small:"",color:"error"},on:{click:function(r){return e.accountAction("reset",t.item)}}},[r("v-icon",{attrs:{left:""}},[e._v("refresh")]),e._v(" Reset Password")],1)],1)]}}])},[r("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"})],1)],1)],1)],1)},staticRenderFns:[]},B=r("VU/8")(G,W,!1,null,null,null).exports,z={mixins:[p],validations:{userName:{required:w.required},retype_password:{required:w.required},password:{required:w.required},role:{required:w.required},firstName:{required:w.required},surname:{required:w.required}},data:function(){return{firstName:"",otherName:"",surname:"",userName:"",password:"",retype_password:"",role:"",customFields:[],alertFail:!1,alertSuccess:!1,alertMsg:""}},methods:{addUser:function(){var e=this;if(this.password!==this.retype_password)return this.$store.state.dialogError=!0,this.$store.state.errorTitle="Error",void(this.$store.state.errorDescription="Password mismatch");this.$store.state.dynamicProgress=!0,this.$store.state.progressTitle="Saving User";var t=new FormData;for(var r in t.append("firstName",this.firstName),t.append("otherName",this.otherName),t.append("password",this.password),t.append("userName",this.userName),t.append("surname",this.surname),t.append("role",this.role),this.customFields)t.append(r,this.customFields[r]);h.a.post("/addUser/",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(){var t=d()(e.$v.$params),r=!0,a=!1,s=void 0;try{for(var o,i=n()(t);!(r=(o=i.next()).done);r=!0){var c=o.value;e.$v[c].$reset()}}catch(e){a=!0,s=e}finally{try{!r&&i.return&&i.return()}finally{if(a)throw s}}e.$refs.form.reset(),e.$store.state.dynamicProgress=!1,e.alertSuccess=!0,e.alertMsg="User added successfully"}).catch(function(t){e.$store.state.dynamicProgress=!1,e.alertFail=!0,e.alertMsg="This user was not added, ensure userName is not used",console.log(t.response.data.error)})}},computed:{codeErrors:function(){var e=[];return this.$v.code.$dirty?(!this.$v.code.required&&e.push("Code is required"),e):e},firstnameErrors:function(){var e=[];return this.$v.firstName.$dirty?(!this.$v.firstName.required&&e.push("First Name is required"),e):e},surnameErrors:function(){var e=[];return this.$v.surname.$dirty?(!this.$v.surname.required&&e.push("Surname is required"),e):e},usernameErrors:function(){var e=[];return this.$v.userName.$dirty?(!this.$v.userName.required&&e.push("Username is required"),e):e},passwordErrors:function(){var e=[];return this.$v.password.$dirty?(!this.$v.password.required&&e.push("Password is required"),e):e},retype_passwordErrors:function(){var e=[];return this.$v.retype_password.$dirty?(!this.$v.retype_password.required&&e.push("Re-type Password"),e):e},roleErrors:function(){var e=[];return this.$v.role.$dirty?(!this.$v.role.required&&e.push("Role is required"),e):e}},created:function(){this.getRoles()}},j={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"success",dismissible:"",transition:"scale-transition"},model:{value:e.alertSuccess,callback:function(t){e.alertSuccess=t},expression:"alertSuccess"}},[e._v("\n        "+e._s(e.alertMsg)+"\n      ")]),e._v(" "),r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"error",dismissible:"",transition:"scale-transition"},model:{value:e.alertFail,callback:function(t){e.alertFail=t},expression:"alertFail"}},[e._v("\n        "+e._s(e.alertMsg)+"\n      ")]),e._v(" "),r("v-card",{staticClass:"mx-auto",staticStyle:{"max-width":"500px"}},[r("v-system-bar",{attrs:{color:"deep-purple darken-4",dark:""}}),e._v(" "),r("v-toolbar",{attrs:{color:"deep-purple accent-4",cards:"",dark:"",flat:""}},[r("v-card-title",{staticClass:"title font-weight-regular"},[e._v("Add New User")])],1),e._v(" "),r("v-form",{ref:"form",staticClass:"pa-3 pt-4"},[r("v-text-field",{attrs:{required:"","error-messages":e.firstnameErrors,box:"",color:"deep-purple",label:"First Name"},on:{blur:function(t){return e.$v.firstName.$touch()},change:function(t){return e.$v.firstName.$touch()}},model:{value:e.firstName,callback:function(t){e.firstName=t},expression:"firstName"}}),e._v(" "),r("v-text-field",{attrs:{box:"",color:"deep-purple",label:"Middle Names"},model:{value:e.otherName,callback:function(t){e.otherName=t},expression:"otherName"}}),e._v(" "),r("v-text-field",{attrs:{required:"","error-messages":e.surnameErrors,box:"",color:"deep-purple",label:"Surname"},on:{blur:function(t){return e.$v.surname.$touch()},change:function(t){return e.$v.surname.$touch()}},model:{value:e.surname,callback:function(t){e.surname=t},expression:"surname"}}),e._v(" "),r("v-text-field",{attrs:{required:"","error-messages":e.usernameErrors,box:"",color:"deep-purple",label:"Username"},on:{blur:function(t){return e.$v.userName.$touch()},change:function(t){return e.$v.surname.$touch()}},model:{value:e.userName,callback:function(t){e.userName=t},expression:"userName"}}),e._v(" "),e._l(e.$store.state.customSignupFields,function(t,a){return r("label",{key:a},[(t.required,r("v-text-field",{attrs:{required:"",box:"",color:"deep-purple",label:t.display},model:{value:e.customFields[a],callback:function(t){e.$set(e.customFields,a,t)},expression:"customFields[name]"}}))],1)}),e._v(" "),r("v-text-field",{attrs:{required:"","error-messages":e.passwordErrors,type:"password",box:"",color:"deep-purple",label:"Password"},on:{blur:function(t){return e.$v.password.$touch()},change:function(t){return e.$v.password.$touch()}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),r("v-text-field",{attrs:{required:"","error-messages":e.retype_passwordErrors,type:"password",box:"",color:"deep-purple",label:"Re-type Password"},on:{blur:function(t){return e.$v.retype_password.$touch()},change:function(t){return e.$v.retype_password.$touch()}},model:{value:e.retype_password,callback:function(t){e.retype_password=t},expression:"retype_password"}}),e._v(" "),r("v-select",{attrs:{required:"",items:e.roles,"single-line":"",clearable:"","error-messages":e.roleErrors,box:"",label:"Role"},on:{blur:function(t){return e.$v.role.$touch()},change:function(t){return e.$v.role.$touch()}},model:{value:e.role,callback:function(t){e.role=t},expression:"role"}})],2),e._v(" "),r("v-divider"),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{flat:""},on:{click:function(t){return e.$refs.form.reset()}}},[r("v-icon",[e._v("clear")]),e._v("Clear\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{staticClass:"white--text",attrs:{disabled:e.$v.$invalid,color:"deep-purple accent-4",depressed:""},on:{click:function(t){return e.addUser()}}},[r("v-icon",{attrs:{left:""}},[e._v("how_to_reg")]),e._v("Add")],1)],1)],1)],1),e._v(" "),r("v-spacer")],1)],1)},staticRenderFns:[]},Y=r("VU/8")(z,j,!1,null,null,null).exports,K={validations:{retype_password:{required:w.required},password:{required:w.required},oldPassword:{required:w.required}},data:function(){return{oldPassword:"",password:"",retype_password:"",alertFail:!1,alertSuccess:!1,alertMsg:""}},methods:{changePassword:function(){var e=this;if(this.password!==this.retype_password)return this.$store.state.dialogError=!0,this.$store.state.errorTitle="Error",void(this.$store.state.errorDescription="Password mismatch");this.$store.state.dynamicProgress=!0,this.$store.state.progressTitle="Changing Password";var t=new FormData;t.append("password",this.password),t.append("id",this.$store.state.auth.userID),h.a.post("/changePassword/",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(){var t=d()(e.$v.$params),r=!0,a=!1,s=void 0;try{for(var o,i=n()(t);!(r=(o=i.next()).done);r=!0){var c=o.value;e.$v[c].$reset()}}catch(e){a=!0,s=e}finally{try{!r&&i.return&&i.return()}finally{if(a)throw s}}e.$refs.form.reset(),e.$store.state.dynamicProgress=!1,e.alertSuccess=!0,e.alertMsg="Password changed successfully"}).catch(function(t){e.$store.state.dynamicProgress=!1,e.alertFail=!0,e.alertMsg="Password change failed",console.log(t.response.data.error)})},verifyPassword:function(){var e=this,t=new FormData;t.append("username",this.$store.state.auth.username),t.append("password",this.oldPassword),h.a.post("/authenticate/",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){t.data.token?e.changePassword():(e.alertFail=!0,e.alertMsg="Wrong Old Password")}).catch(function(e){console.log(s()(e))})}},computed:{oldPasswordErrors:function(){var e=[];return this.$v.oldPassword.$dirty?(!this.$v.oldPassword.required&&e.push("Old Password is required"),e):e},passwordErrors:function(){var e=[];return this.$v.password.$dirty?(!this.$v.password.required&&e.push("Password is required"),e):e},retype_passwordErrors:function(){var e=[];return this.$v.retype_password.$dirty?(!this.$v.retype_password.required&&e.push("Re-type Password"),e):e}}},J={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"success",dismissible:"",transition:"scale-transition"},model:{value:e.alertSuccess,callback:function(t){e.alertSuccess=t},expression:"alertSuccess"}},[e._v("\n        "+e._s(e.alertMsg)+"\n      ")]),e._v(" "),r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"error",dismissible:"",transition:"scale-transition"},model:{value:e.alertFail,callback:function(t){e.alertFail=t},expression:"alertFail"}},[e._v("\n        "+e._s(e.alertMsg)+"\n      ")]),e._v(" "),r("v-card",{staticClass:"mx-auto",staticStyle:{"max-width":"500px"}},[r("v-system-bar",{attrs:{color:"deep-purple darken-4",dark:""}}),e._v(" "),r("v-toolbar",{attrs:{color:"deep-purple accent-4",cards:"",dark:"",flat:""}},[r("v-card-title",{staticClass:"title font-weight-regular"},[e._v("Change Password")])],1),e._v(" "),r("v-form",{ref:"form",staticClass:"pa-3 pt-4"},[r("v-text-field",{attrs:{required:"","error-messages":e.oldPasswordErrors,type:"password",box:"",color:"deep-purple",label:"Old Password"},on:{blur:function(t){return e.$v.oldPassword.$touch()},change:function(t){return e.$v.oldPassword.$touch()}},model:{value:e.oldPassword,callback:function(t){e.oldPassword=t},expression:"oldPassword"}}),e._v(" "),r("v-text-field",{attrs:{required:"","error-messages":e.passwordErrors,type:"password",box:"",color:"deep-purple",label:"Password"},on:{blur:function(t){return e.$v.password.$touch()},change:function(t){return e.$v.password.$touch()}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),r("v-text-field",{attrs:{required:"","error-messages":e.retype_passwordErrors,type:"password",box:"",color:"deep-purple",label:"Re-type Password"},on:{blur:function(t){return e.$v.retype_password.$touch()},change:function(t){return e.$v.retype_password.$touch()}},model:{value:e.retype_password,callback:function(t){e.retype_password=t},expression:"retype_password"}})],1),e._v(" "),r("v-divider"),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{flat:""},on:{click:function(t){return e.$refs.form.reset()}}},[r("v-icon",[e._v("clear")]),e._v("Clear\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{staticClass:"white--text",attrs:{disabled:e.$v.$invalid,color:"deep-purple accent-4",depressed:""},on:{click:function(t){return e.verifyPassword()}}},[r("v-icon",{attrs:{left:""}},[e._v("how_to_reg")]),e._v("Change")],1)],1)],1)],1),e._v(" "),r("v-spacer")],1)],1)},staticRenderFns:[]},X=r("VU/8")(K,J,!1,null,null,null).exports,Z=r("woOf"),Q=r.n(Z),ee=r("ZIfW"),te={validations:{editLocationName:{required:w.required}},mixins:[g,p],data:function(){return{confirmDelete:!1,deleteLocationData:"",deleteSource:{name:"",value:""},editDialog:!1,editLocationName:"",editLocationId:"",editParents:[],editLocationParent:"",editSource:"",helpDialog:!1,lastLevel:[],headerText:{level2:"Level 1",level3:"Level 2",level4:"Level 3",level5:"Level 4",level6:"Level 5",level7:"Level 6",level8:"Level 7",level9:"Level 8",level10:"Level 9",facility:"Facility",latitude:"Latitude",longitude:"Longitude"},headers:[{text:"Level 1",value:"level1"},{text:"Level 2",value:"level2"},{text:"Level 3",value:"level3"},{text:"Level 4",value:"level4"},{text:"Facility",value:"facility"},{text:"Latitude",value:"latitude"},{text:"Longitude",value:"longitude"}],searchSource1:"",searchSource2:"",filterSource1:{text:"",level:""},filterSource2:{text:"",level:""},source2Pagination:{rowsPerPage:20},source1Pagination:{rowsPerPage:20},loadingSource1:!1,loadingSource2:!1,totalSource1Records:0,totalSource2Records:0,source2Grid:[],source1Grid:[],source1Tree:[],source2Tree:[],source1Start:1,source2Start:1,source1Count:10,source2Count:10,loadingSource1Tree:!1,loadingSource2Tree:!1,loadingSource1Grid:!1,loadingSource2Grid:!1,currentSource2Pagination:{},currentSource1Pagination:{},source1SelNodeId:!1,source2SelNodeId:!1,sourceOwner:""}},methods:{edit:function(e,t){var r=this.getDatasourceOwner();"source1"===t?(this.sourceOwner=r.source1Owner,this.editSource=this.source1):"source2"===t&&(this.sourceOwner=r.source1Owner,this.editSource=this.source2),this.editLocationName=e.facility,this.editLocationId=e.id,this.editDialog=!0;var a=d()(this.source2GridHeader).length,s=this.source2GridHeader[a-1].value;this.editLocationParent=e[s+"id"];var o=s.replace("level","");this.getLevelData(o)},saveEdit:function(){var e=this,t=new FormData;t.append("sourceOwner",this.sourceOwner),t.append("source",this.editSource),t.append("locationId",this.editLocationId),t.append("locationName",this.editLocationName),t.append("locationParent",this.editLocationParent),h.a.post("/editLocation",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){e.editDialog=!1,e.getSource1Grid(!1),e.getSource2Grid(!1),e.getTree()}).catch(function(e){console.log(s()(e))})},deleteLocation:function(e,t,r){var a=this;if("requestConfirmation"===r){var s=this.getDatasourceOwner();"source1"===t?(this.sourceOwner=s.source1Owner,this.deleteSource={name:"source1",value:this.source1}):"source2"===t&&(this.sourceOwner=s.source2Owner,this.deleteSource={name:"source2",value:this.source2}),this.deleteLocationData=e,this.confirmDelete=!0}else{this.confirmDelete=!1;var o=this.$store.state.activePair.userID._id,i="id="+this.deleteLocationData.id+"&source="+this.deleteSource.value+"&userID="+o+"&sourceOwner="+this.sourceOwner;h.a.delete("/deleteLocation?"+i).then(function(e){"source1"===a.deleteSource.name?a.getSource1Grid(!1):a.getSource2Grid(!1)})}},getLevelData:function(e){var t=this;h.a.get("/getLevelData/"+this.editSource+"/"+this.sourceOwner+"/"+e).then(function(e){t.editParents=e.data})},getSource1Grid:function(e){var t=this;if(this.source1){this.loadingSource1=!0,e||(e=""),this.loadingSource1Grid=!0;var r=this.getDatasourceOwner().source1Owner,a=this.getLimitOrgIdOnActivePair().source1LimitOrgId,s=this.$store.state.activePair.userID._id,o="/hierarchy?source="+this.source1+"&start="+this.source1Start+"&count="+this.source1Count+"&id="+e+"&userID="+s+"&sourceOwner="+r+"&sourceLimitOrgId="+a;h.a.get(""+o).then(function(e){if(t.loadingSource1Grid=!1,e.data){var r=t.source1Pagination,a=r.sortBy,s=r.descending;t.source1Pagination.sortBy&&(e.data.tree=e.data.grid.sort(function(e,t){var r=e[a],o=t[a];return s?r<o?1:r>o?-1:0:r<o?-1:r>o?1:0})),t.source1Grid=e.data.grid,t.totalSource1Records=e.data.total,t.source1Pagination.totalItems=e.data.total,t.currentSource1Pagination=Q()({},t.source1Pagination),t.currentSource1Pagination.hasOwnProperty("descending")||(t.currentSource1Pagination.descending=!1),t.currentSource1Pagination.hasOwnProperty("page")||(t.currentSource1Pagination.page=1),t.currentSource1Pagination.hasOwnProperty("sortBy")||(t.currentSource1Pagination.sortBy="facility"),t.currentSource1Pagination.hasOwnProperty("totalItems")||(t.currentSource1Pagination.totalItems=e.data.total)}t.loadingSource1=!1})}},getSource2Grid:function(e){var t=this;if(this.source2){e||(e=""),this.loadingSource2=!0,this.loadingSource2Grid=!0;var r=this.getDatasourceOwner().source2Owner,a=this.getLimitOrgIdOnActivePair().source2LimitOrgId,s=this.$store.state.activePair.userID._id,o="/hierarchy?source="+this.source2+"&start="+this.source2Start+"&count="+this.source2Count+"&id="+e+"&userID="+s+"&sourceOwner="+r+"&sourceLimitOrgId="+a;h.a.get(""+o).then(function(e){if(t.loadingSource2Grid=!1,e.data){var r=t.source2Pagination,a=r.sortBy,s=r.descending;t.source2Pagination.sortBy&&(e.data.tree=e.data.grid.sort(function(e,t){var r=e[a],o=t[a];return s?r<o?1:r>o?-1:0:r<o?-1:r>o?1:0})),t.source2Grid=e.data.grid,t.totalSource2Records=e.data.total,t.source2Pagination.totalItems=e.data.total,t.currentSource2Pagination=Q()({},t.source2Pagination),t.currentSource2Pagination.hasOwnProperty("descending")||(t.currentSource2Pagination.descending=!1),t.currentSource2Pagination.hasOwnProperty("page")||(t.currentSource2Pagination.page=1),t.currentSource2Pagination.hasOwnProperty("sortBy")||(t.currentSource2Pagination.sortBy="facility"),t.currentSource2Pagination.hasOwnProperty("totalItems")||(t.currentSource2Pagination.totalItems=e.data.total)}t.loadingSource2=!1})}},getTree:function(){var e=this;if(this.source1&&this.source2){var t=this.getDatasourceOwner().source2Owner,r=this.getLimitOrgIdOnActivePair().source2LimitOrgId;this.loadingSource2Tree=!0,h.a.get("/getTree/"+this.source2+"/"+t+"/"+r).then(function(t){e.loadingSource2Tree=!1,t.data&&(e.source2Tree=t.data)});var a=this.getDatasourceOwner().source1Owner,s=this.getLimitOrgIdOnActivePair().source1LimitOrgId;this.loadingSource1Tree=!0,h.a.get("/getTree/"+this.source1+"/"+a+"/"+s).then(function(t){e.loadingSource1Tree=!1,t.data&&(e.source1Tree=t.data)})}},source1NodeSelected:function(e){this.source1SelNodeId=e.id,this.getSource1Grid(e.id)},source2NodeSelected:function(e){this.source2SelNodeId=e.id,this.getSource2Grid(e.id)}},computed:{isDataset1Owner:function(){return this.getDatasourceOwner().source1Owner===this.$store.state.auth.userID},isDataset2Owner:function(){return this.getDatasourceOwner().source2Owner===this.$store.state.auth.userID},source2GridHeader:function(){var e=[];this.isDataset2Owner&&e.push({text:"",value:"",sortable:!1});var t={};if(this.source2Grid&&this.source2Grid.length>0)for(var r in this.source2Grid)t.length>0&&this.source2Grid[r].length>d()(t).length?t=this.source2Grid[r]:0===d()(t).length&&(t=this.source2Grid[r]);for(var a in t)this.headerText[a]&&e.push({text:this.headerText[a],value:a});return e},source1GridHeader:function(){var e=[];this.isDataset1Owner&&e.push({text:"",value:"",sortable:!1});var t={};if(this.source1Grid&&this.source1Grid.length>0)for(var r in this.source1Grid)t.length>0&&this.source1Grid[r].length>d()(t).length?t=this.source1Grid[r]:0===d()(t).length&&(t=this.source1Grid[r]);if(this.source1Grid&&this.source1Grid.length>0)for(var a in this.source1Grid[0])this.headerText[a]&&e.push({text:this.headerText[a],value:a});return e},source2Pages:function(){return null==this.source2Pagination.rowsPerPage||null==this.source2Pagination.totalItems?0:Math.ceil(this.source2Pagination.totalItems/this.source2Count)},source1Pages:function(){return null==this.source1Pagination.rowsPerPage||null==this.source1Pagination.totalItems?0:Math.ceil(this.source1Pagination.totalItems/this.source1Count)},source1:function(){var e=this.$store.state.activePair.source1.name;return e&&(e=this.toTitleCase(e)),e},source2:function(){var e=this.$store.state.activePair.source2.name;return e&&(e=this.toTitleCase(e)),e},editLocationNameErrors:function(){var e=[];return this.$v.editLocationName.$dirty?(!this.$v.editLocationName.required&&e.push("Facility Name is required"),e):e}},watch:{source1Pagination:{handler:function(){if(this.currentSource1Pagination.sortBy!==this.source1Pagination.sortBy||this.currentSource1Pagination.descending!==this.source1Pagination.descending||this.currentSource1Pagination.page!==this.source1Pagination.page){var e=this.source1Pagination.page-1;this.source1Start=e*this.source1Count+1,this.getSource1Grid(this.source1SelNodeId)}},deep:!0},source2Pagination:{handler:function(){if(this.currentSource2Pagination.sortBy!==this.source2Pagination.sortBy||this.currentSource2Pagination.descending!==this.source2Pagination.descending||this.currentSource2Pagination.page!==this.source2Pagination.page){var e=this.source2Pagination.page-1;this.source2Start=e*this.source2Count+1,this.getSource2Grid(this.source2SelNodeId)}},deep:!0}},mounted:function(){this.getSource1Grid(!1),this.getSource2Grid(!1),this.getTree()},components:{"liquor-tree":ee.a}},re={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{fluid:""}},[e.$store.state.uploadRunning?[r("br"),r("br"),r("br"),e._v(" "),r("v-alert",{attrs:{type:"info",value:!0}},[r("b",[e._v("Wait for upload to finish ...")]),e._v(" "),r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)]:e._e(),e._v(" "),!e.$store.state.denyAccess&!e.$store.state.uploadRunning?[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:"","text-xs-right":""}},[r("v-dialog",{attrs:{scrollable:"",persistent:"",overlay:!1,"max-width":"700px",transition:"dialog-transition"},model:{value:e.helpDialog,callback:function(t){e.helpDialog=t},expression:"helpDialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[r("v-icon",[e._v("info")]),e._v(" About this page\n              ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.helpDialog=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[e._v("\n              This page let you view dat you have uploaded or synchronized from a remote server\n              "),r("v-list",[e._v("1. Use the tree to filter grid data")])],1)],1)],1),e._v(" "),r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",flat:"",icon:"",color:"primary"},on:{click:function(t){e.helpDialog=!0}},slot:"activator"},[r("v-icon",[e._v("help")])],1),e._v(" "),r("span",[e._v("Help")])],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",transition:"scale-transition","max-width":"500px"},model:{value:e.confirmDelete,callback:function(t){e.confirmDelete=t},expression:"confirmDelete"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n            Warning\n          ")])],1),e._v(" "),r("v-card-text",[e._v("\n          Are you sure that you want to delete "+e._s(e.deleteLocationData.facility)+"\n        ")]),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"error"},nativeOn:{click:function(t){e.confirmDelete=!1}}},[e._v("Cancel")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"primary",dark:""},nativeOn:{click:function(t){return e.deleteLocation()}}},[e._v("Proceed")])],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",transition:"scale-transition","max-width":"500px"},model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}},[r("v-card",{attrs:{height:"500px"}},[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n            Edit Location\n          ")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-icon",{staticStyle:{cursor:"pointer"},on:{click:function(t){e.editDialog=!1}}},[e._v("close")])],1),e._v(" "),r("v-card-text",[r("v-layout",{attrs:{column:""}},[r("v-flex",[r("v-text-field",{attrs:{"error-messages":e.editLocationNameErrors,required:"",label:"Facility"},on:{blur:function(t){return e.$v.editLocationName.$touch()},change:function(t){return e.$v.editLocationName.$touch()}},model:{value:e.editLocationName,callback:function(t){e.editLocationName=t},expression:"editLocationName"}})],1),e._v(" "),r("v-flex",[r("v-select",{attrs:{items:e.editParents,box:"",label:"Parent"},model:{value:e.editLocationParent,callback:function(t){e.editLocationParent=t},expression:"editLocationParent"}})],1)],1)],1)],1),e._v(" "),r("v-layout",{attrs:{column:""}},[r("v-flex",[r("v-toolbar",[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs6:"","text-sm-left":""}},[r("v-btn",{attrs:{color:"error"},nativeOn:{click:function(t){e.editDialog=!1}}},[r("v-icon",{attrs:{left:""}},[e._v("cancel")]),e._v(" Cancel\n                ")],1)],1),e._v(" "),r("v-flex",{attrs:{xs6:"","text-sm-right":""}},[r("v-btn",{attrs:{color:"primary",disabled:e.$v.$invalid,dark:""},on:{click:function(t){return e.saveEdit()}}},[r("v-icon",{attrs:{left:""}},[e._v("save")]),e._v("Save\n                ")],1)],1)],1)],1)],1)],1)],1),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs6:""}},[r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[r("h3",{staticClass:"headline mb-0"},[e._v("Source 1 Data Tree")])]),e._v(" "),e.loadingSource1Tree?[r("v-progress-linear",{attrs:{indeterminate:!0}})]:[r("v-card-text",[r("p",[r("liquor-tree",{ref:"source1Tree",attrs:{data:e.source1Tree,options:{}},on:{"node:selected":e.source1NodeSelected}})],1)])]],2)],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[r("h3",{staticClass:"headline mb-0"},[e._v("Source 2 Data Tree")])]),e._v(" "),e.loadingSource2Tree?[r("v-progress-linear",{attrs:{indeterminate:!0}})]:[r("v-card-text",[r("p",[r("liquor-tree",{ref:"source2Tree",attrs:{data:e.source2Tree,options:{}},on:{"node:selected":e.source2NodeSelected}})],1)])]],2)],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[r("h3",{staticClass:"headline mb-0"},[e._v("Source 1 Data Grid")])]),e._v(" "),e.loadingSource1Grid?[r("v-progress-linear",{attrs:{indeterminate:!0}})]:[r("v-card-title",[r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchSource1,callback:function(t){e.searchSource1=t},expression:"searchSource1"}})],1),e._v(" "),r("v-card-text",[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.source1GridHeader,items:e.source1Grid,search:e.searchSource1,pagination:e.source1Pagination,"total-items":e.totalSource1Records,loading:e.loadingSource1,"hide-actions":""},on:{"update:pagination":function(t){e.source1Pagination=t}},scopedSlots:e._u([{key:"items",fn:function(t){return e._l(e.source1GridHeader,function(a,s){return r("td",{key:a.value+1,staticStyle:{"white-space":"nowrap",overflow:"hidden"}},[0===s&&e.isDataset1Owner?[r("v-icon",{staticStyle:{cursor:"pointer"},on:{click:function(r){return e.edit(t.item,"source1")}}},[e._v("edit")]),e._v(" |\n                      "),r("v-icon",{staticStyle:{cursor:"pointer"},on:{click:function(r){return e.deleteLocation(t.item,"source1","requestConfirmation")}}},[e._v("delete")])]:[e._v("\n                      "+e._s(t.item[a.value])+"\n                    ")]],2)})}}],null,!1,2360727723)})],1),e._v(" "),r("div",{staticClass:"text-xs-center pt-2"},[r("v-pagination",{attrs:{length:e.source1Pages},model:{value:e.source1Pagination.page,callback:function(t){e.$set(e.source1Pagination,"page",t)},expression:"source1Pagination.page"}})],1)]],2)],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[r("h3",{staticClass:"headline mb-0"},[e._v("Source 2 Data Grid")])]),e._v(" "),e.loadingSource2Grid?[r("v-progress-linear",{attrs:{indeterminate:!0}})]:[r("v-card-title",[r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchSource2,callback:function(t){e.searchSource2=t},expression:"searchSource2"}})],1),e._v(" "),r("v-card-text",[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.source2GridHeader,items:e.source2Grid,search:e.searchSource2,pagination:e.source2Pagination,"total-items":e.totalSource2Records,loading:e.loadingSource2,"hide-actions":""},on:{"update:pagination":function(t){e.source2Pagination=t}},scopedSlots:e._u([{key:"items",fn:function(t){return e._l(e.source2GridHeader,function(a,s){return r("td",{key:a.value+2,staticStyle:{"white-space":"nowrap",overflow:"hidden"}},[0===s&&e.isDataset2Owner?[r("v-icon",{staticStyle:{cursor:"pointer"},on:{click:function(r){return e.edit(t.item,"source2")}}},[e._v("edit")]),e._v(" |\n                      "),r("v-icon",{staticStyle:{cursor:"pointer"},on:{click:function(r){return e.deleteLocation(t.item,"source2","requestConfirmation")}}},[e._v("delete")])]:[e._v("\n                      "+e._s(t.item[a.value])+"\n                    ")]],2)})}}],null,!1,3193632648)})],1),e._v(" "),r("div",{staticClass:"text-xs-center pt-2"},[r("v-pagination",{attrs:{length:e.source2Pages},model:{value:e.source2Pagination.page,callback:function(t){e.$set(e.source2Pagination,"page",t)},expression:"source2Pagination.page"}})],1)]],2)],1)],1),e._v(" "),r("br"),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs1:"",xl10:""}},[r("v-btn",{attrs:{color:"primary",dark:""},on:{click:function(t){return e.$router.push({name:"FacilityReconScores"})}}},[r("v-icon",[e._v("find_in_page")]),e._v("\n          Reconcile\n        ")],1)],1)],1)]:e._e()],2)},staticRenderFns:[]};var ae=r("VU/8")(te,re,!1,function(e){r("2Jjk")},"data-v-d751a92a",null).exports,se={mixins:[g,p],data:function(){return{loadingCSV:!1,loadingFHIR:!1,downloadDialog:!1,matchedDownloadData:"",unmatchedSource1DownloadData:"",unmatchedSource2DownloadData:"",downloadType:""}},methods:{closeDownloadDialog:function(){this.downloadDialog=!1,this.matchedDownloadData="",this.unmatchedSource1DownloadData="",this.unmatchedSource2DownloadData=""},matchedLocations:function(e){var t=this.$store.state.activePair.userID._id,r=this.getSource1(),a=this.getSource2(),o=this.getDatasourceOwner(),i=o.source1Owner,n=o.source2Owner,c=s()(this.$store.state.levelMapping.source1),l=s()(this.$store.state.levelMapping.source2),u={source1:r,source2:a,source1Owner:i,source2Owner:n,type:e,userID:t,source1LimitOrgId:this.getLimitOrgIdOnActivePair().source1LimitOrgId,source2LimitOrgId:this.getLimitOrgIdOnActivePair().source2LimitOrgId,levelMapping1:c,levelMapping2:l};return h.a.get("/matchedLocations",{params:u})},unMatchedLocations:function(e){var t=this.$store.state.activePair.userID._id,r=this.getDatasourceOwner(),a=r.source1Owner,s=r.source2Owner,o=this.$store.state.levelMapping.source1,i=this.$store.state.levelMapping.source2,n=this.getLimitOrgIdOnActivePair().source1LimitOrgId,c=this.getLimitOrgIdOnActivePair().source2LimitOrgId,l={source1:this.getSource1(),source2:this.getSource2(),source1Owner:a,source2Owner:s,type:e,userID:t,source1LimitOrgId:n,source2LimitOrgId:c,levelMapping1:o,levelMapping2:i};return h.a.get("/unmatchedLocations",{params:l})},csvExport:function(){this.loadingCSV=!0;var e=this;h.a.all([this.matchedLocations("CSV"),this.unMatchedLocations("CSV")]).then(h.a.spread(function(t,r){e.loadingCSV=!1,e.downloadDialog=!0,e.downloadType="csv",e.matchedDownloadData=t.data,e.unmatchedSource1DownloadData=r.data.unmatchedSource1CSV,e.unmatchedSource2DownloadData=r.data.unmatchedSource2CSV}))},fhirExport:function(){this.loadingFHIR=!0;var e=this;h.a.all([this.matchedLocations("FHIR"),this.unMatchedLocations("FHIR")]).then(h.a.spread(function(t,r){e.loadingFHIR=!1,e.downloadDialog=!0,e.downloadType="fhir",e.matchedDownloadData=t.data,e.unmatchedSource1DownloadData=r.data.unmatchedSource1mCSD,e.unmatchedSource2DownloadData=r.data.unmatchedSource2mCSD}))},downloadMatched:function(){var e=void 0,t=void 0;"fhir"===this.downloadType?(e="json",t="data:text/json;charset=utf-8,",this.matchedDownloadData=s()(this.matchedDownloadData)):(e="csv",t="data:text/csv;charset=utf-8,");var r=encodeURI(t+this.matchedDownloadData),a=document.createElement("a");a.setAttribute("href",r),a.setAttribute("download","matched"+this.getSource1()+this.getSource2()+"."+e),a.click()},downloadSource1Unmatched:function(){var e=void 0,t=void 0;"fhir"===this.downloadType?(e="json",t="data:text/json;charset=utf-8,",this.unmatchedSource1DownloadData=s()(this.unmatchedSource1DownloadData)):(e="csv",t="data:text/csv;charset=utf-8,");var r=encodeURI(t+this.unmatchedSource1DownloadData),a=document.createElement("a");a.setAttribute("href",r),a.setAttribute("download","unmatched"+this.getSource1()+"."+e),a.click()},downloadSource2Unmatched:function(){var e=void 0,t=void 0;"fhir"===this.downloadType?(e="json",t="data:text/json;charset=utf-8,",this.unmatchedSource2DownloadData=s()(this.unmatchedSource2DownloadData)):(e="csv",t="data:text/csv;charset=utf-8,");var r=encodeURI(t+this.unmatchedSource2DownloadData),a=document.createElement("a");a.setAttribute("href",r),a.setAttribute("download","unmatched"+this.getSource2()+"."+e),a.click()}}},oe={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{"grid-list-xs":""}},[r("v-dialog",{attrs:{persistent:"",width:"620px"},model:{value:e.downloadDialog,callback:function(t){e.downloadDialog=t},expression:"downloadDialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n          Select file type to download\n        ")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-icon",{on:{click:e.closeDownloadDialog}},[e._v("close")])],1),e._v(" "),r("v-card-text"),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{round:"",color:"info"},on:{click:e.downloadMatched}},[r("v-icon",{attrs:{left:""}},[e._v("file_copy")]),e._v("\n          Matched\n        ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{round:"",color:"info"},on:{click:e.downloadSource1Unmatched}},[r("v-icon",{attrs:{left:""}},[e._v("file_copy")]),e._v("\n          Source1 Unmatched\n        ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{round:"",color:"info"},on:{click:e.downloadSource2Unmatched}},[r("v-icon",{attrs:{left:""}},[e._v("file_copy")]),e._v("\n          Source2 Unmatched\n        ")],1)],1)],1)],1),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs6:""}},[r("v-btn",{attrs:{color:"success",round:"",small:""},on:{click:e.csvExport}},[r("v-icon",{attrs:{left:""}},[e._v("file_copy")]),e._v(" "),e.loadingCSV?r("v-progress-circular",{attrs:{indeterminate:"",color:"red"}}):e._e(),e._v("\n        CSV Export\n      ")],1)],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-btn",{attrs:{color:"success",round:"",small:""},on:{click:e.fhirExport}},[r("v-icon",{attrs:{left:""}},[e._v("file_copy")]),e._v(" "),e.loadingFHIR?r("v-progress-circular",{attrs:{indeterminate:"",color:"red"}}):e._e(),e._v("\n        FHIR Export\n      ")],1)],1)],1)],1)},staticRenderFns:[]},ie=r("VU/8")(se,oe,!1,null,null,null).exports,ne={mixins:[g,p],data:function(){return{scoreDialog:!1,flagCommentDialog:!1,flagComment:"",helpDialog:!1,type:"",source2Id:"",source2Name:"",sort_arrow:"up",pagination:{sortBy:"score"},recoLevel:0,searchUnmatchedSource2:"",searchUnmatchedSource1:"",searchPotential:"",searchMatched:"",searchNotMatched:"",searchIgnore:"",searchFlagged:"",potentialMatches:[],showAllPotential:null,alertText:"",alertTitle:"",alert:!1,source1Parents:{},source1Filter:{text:"",level:""},source1TreeUpdate:0,selectedSource1Name:null,selectedSource1Id:null,selectedSource1Lat:null,selectedSource1Long:null,selectedSource1Parents:[],dialog:!1,dialogWidth:"",source1UnmatchedHeaders:[{text:"Location",value:"name"}],noMatchHeaders:[{text:"Source 1 Location",value:"source1Name"},{text:"Source 1 ID",value:"source1Id"},{text:"Parents",value:"parents"}],flaggedHeaders:[{text:"Source 1 Location",value:"source1Name"},{text:"Source 1 ID",value:"source1Id"},{text:"Source 2 Location",value:"source2Name"},{text:"Source 2 ID",value:"source2Id"},{text:"Comment",value:"flagComment"}]}},filters:{removeCountry:function(e){var t=e.slice(0);return t.splice(t.length-1,1),t},joinParents:function(e){return e.join("->")}},methods:{changeSort:function(e){this.pagination.sortBy===e?this.pagination.descending=!this.pagination.descending:(this.pagination.sortBy=e,this.pagination.descending=!1),this.pagination.descending?this.sort_arrow="down":this.sort_arrow="up"},addListener:function(){var e=this;!function t(){e.$refs&&e.$refs.source1Tree?e.$refs.source1Tree.$on("node:selected",function(t){e.source1Filter.text=t.data.text;for(var r=1;t.parent;)t=t.parent,r++;e.source1Filter.level=r}):setTimeout(function(){t()},500)}()},levelChanged:function(e){this.$store.state.recoLevel!==e&&(this.$store.state.recoLevel=e,this.getScores(),this.$store.state.recoLevel===this.$store.state.totalSource1Levels?this.dialogWidth="1440px":this.dialogWidth="1190px")},getPotentialMatch:function(e){var t=this;this.potentialMatches=[],this.showAllPotential=null;var r=!0,a=!1,s=void 0;try{for(var o,i=n()(this.$store.state.scoreResults);!(r=(o=i.next()).done);r=!0){var c=o.value;if(c.source1.id===e)for(var l in this.selectedSource1Name=c.source1.name,this.selectedSource1Parents=c.source1.parents,this.selectedSource1Lat=c.source1.lat,this.selectedSource1Long=c.source1.long,this.selectedSource1Id=c.source1.id,c.potentialMatches){var u=function(e){var r=c.potentialMatches[l][e];return v=t.$store.state.matchedContent.find(function(e){return e.source2Id===r.id}),h=t.$store.state.flagged.find(function(e){return e.source2Id===r.id}),v?"continue":h?"continue":void t.potentialMatches.push({score:l,name:r.name,id:r.id,lat:r.lat,long:r.long,geoDistance:r.geoDistance,parents:r.parents})};for(var d in c.potentialMatches[l]){var v,h;u(d)}}}}catch(e){a=!0,s=e}finally{try{!r&&i.return&&i.return()}finally{if(a)throw s}}this.dialog=!0},match:function(e,t,r){if(this.matchType=e,this.source2Id=t,this.source2Name=r,null===t)return this.alert=!0,this.alertTitle="Information",void(this.alertText="Select Source 2 Location to match against Source 1 Location");"flag"===e?this.flagCommentDialog=!0:this.saveMatch()},saveMatch:function(){var e=this;this.flagCommentDialog=!1,this.$store.state.progressTitle="Saving match",this.$store.state.dynamicProgress=!0;var t=this.getDatasourceOwner(),r=new FormData;r.append("source1Id",this.selectedSource1Id),r.append("source2Id",this.source2Id),r.append("source1Owner",t.source1Owner),r.append("source2Owner",t.source2Owner),r.append("flagComment",this.flagComment),r.append("source1DB",this.getSource1()),r.append("source2DB",this.getSource2()),r.append("recoLevel",this.$store.state.recoLevel),r.append("totalLevels",this.$store.state.totalSource1Levels),r.append("userID",this.$store.state.activePair.userID._id),h.a.post("/match/"+this.matchType,r,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){e.$store.state.dynamicProgress=!1;var r=null;for(var a in e.$store.state.source2UnMatched)e.$store.state.source2UnMatched[a].id===e.source2Id&&(r=e.$store.state.source2UnMatched[a].parents,e.$store.state.source2UnMatched.splice(a,1));for(var s in e.$store.state.source1UnMatched)e.$store.state.source1UnMatched[s].id===e.selectedSource1Id&&("match"===e.matchType?(++e.$store.state.totalAllMapped,e.$store.state.matchedContent.push({source1Name:e.selectedSource1Name,source1Id:e.selectedSource1Id,source1Parents:e.$store.state.source1UnMatched[s].parents,source2Name:e.source2Name,source2Id:e.source2Id,source2Parents:r,matchComments:t.data.matchComments})):"flag"===e.matchType&&(++e.$store.state.totalAllFlagged,e.$store.state.flagged.push({source1Name:e.selectedSource1Name,source1Id:e.selectedSource1Id,source1Parents:e.$store.state.source1UnMatched[s].parents,source2Name:e.source2Name,source2Id:e.source2Id,source2Parents:r,flagComment:e.flagComment})),e.$store.state.source1UnMatched.splice(s,1));e.flagComment="",e.selectedSource1Id=null,e.selectedSource1Name=null,e.dialog=!1}).catch(function(t){e.flagComment="",e.$store.state.dynamicProgress=!1,e.alert=!0,e.alertTitle="Error",e.alertText=t.response.data.error,e.selectedSource1Id=null,e.selectedSource1Name=null,e.dialog=!1})},acceptFlag:function(e){var t=this;this.$store.state.progressTitle="Accepting flag",this.$store.state.dynamicProgress=!0;var r=new FormData;r.append("source1Id",e);var a=this.$store.state.activePair.userID._id;h.a.post("/acceptFlag/"+this.getSource1()+"/"+this.getSource2()+"/"+a,r,{headers:{"Content-Type":"multipart/form-data"}}).then(function(){for(var r in t.$store.state.dynamicProgress=!1,t.$store.state.flagged)t.$store.state.flagged[r].source1Id===e&&(t.$store.state.matchedContent.push({source1Name:t.$store.state.flagged[r].source1Name,source1Id:t.$store.state.flagged[r].source1Id,source1Parents:t.$store.state.flagged[r].source1Parents,source2Name:t.$store.state.flagged[r].source2Name,source2Id:t.$store.state.flagged[r].source2Id,source2Parents:t.$store.state.flagged[r].source2Parents}),t.$store.state.flagged.splice(r,1),++t.$store.state.totalAllMapped,--t.$store.state.totalAllFlagged)}).catch(function(e){t.$store.state.dynamicProgress=!1,t.alert=!0,t.alertTitle="Error",t.alertText=e.response.data.error,t.selectedSource1Id=null,t.selectedSource1Name=null,t.dialog=!1,console.log(e)})},breakMatch:function(e){var t=this;this.$store.state.progressTitle="Breaking match",this.$store.state.dynamicProgress=!0;var r=new FormData,a=this.$store.state.activePair.userID._id,s=this.getDatasourceOwner();r.append("source1Id",e),h.a.post("/breakMatch/"+this.getSource1()+"/"+this.getSource2()+"/"+s.source1Owner+"/"+s.source2Owner+"/"+a,r,{headers:{"Content-Type":"multipart/form-data"}}).then(function(r){for(var a in t.$store.state.dynamicProgress=!1,t.alert=!0,t.alertTitle="Information",t.alertText="Scores for this Location may not be available unless you recalculate scores",t.$store.state.matchedContent)t.$store.state.matchedContent[a].source1Id===e&&(t.$store.state.source1UnMatched.push({name:t.$store.state.matchedContent[a].source1Name,id:t.$store.state.matchedContent[a].source1Id,parents:t.$store.state.matchedContent[a].source1Parents}),t.$store.state.source2UnMatched.push({name:t.$store.state.matchedContent[a].source2Name,id:t.$store.state.matchedContent[a].source2Id,parents:t.$store.state.matchedContent[a].source2Parents}),t.$store.state.matchedContent.splice(a,1),--t.$store.state.totalAllMapped)}).catch(function(e){t.$store.state.dynamicProgress=!1,t.alert=!0,t.alertTitle="Error",t.alertText=e.response.data.error,t.selectedSource1Id=null,t.selectedSource1Name=null,t.dialog=!1,console.log(e)})},unFlag:function(e){var t=this;this.$store.state.progressTitle="Unflagging match",this.$store.state.dynamicProgress=!0;var r=new FormData,a=this.$store.state.activePair.userID._id,s=this.getDatasourceOwner();r.append("source1Id",e),h.a.post("/breakMatch/"+this.getSource1()+"/"+this.getSource2()+"/"+s.source1Owner+"/"+s.source2Owner+"/"+a,r,{headers:{"Content-Type":"multipart/form-data"}}).then(function(r){for(var a in t.$store.state.dynamicProgress=!1,t.alert=!0,t.alertTitle="Information",t.alertText="Scores for this Location may not be available unless you recalculate scores",t.$store.state.flagged)t.$store.state.flagged[a].source1Id===e&&(t.$store.state.source1UnMatched.push({name:t.$store.state.flagged[a].source1Name,id:t.$store.state.flagged[a].source1Id,parents:t.$store.state.flagged[a].source1Parents}),t.$store.state.source2UnMatched.push({name:t.$store.state.flagged[a].source2Name,id:t.$store.state.flagged[a].source2Id,parents:t.$store.state.flagged[a].source2Parents}),t.$store.state.flagged.splice(a,1),--t.$store.state.totalAllFlagged)}).catch(function(e){t.$store.state.dynamicProgress=!1,t.alert=!0,t.alertTitle="Error",t.alertText=e.response.data.error,t.selectedSource1Id=null,t.selectedSource1Name=null,t.dialog=!1,console.log(e)})},breakNoMatch:function(e,t){var r=this;this.$store.state.progressTitle="Breaking no match",this.$store.state.dynamicProgress=!0;var a=new FormData;a.append("source1Id",e),a.append("recoLevel",this.$store.state.recoLevel),a.append("totalLevels",this.$store.state.totalSource1Levels);var s=this.$store.state.activePair.userID._id;h.a.post("/breakNoMatch/"+t+"/"+this.getSource1()+"/"+this.getSource2()+"/"+s,a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(a){if(r.$store.state.dynamicProgress=!1,r.alert=!0,r.alertTitle="Information",r.alertText="Scores for this Location may not be available unless you recalculate scores","nomatch"===t)for(var s in r.$store.state.noMatchContent)r.$store.state.noMatchContent[s].source1Id===e&&(r.$store.state.source1UnMatched.push({name:r.$store.state.noMatchContent[s].source1Name,id:r.$store.state.noMatchContent[s].source1Id,parents:r.$store.state.noMatchContent[s].parents}),r.$store.state.noMatchContent.splice(s,1),--r.$store.state.totalAllNoMatch);else if("ignore"===t)for(var o in r.$store.state.ignoreContent)r.$store.state.ignoreContent[o].source1Id===e&&(r.$store.state.source1UnMatched.push({name:r.$store.state.ignoreContent[o].source1Name,id:r.$store.state.ignoreContent[o].source1Id,parents:r.$store.state.ignoreContent[o].parents}),r.$store.state.ignoreContent.splice(o,1),--r.$store.state.totalAllIgnore)}).catch(function(e){r.$store.state.dynamicProgress=!1,r.alert=!0,r.alertTitle="Error",r.alertText=e.response.data.error,r.selectedSource1Id=null,r.selectedSource1Name=null,r.dialog=!1,console.log(e)})},noMatch:function(e){var t=this;this.$store.state.progressTitle="Saving as no match",this.$store.state.dynamicProgress=!0;var r=this.$store.state.activePair.userID._id,a=this.getDatasourceOwner(),s=a.source1Owner,o=a.source2Owner,i=new FormData;i.append("source1Id",this.selectedSource1Id),i.append("recoLevel",this.$store.state.recoLevel),i.append("totalLevels",this.$store.state.totalSource1Levels),h.a.post("/noMatch/"+e+"/"+this.getSource1()+"/"+this.getSource2()+"/"+s+"/"+o+"/"+r,i,{headers:{"Content-Type":"multipart/form-data"}}).then(function(){if(t.$store.state.dynamicProgress=!1,"nomatch"===e)for(var r in t.$store.state.source1UnMatched)t.$store.state.source1UnMatched[r].id===t.selectedSource1Id&&(t.$store.state.noMatchContent.push({source1Name:t.selectedSource1Name,source1Id:t.selectedSource1Id,parents:t.$store.state.source1UnMatched[r].parents}),++t.$store.state.totalAllNoMatch,t.$store.state.source1UnMatched.splice(r,1));else if("ignore"===e)for(var a in t.$store.state.source1UnMatched)t.$store.state.source1UnMatched[a].id===t.selectedSource1Id&&(t.$store.state.ignoreContent.push({source1Name:t.selectedSource1Name,source1Id:t.selectedSource1Id,parents:t.$store.state.source1UnMatched[a].parents}),++t.$store.state.totalAllIgnore,t.$store.state.source1UnMatched.splice(a,1));t.dialog=!1,t.selectedSource1Id=null,t.selectedSource1Name=null}).catch(function(e){t.$store.state.dynamicProgress=!1,t.alert=!0,t.alertTitle="Error",t.alertText=e.response.data.error,t.dialog=!1,t.selectedSource1Id=null,t.selectedSource1Name=null})},back:function(){this.searchPotential="",this.dialog=!1}},computed:{nextLevelText:{get:function(){return this.translateDataHeader("source1",this.$store.state.recoLevel)},set:function(e){}},currentLevelText:{get:function(){return this.translateDataHeader("source1",this.$store.state.recoLevel-1)},set:function(e){}},matchedHeaders:function(){return[{text:"Source1 Location",value:"source1Name"},{text:"Source1 ID",value:"source1Id"},{text:"Source2 Location",value:"source2Name"},{text:"Source2 ID",value:"source2Id"},{text:"Match Comment",value:"matchComments"}]},source1GridHeaders:function(){var e=[{text:"Location",value:"name"}];if(this.$store.state.source1UnMatched.length>0)for(var t=this.$store.state.source1UnMatched[0].parents.length;t>0;t--)e.push({text:"Level "+t,value:"level"+(t+1)});return e.splice(1,1),e},potentialHeaders:function(){var e=[];return e.push({sortable:!1},{text:"Source 2 Location",value:"name",sortable:!1},{text:"ID",value:"id",sortable:!1},{text:"Parent",value:"source2Parent",sortable:!1}),this.$store.state.recoLevel===this.$store.state.totalSource1Levels&&e.push({text:"Geo Dist (Miles)",value:"geodist",sortable:!1}),e.push({text:"Score",value:"score"}),e},potentialAvailable:function(){return null!==this.$store.state.source2UnMatched&&this.$store.state.source2UnMatched.length>this.potentialMatches.length},allPotentialMatches:function(){var e=this;if(null!==this.$store.state.source2UnMatched&&this.$store.state.source2UnMatched.length>this.potentialMatches.length&&"all"===this.showAllPotential){var t=[],r=function(r){e.potentialMatches.find(function(e){return e.id===r.id})||(r.score="N/A",t.push(r))},a=!0,s=!1,o=void 0;try{for(var i,c=n()(this.$store.state.source2UnMatched);!(a=(i=c.next()).done);a=!0){r(i.value)}}catch(e){s=!0,o=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw o}}return this.potentialMatches.concat(t)}return this.potentialMatches},source1Tree:function(){this.addListener();var e=[];return 1===d()(this.$store.state.source1Parents).length&&"null"===d()(this.$store.state.source1Parents)[0]?e:(function e(t,r){for(var a in t){var s={text:a,children:[]};e(t[a],s.children),0===s.children.length&&delete s.children,r.push(s)}}(this.$store.state.source1Parents,e),this.source1TreeUpdate++,e)},source1Grid:function(){var e=this;if(this.$store.state.source1UnMatched.length>0&&""!==this.source1Filter.level){var t=this.$store.state.source1UnMatched[0].parents.length-this.source1Filter.level;return this.$store.state.source1UnMatched.filter(function(r){return r.parents[t]===e.source1Filter.text})}return this.$store.state.source1UnMatched},goNextLevel:function(){return this.$store.state.recoLevel<this.$store.state.totalSource1Levels&&null!==this.$store.state.source1UnMatched&&0===this.$store.state.source1UnMatched.length&&null!==this.$store.state.flagged&&0===this.$store.state.flagged.length&&null!==this.$store.state.matchedContent&&0!==this.$store.state.matchedContent.length?"yes":"no"},lastLevelDone:function(){return this.$store.state.recoLevel===this.$store.state.totalSource1Levels&&null!==this.$store.state.source1UnMatched&&0===this.$store.state.source1UnMatched.length&&null!==this.$store.state.flagged&&0===this.$store.state.flagged.length?"yes":"no"},source1TotalRecords:function(){return this.$store.state.scoreResults?this.$store.state.scoreResults.length:0},source1TotalMatched:function(){return this.$store.state.matchedContent?this.$store.state.matchedContent.length:0},source1PercentMatched:function(){return 0===this.source1TotalRecords?0:parseFloat((100*this.source1TotalMatched/this.source1TotalRecords).toFixed(1))},source1TotalUnMatched:function(){return this.source1TotalRecords-this.source1TotalMatched},source1PercentUnMatched:function(){return 0===this.source1TotalRecords?0:parseFloat((100*this.source1TotalUnMatched/this.source1TotalRecords).toFixed(1))},totalFlagged:function(){return this.$store.state.flagged?this.$store.state.flagged.length:0},source1PercentFlagged:function(){return 0===this.$store.state.scoreResults.length?0:this.$store.state.flagged?parseFloat((100*this.$store.state.flagged.length/this.$store.state.scoreResults.length).toFixed(1)):0},source1TotalNoMatch:function(){return this.$store.state.noMatchContent?this.$store.state.noMatchContent.length:0},source1TotalIgnore:function(){return this.$store.state.ignoreContent?this.$store.state.ignoreContent.length:0},source1PercentNoMatch:function(){return 0===this.$store.state.scoreResults.length?0:this.$store.state.noMatchContent?parseFloat((100*this.$store.state.noMatchContent.length/this.$store.state.scoreResults.length).toFixed(1)):0},source1PercentIgnore:function(){return 0===this.$store.state.scoreResults.length?0:this.$store.state.ignoreContent?parseFloat((100*this.$store.state.ignoreContent.length/this.$store.state.scoreResults.length).toFixed(1)):0},source2TotalRecords:function(){return this.$store.state.source2TotalRecords?this.$store.state.source2TotalRecords:0},source2TotalUnmatched:function(){return this.source2TotalRecords>0&&this.$store.state.matchedContent?parseInt(this.source2TotalRecords)-parseInt(this.$store.state.matchedContent.length):0},source2PercentUnmatched:function(){return 0===this.$store.state.source2TotalRecords?0:parseFloat((100*this.source2TotalUnmatched/this.$store.state.source2TotalRecords).toFixed(1))},source2PercentFlagged:function(){return 0===this.$store.state.source2TotalRecords?0:this.$store.state.flagged?parseFloat((100*this.$store.state.flagged.length/this.$store.state.source2TotalRecords).toFixed(1)):0},source2TotalMatched:function(){return this.source1TotalMatched},source2PercentMatched:function(){return 0===this.$store.state.source2TotalRecords?0:parseFloat((100*this.source2TotalMatched/this.$store.state.source2TotalRecords).toFixed(1))},source2NotInSource1:function(){var e=this.source2TotalRecords-this.source1TotalRecords;return e<0?0:e},source2PercentNotInSource1:function(){if(0===this.source2NotInSource1)return 0;var e=parseFloat((100*this.source2NotInSource1/this.source2TotalRecords).toFixed(1));return parseFloat(e)}},created:function(){var e=this;this.$store.state.recalculateScores&&(this.$store.state.recalculateScores=!1,this.getScores()),tt.$on("changeCSVHeaderNames",function(){var t=e.translateDataHeader("source1",e.$store.state.recoLevel);e.nextLevelText=t,e.currentLevelText=t}),this.addListener(),this.$store.state.recoLevel===this.$store.state.totalSource1Levels?this.dialogWidth="auto":this.dialogWidth="1190px"},components:{"liquor-tree":ee.a,appRecoExport:ie}},ce={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{fluid:""}},[e.$store.state.uploadRunning?[r("br"),r("br"),r("br"),e._v(" "),r("v-alert",{attrs:{type:"info",value:!0}},[r("b",[e._v("Wait for upload to finish ...")]),e._v(" "),r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)]:e._e(),e._v(" "),!e.$store.state.denyAccess&!e.$store.state.uploadRunning?r("v-container",{attrs:{fluid:"","grid-list-lg":""}},[r("v-dialog",{attrs:{"hide-overlay":"",persistent:"",width:"350"},model:{value:e.scoreDialog,callback:function(t){e.scoreDialog=t},expression:"scoreDialog"}},[r("v-card",{attrs:{color:"white",dark:""}},[r("v-card-text",[r("center",[r("font",{staticStyle:{color:"blue"}},[e._v(e._s(e.scoreProgressTitle))]),r("br"),e._v(" "),"percent"==e.progressType?r("v-progress-circular",{attrs:{rotate:-90,size:100,width:15,value:e.scoreProgressPercent,color:"primary"}},[r("v-avatar",{attrs:{color:"indigo",size:"50px"}},[r("span",{staticClass:"white--text"},[r("b",[e._v(e._s(e.scoreProgressPercent)+"%")])])])],1):e._e(),e._v(" "),"indeterminate"==e.progressType?r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"red"}}):e._e()],1)],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",width:"500px"},model:{value:e.alert,callback:function(t){e.alert=t},expression:"alert"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n            "+e._s(e.alertTitle)+"\n          ")])],1),e._v(" "),r("v-card-text",[e._v("\n          "+e._s(e.alertText)+"\n        ")]),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"success"},on:{click:function(t){e.alert=!1}}},[e._v("OK")])],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",width:"500px"},model:{value:e.flagCommentDialog,callback:function(t){e.flagCommentDialog=t},expression:"flagCommentDialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n            Add comment for this flag if any\n          ")])],1),e._v(" "),r("v-card-text",[r("v-textarea",{attrs:{"auto-grow":"",box:"",color:"deep-purple",label:"Flag Comment",rows:"1"},model:{value:e.flagComment,callback:function(t){e.flagComment=t},expression:"flagComment"}})],1),e._v(" "),r("v-card-actions",[r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"success"},on:{click:e.saveMatch}},[e._v("Continue")])],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",transition:"scale-transition",width:e.dialogWidth},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-card",{attrs:{width:e.dialogWidth}},[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n            Matching "+e._s(e.selectedSource1Name)+"\n          ")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":"",color:"yellow"},model:{value:e.searchPotential,callback:function(t){e.searchPotential=t},expression:"searchPotential"}}),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){return e.back(t)}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-title",[e._v("\n          Parents:\n          "),r("b",[e._v(e._s(e.selectedSource1Parents.join("->")))]),e._v(" "),r("v-spacer"),e._v(" "),e.$store.state.recoLevel==e.$store.state.totalSource1Levels?[e._v("\n            Latitude:\n            "),r("b",[e._v(e._s(e.selectedSource1Lat))]),e._v(" "),r("v-spacer"),e._v("\n            Longitude:\n            "),r("b",[e._v(e._s(e.selectedSource1Long))]),e._v(" "),r("v-spacer")]:e._e()],2),e._v(" "),r("v-card-text",[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.potentialHeaders,items:e.allPotentialMatches,search:e.searchPotential,pagination:e.pagination},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"headers",fn:function(t){return[r("tr",[e._l(e.potentialHeaders,function(t){return["Score"==t.text?r("th",{key:t.text,staticClass:"column sortable active",attrs:{align:"left"},on:{click:function(r){return e.changeSort(t.value)}}},["up"==e.sort_arrow?r("v-icon",{attrs:{small:""}},[e._v("arrow_upward")]):r("v-icon",{attrs:{small:""}},[e._v("arrow_downward")]),e._v("\n                    "+e._s(t.text)+"\n                    "),r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",icon:""},slot:"activator"},[r("v-icon",[e._v("help")])],1),e._v(" "),r("span",[e._v("The lower the score, the better the match")])],1)],1):r("th",{key:t.text,attrs:{align:"left"}},[e._v("\n                    "+e._s(t.text)+"\n                  ")])]})],2)]}},{key:"items",fn:function(t){return[r("tr",[r("td",[r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",color:"error",small:""},nativeOn:{click:function(r){return e.match("flag",t.item.id,t.item.name)}},slot:"activator"},[r("v-icon",{attrs:{dark:"",left:""}},[e._v("notification_important")]),e._v("Flag\n                    ")],1),e._v(" "),r("span",[e._v("Mark the selected item as a match to be reviewed")])],1),e._v(" "),r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",color:"primary",small:"",dark:""},nativeOn:{click:function(r){return e.match("match",t.item.id,t.item.name)}},slot:"activator"},[r("v-icon",{attrs:{left:""}},[e._v("thumb_up")]),e._v("Save Match\n                    ")],1),e._v(" "),r("span",[e._v("Save the selected item as a match")])],1)],1),e._v(" "),r("td",[e._v(e._s(t.item.name))]),e._v(" "),r("td",[e._v(e._s(t.item.id))]),e._v(" "),r("td",[e._v(e._s(t.item.parents.join("->")))]),e._v(" "),e.$store.state.recoLevel==e.$store.state.totalSource1Levels?r("td",[e._v(e._s(t.item.geoDistance))]):e._e(),e._v(" "),r("td",[e._v(e._s(t.item.score))])])]}}],null,!1,2917225493)})],1),e._v(" "),r("v-card-actions",{staticStyle:{float:"center"}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs2:""}},[r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",color:"green",dark:""},nativeOn:{click:function(t){return e.noMatch("nomatch")}},slot:"activator"},[r("v-icon",{attrs:{left:""}},[e._v("thumb_down")]),e._v("No Match\n                ")],1),e._v(" "),r("span",[e._v("Mark this source 1 location as being ignored")])],1)],1),e._v(" "),r("v-flex",{attrs:{xs2:""}},[r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",color:"error",dark:""},nativeOn:{click:function(t){return e.noMatch("ignore")}},slot:"activator"},[r("v-icon",{attrs:{left:""}},[e._v("thumb_down")]),e._v("Ignore\n                ")],1),e._v(" "),r("span",[e._v("Save this Source 1 location as having no match")])],1)],1),e._v(" "),r("v-flex",{attrs:{xs2:""}},[r("v-tooltip",{attrs:{top:""}},[e.potentialAvailable?r("v-btn-toggle",{attrs:{slot:"activator"},slot:"activator",model:{value:e.showAllPotential,callback:function(t){e.showAllPotential=t},expression:"showAllPotential"}},[r("v-btn",{staticStyle:{color:"white"},attrs:{color:"teal darken-6",round:"",value:"all"}},["all"===e.showAllPotential?[e._v("Show Scored Suggestions")]:[e._v("Show All Suggestions")]],2)],1):e._e(),e._v(" "),"all"===e.showAllPotential?r("span",[e._v("Limit to only scored suggestions")]):r("span",[e._v("See all possible choices ignoring the score")])],1)],1),e._v(" "),r("v-flex",{attrs:{xs6:"","text-sm-right":""}},[r("v-tooltip",{attrs:{top:""}},[r("v-btn",{staticStyle:{color:"white"},attrs:{slot:"activator",color:"orange darken-2"},nativeOn:{click:function(t){return e.back(t)}},slot:"activator"},[r("v-icon",{attrs:{dark:"",left:""}},[e._v("arrow_back")]),e._v("Back\n                ")],1),e._v(" "),r("span",[e._v("Return without saving")])],1)],1)],1)],1)],1)],1),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs3:""}},[r("appRecoExport")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs2:""}},[r("b",[e._v("Reconciling "+e._s(e.currentLevelText))])]),e._v(" "),r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs1:"",sm2:"",md2:"",right:""}},[r("v-select",{attrs:{items:e.$store.state.levelArray,"item-value":e.$store.state.levelArray.value,"item-name":e.$store.state.levelArray.text,label:"Level","single-line":""},on:{change:e.levelChanged},model:{value:e.$store.state.recoLevel,callback:function(t){e.$set(e.$store.state,"recoLevel",t)},expression:"$store.state.recoLevel"}})],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-btn",{attrs:{slot:"activator",color:"primary",dark:"",round:""},on:{click:e.getScores},slot:"activator"},[r("v-icon",[e._v("repeat_one")]),e._v(" Recalculate Scores\n        ")],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:"","text-xs-right":""}},[r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",flat:"",icon:"",color:"primary"},on:{click:function(t){e.helpDialog=!0}},slot:"activator"},[r("v-icon",[e._v("help")])],1),e._v(" "),r("span",[e._v("Help")])],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{scrollable:"",persistent:"",overlay:!1,"max-width":"700px",transition:"dialog-transition"},model:{value:e.helpDialog,callback:function(t){e.helpDialog=t},expression:"helpDialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[r("v-icon",[e._v("info")]),e._v(" About this page\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.helpDialog=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[e._v("\n          This page let you map source 1 data with those in source2\n          "),r("v-list",[e._v("\n            1. Source 1 refer to the data source name selected as source 1 under data source pair section\n          ")]),e._v(" "),r("v-list",[e._v("\n            2. Source 2 refer to the data source name selected as source 2 under data source pair section\n          ")]),e._v(" "),r("v-list",[e._v("\n            3. After breaking a match, you will need to recalculate scores for the app to load potential matches of the broken location\n          ")]),e._v(" "),r("v-list",[e._v("\n            4. FLAGGED Locations are the locations that will need to be reviewed before they are saved as matches\n          ")]),e._v(" "),r("v-list",[e._v("\n            5. NO MATCHES - these are locations that do not matches anything from source 2\n          ")])],1)],1)],1),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs2:"",right:""}},[r("div",{staticStyle:{"border-style":"solid","border-color":"green","text-align":"center"}},[r("b",[e._v("Source 1 Reconciliation Status")]),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs6:""}},[r("v-layout",{attrs:{column:""}},[r("v-flex",[r("b",[e._v("Matched")])]),e._v(" "),r("v-flex",{attrs:{"align-center":""}},[r("center",[r("b",[e._v(e._s(e.source1TotalMatched)+"/"+e._s(e.source1TotalRecords))])])],1),e._v(" "),r("v-flex",[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source1PercentMatched,color:"green"}},[r("font",{attrs:{color:"black"}},[r("b",[e._v(e._s(e.source1PercentMatched)+"%")])])],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{"align-center":""}},[r("b",[e._v("Unmatched")])]),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("b",[e._v(e._s(e.source1TotalUnMatched)+"/"+e._s(e.source1TotalRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source1PercentUnMatched,color:"red"}},[r("font",{attrs:{color:"black"}},[r("b",[e._v(e._s(e.source1PercentUnMatched)+"%")])])],1)],1)],1)],1)],1)],1),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs6:""}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{"align-center":""}},[r("b",[e._v("Flagged")])]),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("b",[e._v(e._s(e.totalFlagged)+"/"+e._s(e.source1TotalRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source1PercentFlagged,color:"orange"}},[r("font",{attrs:{color:"black"}},[r("b",[e._v(e._s(e.source1PercentFlagged)+"%")])])],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{"align-center":""}},[r("b",[e._v("No Match")])]),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("b",[e._v(e._s(e.source1TotalNoMatch)+"/"+e._s(e.source1TotalRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source1PercentNoMatch,color:"red"}},[r("font",{attrs:{color:"black"}},[r("b",[e._v(e._s(e.source1PercentNoMatch)+"%")])])],1)],1)],1)],1)],1)],1)],1)]),e._v(" "),r("v-flex",{attrs:{xs4:"","child-flex":""}},[r("v-card",{attrs:{color:"green lighten-2"}},[r("v-card-title",{attrs:{"primary-title":""}},[e._v("\n            Source 1 Unmatched\n            "),r("v-spacer"),e._v(" "),r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchUnmatchedSource1,callback:function(t){e.searchUnmatchedSource1=t},expression:"searchUnmatchedSource1"}})],1),e._v(" "),e.loadingSource1Unmatched?[r("v-progress-linear",{attrs:{size:70,indeterminate:"",color:"amber"}})]:[r("liquor-tree",{key:e.source1TreeUpdate,ref:"source1Tree",attrs:{data:e.source1Tree}}),e._v(" "),r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.source1GridHeaders,items:e.source1Grid,search:e.searchUnmatchedSource1,light:""},scopedSlots:e._u([{key:"items",fn:function(t){return["Done"===e.$store.state.recoStatus?r("td",{key:t.item.id},[e._v(e._s(t.item.name))]):r("td",{key:t.item.id,staticStyle:{cursor:"pointer"},on:{click:function(r){return e.getPotentialMatch(t.item.id)}}},[e._v(e._s(t.item.name))]),e._v(" "),e._l(t.item.parents,function(a,s){return s!=t.item.parents.length-1?r("td",{key:t.item.id+s},[e._v("\n                  "+e._s(a)+"\n                ")]):e._e()})]}}],null,!1,120396608)})]],2)],1),e._v(" "),r("v-flex",{attrs:{xs4:""}},[r("v-card",{attrs:{color:"blue lighten-2",dark:""}},[r("v-card-title",{attrs:{"primary-title":""}},[e._v("\n            Source 2 Unmatched\n            "),r("v-spacer"),e._v(" "),r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchUnmatchedSource2,callback:function(t){e.searchUnmatchedSource2=t},expression:"searchUnmatchedSource2"}})],1),e._v(" "),e.loadingSource2Unmatched?[r("v-progress-linear",{attrs:{size:70,indeterminate:"",color:"amber"}})]:[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.source1UnmatchedHeaders,items:e.$store.state.source2UnMatched,search:e.searchUnmatchedSource2,light:""},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.name)+" "),r("br"),e._v("  "+e._s(e._f("joinParents")(e._f("removeCountry")(t.item.parents))))])]}}],null,!1,2217094960)})]],2)],1),e._v(" "),r("v-flex",{attrs:{xs2:"",right:""}},[r("div",{staticStyle:{"border-style":"solid","border-color":"green","text-align":"center"}},[r("b",[e._v("Source 2 Reconciliation Status")]),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs6:""}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{"align-center":""}},[r("b",[e._v("Matched")])]),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("b",[e._v(e._s(e.source2TotalMatched)+"/"+e._s(e.source2TotalRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source2PercentMatched,color:"green"}},[r("font",{attrs:{color:"black"}},[r("b",[e._v(e._s(e.source2PercentMatched)+"%")])])],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:""}},[r("b",[e._v("Unmatched")])]),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("b",[e._v(e._s(e.source2TotalUnmatched)+"/"+e._s(e.source2TotalRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source2PercentUnmatched,color:"red"}},[r("font",{attrs:{color:"black"}},[r("b",[e._v(e._s(e.source2PercentUnmatched)+"%")])])],1)],1)],1)],1)],1)],1),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs6:""}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{"align-center":""}},[r("b",[e._v("Flagged")])]),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("b",[e._v(e._s(e.totalFlagged)+"/"+e._s(e.source2TotalRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source2PercentFlagged,color:"orange"}},[r("font",{attrs:{color:"black"}},[r("b",[e._v(e._s(e.source2PercentFlagged)+"%")])])],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{"align-center":""}},[r("b",[e._v("Not in Source 1")])]),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("b",[e._v(e._s(e.source2NotInSource1))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source2PercentNotInSource1,color:"red"}},[r("font",{attrs:{color:"black"}},[r("b",[e._v(e._s(e.source2PercentNotInSource1)+"%")])])],1)],1)],1)],1)],1)],1)],1)])],1),e._v(" "),r("v-layout",{attrs:{column:"",wrap:""}},[r("v-tabs",{attrs:{"icons-and-text":"",centered:"",grow:"",dark:"",color:"cyan"}},[r("v-tabs-slider",{attrs:{color:"red"}}),e._v(" "),r("v-tab",{key:"match"},[e._v("\n          MATCHED ("+e._s(e.source1TotalMatched)+")\n          "),r("v-icon",{attrs:{color:"white",right:""}},[e._v("thumb_up")])],1),e._v(" "),r("v-tab",{key:"nomatch"},[e._v("\n          NO MATCH ("+e._s(e.source1TotalNoMatch)+")\n          "),r("v-icon",{attrs:{color:"white",right:""}},[e._v("thumb_down")])],1),e._v(" "),r("v-tab",{key:"ignore"},[e._v("\n          IGNORED ("+e._s(e.source1TotalIgnore)+")\n          "),r("v-icon",{attrs:{color:"white",right:""}},[e._v("thumb_down")])],1),e._v(" "),r("v-tab",{key:"flagged"},[e._v("\n          FLAGGED ("+e._s(e.totalFlagged)+")\n          "),r("v-icon",{attrs:{color:"white",right:""}},[e._v("notification_important")])],1),e._v(" "),r("v-tab-item",{key:"match"},[null!=e.$store.state.matchedContent?[r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchMatched,callback:function(t){e.searchMatched=t},expression:"searchMatched"}}),e._v(" "),r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.matchedHeaders,items:e.$store.state.matchedContent,search:e.searchMatched},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.source1Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source1Id))]),e._v(" "),r("td",[e._v(e._s(t.item.source2Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source2Id))]),e._v(" "),t.item.matchComments?r("td",[e._v(e._s(t.item.matchComments.join(", ")))]):r("td"),e._v(" "),r("td",["Done"==e.$store.state.recoStatus?r("v-btn",{staticStyle:{"text-transform":"none"},attrs:{disabled:"",color:"error",small:""},on:{click:function(r){return e.breakMatch(t.item.source1Id)}}},[r("v-icon",[e._v("undo")]),e._v("Break Match\n                  ")],1):r("v-btn",{staticStyle:{"text-transform":"none"},attrs:{color:"error",small:""},on:{click:function(r){return e.breakMatch(t.item.source1Id)}}},[r("v-icon",[e._v("undo")]),e._v("Break Match\n                  ")],1)],1)]}}],null,!1,2681565800)})]:[r("v-progress-linear",{attrs:{size:70,indeterminate:"",color:"amber"}})]],2),e._v(" "),r("v-tab-item",{key:"nomatch"},[null!=e.$store.state.noMatchContent?[r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchNotMatched,callback:function(t){e.searchNotMatched=t},expression:"searchNotMatched"}}),e._v(" "),r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.noMatchHeaders,items:e.$store.state.noMatchContent,search:e.searchNotMatched},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.source1Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source1Id))]),e._v(" "),r("td",[e._v(e._s(t.item.parents.join("->")))]),e._v(" "),r("td",["Done"==e.$store.state.recoStatus?r("v-btn",{staticStyle:{"text-transform":"none"},attrs:{disabled:"",color:"error",small:""},on:{click:function(r){return e.breakNoMatch(t.item.source1Id,"nomatch")}}},[r("v-icon",[e._v("cached")]),e._v("Break No Match\n                  ")],1):r("v-btn",{staticStyle:{"text-transform":"none"},attrs:{color:"error",small:""},on:{click:function(r){return e.breakNoMatch(t.item.source1Id,"nomatch")}}},[r("v-icon",[e._v("cached")]),e._v("Break No Match\n                  ")],1)],1)]}}],null,!1,2088410336)})]:[r("v-progress-linear",{attrs:{size:70,indeterminate:"",color:"amber"}})]],2),e._v(" "),r("v-tab-item",{key:"ignore"},[null!=e.$store.state.ignoreContent?[r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchIgnore,callback:function(t){e.searchIgnore=t},expression:"searchIgnore"}}),e._v(" "),r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.noMatchHeaders,items:e.$store.state.ignoreContent,search:e.searchIgnore},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.source1Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source1Id))]),e._v(" "),r("td",[e._v(e._s(t.item.parents.join("->")))]),e._v(" "),r("td",["Done"==e.$store.state.recoStatus?r("v-btn",{staticStyle:{"text-transform":"none"},attrs:{disabled:"",color:"error",small:""},on:{click:function(r){return e.breakNoMatch(t.item.source1Id,"ignore")}}},[r("v-icon",[e._v("cached")]),e._v("Break Ignore\n                  ")],1):r("v-btn",{staticStyle:{"text-transform":"none"},attrs:{color:"error",small:""},on:{click:function(r){return e.breakNoMatch(t.item.source1Id,"ignore")}}},[r("v-icon",[e._v("cached")]),e._v("Break Ignore\n                  ")],1)],1)]}}],null,!1,1084774816)})]:[r("v-progress-linear",{attrs:{size:70,indeterminate:"",color:"amber"}})]],2),e._v(" "),r("v-tab-item",{key:"flagged"},[null!=e.$store.state.flagged?[r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchFlagged,callback:function(t){e.searchFlagged=t},expression:"searchFlagged"}}),e._v(" "),r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.flaggedHeaders,items:e.$store.state.flagged,search:e.searchFlagged},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.source1Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source1Id))]),e._v(" "),r("td",[e._v(e._s(t.item.source2Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source2Id))]),e._v(" "),r("td",[e._v(e._s(t.item.flagComment))]),e._v(" "),r("td",["Done"==e.$store.state.recoStatus?r("v-btn",{staticStyle:{"text-transform":"none"},attrs:{disabled:"",color:"primary",small:""},on:{click:function(r){return e.acceptFlag(t.item.source1Id)}}},[r("v-icon",[e._v("thumb_up")]),e._v("Confirm Match\n                  ")],1):r("v-btn",{staticStyle:{"text-transform":"none"},attrs:{color:"primary",small:""},on:{click:function(r){return e.acceptFlag(t.item.source1Id)}}},[r("v-icon",[e._v("thumb_up")]),e._v("Confirm Match\n                  ")],1),e._v(" "),"Done"==e.$store.state.recoStatus?r("v-btn",{staticStyle:{"text-transform":"none"},attrs:{disabled:"",color:"error",small:""},on:{click:function(r){return e.unFlag(t.item.source1Id)}}},[r("v-icon",[e._v("cached")]),e._v("Release\n                  ")],1):r("v-btn",{staticStyle:{"text-transform":"none"},attrs:{color:"error",small:""},on:{click:function(r){return e.unFlag(t.item.source1Id)}}},[r("v-icon",[e._v("cached")]),e._v("Release\n                  ")],1)],1)]}}],null,!1,1034244941)})]:[r("v-progress-linear",{attrs:{size:70,indeterminate:"",color:"amber"}})]],2)],1)],1),e._v(" "),r("v-layout",["yes"==e.goNextLevel?r("v-flex",{attrs:{xs1:"",sm4:"",md2:""}},[r("v-btn",{attrs:{color:"primary",round:""},on:{click:function(t){return e.levelChanged(e.$store.state.recoLevel+1)}}},[r("v-icon",[e._v("forward")]),e._v("Proceed to "+e._s(e.nextLevelText)+"\n        ")],1)],1):e._e(),e._v(" "),"yes"==e.lastLevelDone?r("v-flex",{attrs:{xs1:"",sm4:"",md2:""}},[r("v-btn",{attrs:{color:"primary",round:""},on:{click:function(t){return e.$router.push({name:"FacilityRecoStatus"})}}},[r("v-icon",[e._v("dashboard")]),e._v("Reconciliation Status\n        ")],1)],1):e._e()],1)],1):e._e()],2)},staticRenderFns:[]};var le=r("VU/8")(ne,ce,!1,function(e){r("mNhd")},null,null).exports,ue={mixins:[g],data:function(){return{helpDialog:!1,matchedHeaders:[{text:"Source 1 Location",value:"source1Name"},{text:"Source 1 ID",value:"source1Id"},{text:"Source 2 Location",value:"source2Name"},{text:"Source 2 ID",value:"source2Id"}],noMatchHeaders:[{text:"Source 1 Location",value:"source1Name"},{text:"Source 1 ID",value:"source1Id"}],notMappedHeaders:[{text:"Source 1 Location",value:"source1Name"},{text:"Source 1 ID",value:"source1Id"}],flaggedHeaders:[{text:"Source 1 Location",value:"source1Name"},{text:"Source 1 ID",value:"source1Id"},{text:"Source 2 Location",value:"source2Name"},{text:"Source 2 ID",value:"source2Id"}],searchMatched:"",mappingData:{},recoLevel:2,mappingStatusDialog:!1,mappingStatusProgressTitle:"Waiting for progress status",mappingStatusProgressPercent:0,locationLevels:[]}},methods:{checkMappingStatusProgress:function(){var e=this,t=this.$store.state.clientId;h.a.get("/progress/mappingStatus/"+t).then(function(t){return null===t.data||void 0===t.data||!1===t.data?(e.mappingStatusDialog=!1,e.mappingStatusProgressTitle="Waiting for progress status",void clearInterval(e.mappingStatusProgressTimer)):null===t.data.status&&null===t.data.error&&null===t.data.percent?(e.mappingStatusDialog=!1,clearInterval(e.mappingStatusProgressTimer),void(e.mappingStatusProgressTitle="Waiting for progress status")):(e.mappingStatusProgressTitle=t.data.status,t.data.percent&&("percent"!==e.progressType&&(e.progressType="percent"),e.mappingStatusProgressPercent=t.data.percent),void("Done"===t.data.status&&(e.clearProgress("mappingStatus"),clearInterval(e.mappingStatusProgressTimer),e.mappingStatusDialog=!1,e.mappingStatusProgressTitle="Waiting for progress status")))}).catch(function(e){console.log(e)})},mappingStatus:function(){var e=this;if(this.source1&&this.source2){this.mappingData={};var t=this.$store.state.clientId,r=this.$store.state.totalSource2Levels,a=this.$store.state.totalSource1Levels,s=this.$store.state.activePair.userID._id,o=this.getDatasourceOwner(),i=o.source1Owner,n=o.source2Owner,c=this.getLimitOrgIdOnActivePair().source1LimitOrgId,l=this.getLimitOrgIdOnActivePair().source2LimitOrgId;this.mappingStatusDialog=!0,this.progressType="indeterminate";var u="/mappingStatus/"+this.source1+"/"+this.source2+"/"+i+"/"+n+"/"+this.recoLevel+"/"+r+"/"+a+"/"+t+"/"+s+"?source1LimitOrgId="+c+"&source2LimitOrgId="+l;h.a.get(""+u).then(function(t){e.mappingData=t.data}),this.mappingStatusProgressTimer=setInterval(this.checkMappingStatusProgress,500)}},levelChanged:function(e){this.recoLevel=e,this.mappingStatus()},markRecoDone:function(){var e=this;this.$store.state.progressTitle="Marking reconciliation as Done",this.$store.state.dynamicProgress=!0;var t=this.$store.state.activePair.userID._id;h.a.get("/markRecoDone/"+this.source1+"/"+this.source2+"/"+t).then(function(t){e.$store.state.dynamicProgress=!1,t.data.status&&(e.$store.state.recoStatus=t.data.status),e.$store.state.errorTitle="Reconciliation Done",e.$store.state.errorDescription="Reconciliation is complete, more changes can be done now",e.$store.state.errorColor="primary",e.$store.state.dialogError=!0}).catch(function(t){e.$store.state.dynamicProgress=!1,console.log(t.response.data.error)})},markRecoUnDone:function(){var e=this,t=this.$store.state.activePair.userID._id;this.$store.state.progressTitle="Marking reconciliation as Un Done",this.$store.state.dynamicProgress=!0,h.a.get("/markRecoUnDone/"+this.source1+"/"+this.source2+"/"+t).then(function(t){e.$store.state.dynamicProgress=!1,t.data.status&&(e.$store.state.recoStatus=t.data.status),e.$store.state.errorTitle="Reconciliation on progress",e.$store.state.errorDescription="You may continue doing reconciliation now",e.$store.state.errorColor="primary",e.$store.state.dialogError=!0}).catch(function(t){e.$store.state.dynamicProgress=!1,console.log(t.response.data.error)})}},computed:{currentLevelText:function(){return this.translateDataHeader("source1",this.recoLevel-1)},source1:function(){var e=this.$store.state.activePair.source1.name;return e&&(e=this.toTitleCase(e)),e},source2:function(){var e=this.$store.state.activePair.source2.name;return e&&(e=this.toTitleCase(e)),e},source1PercentMapped:function(){return 0===this.$store.state.source1TotalAllRecords?0:parseFloat((100*this.$store.state.totalAllMapped/this.$store.state.source1TotalAllRecords).toFixed(2))},source1PercentMappedLevel:function(){return 0===this.totalRecords?0:parseFloat((100*this.totalMapped/this.totalRecords).toFixed(2))},source1PercentNoMatch:function(){return 0===this.$store.state.source1TotalAllRecords?0:parseFloat((100*this.$store.state.totalAllNoMatch/this.$store.state.source1TotalAllRecords).toFixed(2))},source1PercentIgnore:function(){return 0===this.$store.state.source1TotalAllRecords?0:parseFloat((100*this.$store.state.totalAllIgnore/this.$store.state.source1TotalAllRecords).toFixed(2))},source1PercentNoMatchLevel:function(){return 0===this.totalRecords?0:parseFloat((100*this.totalNoMatch/this.totalRecords).toFixed(2))},source1PercentIgnoreLevel:function(){return 0===this.totalRecords?0:parseFloat((100*this.totalIgnore/this.totalRecords).toFixed(2))},source1PercentFlagged:function(){return 0===this.$store.state.source1TotalAllRecords?0:parseFloat((100*this.$store.state.totalAllFlagged/this.$store.state.source1TotalAllRecords).toFixed(2))},source1PercentFlaggedLevel:function(){return 0===this.totalRecords?0:parseFloat((100*this.totalFlagged/this.totalRecords).toFixed(2))},source1PercentNotMapped:function(){return 0===this.$store.state.source1TotalAllRecords?0:parseFloat((100*this.$store.state.source1TotalAllNotMapped/this.$store.state.source1TotalAllRecords).toFixed(2))},source1PercentNotMappedLevel:function(){return 0===this.totalRecords?0:parseFloat((100*this.totalNotMapped/this.totalRecords).toFixed(2))},source2PercentFlagged:function(){return 0===this.$store.state.source2TotalAllRecords?0:parseFloat((100*this.$store.state.totalAllFlagged/this.$store.state.source2TotalAllRecords).toFixed(2))},source2PercentMapped:function(){return 0===this.$store.state.source2TotalAllRecords?0:parseFloat((100*this.$store.state.totalAllMapped/this.$store.state.source2TotalAllRecords).toFixed(2))},totalMapped:function(){return this.mappingData&&this.mappingData.hasOwnProperty("mapped")?this.mappingData.mapped.length:0},totalNotMapped:function(){return this.mappingData&&this.mappingData.hasOwnProperty("notMapped")?this.mappingData.notMapped.length:0},totalNoMatch:function(){return this.mappingData&&this.mappingData.hasOwnProperty("noMatch")?this.mappingData.noMatch.length:0},totalIgnore:function(){return this.mappingData&&this.mappingData.hasOwnProperty("ignore")?this.mappingData.ignore.length:0},totalFlagged:function(){return this.mappingData&&this.mappingData.hasOwnProperty("flagged")?this.mappingData.flagged.length:0},totalRecords:function(){return this.totalMapped+this.totalNotMapped+this.totalNoMatch+this.totalIgnore+this.totalFlagged}},components:{appRecoExport:ie},created:function(){this.mappingStatus();for(var e=1;e<this.$store.state.totalSource1Levels;e++){var t=this.translateDataHeader("source1",e);this.locationLevels.push({text:t,value:e+1})}}},de={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{fluid:""}},[r("v-dialog",{attrs:{transition:"scale-transition","hide-overlay":"",persistent:"",width:"350"},model:{value:e.mappingStatusDialog,callback:function(t){e.mappingStatusDialog=t},expression:"mappingStatusDialog"}},[r("v-card",{attrs:{color:"white",dark:""}},[r("v-card-text",[r("center",[r("font",{staticStyle:{color:"blue"}},[e._v(e._s(e.mappingStatusProgressTitle))]),r("br"),e._v(" "),"percent"==e.progressType?r("v-progress-circular",{attrs:{rotate:-90,size:100,width:15,value:e.mappingStatusProgressPercent,color:"primary"}},[r("v-avatar",{attrs:{color:"indigo",size:"50px"}},[r("span",{staticClass:"white--text"},[r("b",[e._v(e._s(e.mappingStatusProgressPercent)+"%")])])])],1):e._e(),e._v(" "),"indeterminate"==e.progressType?r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"red"}}):e._e()],1)],1)],1)],1),e._v(" "),r("v-layout",{attrs:{column:""}},[r("v-dialog",{attrs:{scrollable:"",persistent:"",overlay:!1,"max-width":"700px",transition:"dialog-transition"},model:{value:e.helpDialog,callback:function(t){e.helpDialog=t},expression:"helpDialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[r("v-icon",[e._v("info")]),e._v(" About this page\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.helpDialog=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[e._v("\n          This page let you visualize the mapping status for various levels\n          "),r("v-list",[e._v("\n            1. Right boxes shows reconciliation status for a selected level\n          ")]),e._v(" "),r("v-list",[e._v("\n            2. Left boxes shows reconciliation status for a all levels\n          ")]),e._v(" "),r("v-list",[e._v("\n            3. The search box let you search locations for a selected level only\n          ")])],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:"","text-xs-right":""}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs3:""}},[r("appRecoExport")],1),e._v(" "),r("v-flex",{attrs:{xs9:""}},[r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",flat:"",icon:"",color:"primary"},on:{click:function(t){e.helpDialog=!0}},slot:"activator"},[r("v-icon",[e._v("help")])],1),e._v(" "),r("span",[e._v("Help")])],1)],1)],1)],1)],1),e._v(" "),r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:""}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs6:""}},[r("b",[e._v("All Levels")])]),e._v(" "),r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs3:""}},[r("b",[e._v(e._s(e.currentLevelText)+" Only")])])],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs1:""}},[r("v-chip",{staticStyle:{height:"138px",width:"137px"},attrs:{color:"green","text-color":"white"}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:""}},[r("b",[e._v("Source 1 Matched")])]),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("b",[e._v(e._s(e.$store.state.totalAllMapped)+"/"+e._s(e.$store.state.source1TotalAllRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source1PercentMapped,color:"yellow"}},[r("font",{attrs:{color:"white"}},[r("b",[e._v(e._s(e.source1PercentMapped)+"%")])])],1)],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-chip",{staticStyle:{height:"138px",width:"137px"},attrs:{color:"green","text-color":"white"}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:""}},[r("b",[e._v("Source 1 No Match")])]),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("b",[e._v(e._s(e.$store.state.totalAllNoMatch)+"/"+e._s(e.$store.state.source1TotalAllRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source1PercentNoMatch,color:"yellow"}},[r("font",{attrs:{color:"white"}},[r("b",[e._v(e._s(e.source1PercentNoMatch)+"%")])])],1)],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-chip",{staticStyle:{height:"138px",width:"137px"},attrs:{color:"green","text-color":"white"}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:""}},[r("b",[e._v("Source 1 Flagged")])]),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("b",[e._v(e._s(e.$store.state.totalAllFlagged)+"/"+e._s(e.$store.state.source1TotalAllRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source1PercentFlagged,color:"yellow"}},[r("font",{attrs:{color:"white"}},[r("b",[e._v(e._s(e.source1PercentFlagged)+"%")])])],1)],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-chip",{staticStyle:{height:"138px",width:"137px"},attrs:{color:"green","text-color":"white"}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:""}},[r("b",[e._v("Source 2 Matched")])]),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("b",[e._v(e._s(e.$store.state.totalAllMapped)+"/"+e._s(e.$store.state.source2TotalAllRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source2PercentMapped,color:"green"}},[r("font",{attrs:{color:"white"}},[r("b",[e._v(e._s(e.source2PercentMapped)+"%")])])],1)],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-chip",{staticStyle:{height:"138px",width:"137px"},attrs:{color:"green","text-color":"white"}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:""}},[r("b",[e._v("Source 2 Flagged")])]),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("b",[e._v(e._s(e.$store.state.totalAllFlagged)+"/"+e._s(e.$store.state.source2TotalAllRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source2PercentFlagged,color:"yellow"}},[r("font",{attrs:{color:"white"}},[r("b",[e._v(e._s(e.source2PercentFlagged)+"%")])])],1)],1)],1)],1)],1)],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-chip",{staticStyle:{height:"138px",width:"137px"},attrs:{color:"cyan","text-color":"black"}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:""}},[r("b",[e._v("Source 1 Matched")])]),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("b",[e._v(e._s(e.totalMapped)+"/"+e._s(e.totalRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source1PercentMappedLevel,color:"yellow"}},[r("font",{attrs:{color:"black"}},[r("b",[e._v(e._s(e.source1PercentMappedLevel)+"%")])])],1)],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-chip",{staticStyle:{height:"138px",width:"137px"},attrs:{color:"cyan","text-color":"black"}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:""}},[r("b",[e._v("Source 1 No Match")])]),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("b",[e._v(e._s(e.totalNoMatch)+"/"+e._s(e.totalRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source1PercentNoMatchLevel,color:"yellow"}},[r("font",{attrs:{color:"black"}},[r("b",[e._v(e._s(e.source1PercentNoMatchLevel)+"%")])])],1)],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-chip",{staticStyle:{height:"138px",width:"137px"},attrs:{color:"cyan","text-color":"black"}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:""}},[r("b",[e._v("Source 1 Flagged")])]),e._v(" "),r("v-flex",{attrs:{xs1:"","align-center":""}},[r("center",[r("b",[e._v(e._s(e.totalFlagged)+"/"+e._s(e.totalRecords))])])],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("center",[r("v-progress-circular",{attrs:{rotate:-90,size:65,width:8,value:e.source1PercentFlagged,color:"yellow"}},[r("font",{attrs:{color:"black"}},[r("b",[e._v(e._s(e.source1PercentFlagged)+"%")])])],1)],1)],1)],1)],1)],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs3:""}},[r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchMatched,callback:function(t){e.searchMatched=t},expression:"searchMatched"}})],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs2:""}},[e.$store.state.activePair.userID._id===e.$store.state.auth.userID?["Done"!==e.$store.state.recoStatus?r("v-btn",{attrs:{color:"success",round:""},on:{click:e.markRecoDone}},[r("v-icon",[e._v("lock")]),e._v("Mark Reconciliation As Done\n            ")],1):e._e(),e._v(" "),"Done"===e.$store.state.recoStatus&&"Admin"==e.$store.state.auth.role?r("v-btn",{attrs:{color:"success",round:""},on:{click:e.markRecoUnDone}},[r("v-icon",[e._v("lock_open")]),e._v("Mark Reconciliation As UnDone\n            ")],1):e._e()]:e._e()],2),e._v(" "),r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs1:"",sm2:"",md2:"",right:""}},[r("v-select",{staticClass:"input-group--focused",attrs:{items:e.locationLevels,"item-value":e.locationLevels.value,"item-name":e.locationLevels.text,label:"Level",height:"1","full-width":"","single-line":""},on:{change:e.levelChanged},model:{value:e.recoLevel,callback:function(t){e.recoLevel=t},expression:"recoLevel"}})],1)],1)],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-tabs",{attrs:{"icons-and-text":"",centered:"",grow:"",dark:"",color:"cyan"}},[r("v-tabs-slider",{attrs:{color:"red"}}),e._v(" "),r("v-tab",{key:"match"},[e._v("\n          MATCHED ("+e._s(e.totalMapped)+")\n          "),r("v-icon",{attrs:{color:"white",right:""}},[e._v("thumb_up")])],1),e._v(" "),r("v-tab",{key:"notMapped"},[e._v("\n          Source 1 Not Mapped ("+e._s(e.totalNotMapped)+")\n          "),r("v-icon",{attrs:{color:"white",right:""}},[e._v("thumb_down")])],1),e._v(" "),r("v-tab",{key:"nomatch"},[e._v("\n          Source 1 NO MATCH ("+e._s(e.totalNoMatch)+")\n          "),r("v-icon",{attrs:{color:"white",right:""}},[e._v("thumb_down")])],1),e._v(" "),r("v-tab",{key:"ignore"},[e._v("\n          Source 1 IGNORED ("+e._s(e.totalIgnore)+")\n          "),r("v-icon",{attrs:{color:"white",right:""}},[e._v("thumb_down")])],1),e._v(" "),r("v-tab",{key:"flagged"},[e._v("\n          FLAGGED ("+e._s(e.totalFlagged)+")\n          "),r("v-icon",{attrs:{color:"white",right:""}},[e._v("notification_important")])],1),e._v(" "),r("v-tab-item",{key:"match"},[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.matchedHeaders,items:e.mappingData.mapped,search:e.searchMatched},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.source1Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source1Id))]),e._v(" "),r("td",[e._v(e._s(t.item.source2Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source2Id))])]}}])})],1),e._v(" "),r("v-tab-item",{key:"notMapped"},[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.notMappedHeaders,items:e.mappingData.notMapped,search:e.searchMatched},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.source1Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source1Id))])]}}])})],1),e._v(" "),r("v-tab-item",{key:"nomatch"},[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.noMatchHeaders,items:e.mappingData.noMatch,search:e.searchMatched},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.source1Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source1Id))])]}}])})],1),e._v(" "),r("v-tab-item",{key:"ignore"},[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.noMatchHeaders,items:e.mappingData.ignore,search:e.searchMatched},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.source1Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source1Id))])]}}])})],1),e._v(" "),r("v-tab-item",{key:"flagged"},[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.flaggedHeaders,items:e.mappingData.flagged,search:e.searchMatched},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.source1Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source1Id))]),e._v(" "),r("td",[e._v(e._s(t.item.source2Name))]),e._v(" "),r("td",[e._v(e._s(t.item.source2Id))])]}}])})],1)],1)],1)],1)],1)},staticRenderFns:[]},ve=r("VU/8")(ue,de,!1,null,null,null).exports,he={data:function(){return{dialog:!1,restoreDialog:!1,alertTitle:"",alertText:"",archives:[],selectedArchive:"",header:[{sortable:!1},{text:"Archive Name",value:"archiveName"}]}},methods:{getArchives:function(){var e=this,t=this.$store.state.orgUnit;h.a.get("/getArchives/"+t.OrgId).then(function(t){e.archives=t.data,0===e.archives.length?e.$store.state.showArchives=!1:e.$store.state.showArchives=!0})},restoreArchive:function(){var e=this;if(""===this.selectedArchive)this.alertTitle="Error",this.alertText="Select an archive to restored",this.dialog=!0;else{this.restoreDialog=!0;var t=this.$store.state.orgUnit,r=new FormData;r.append("archive",this.selectedArchive),h.a.post("/restoreArchive/"+t.OrgId,r,{headers:{"Content-Type":"multipart/form-data"}}).then(function(){e.restoreDialog=!1,tt.$emit("refreshApp"),e.getArchives(),e.selectedArchive=""}).catch(function(t){e.restoreDialog=!1,e.$store.state.dialogError=!0,e.$store.state.errorTitle="Error",e.$store.state.errorDescription=t.response.data.error,console.log(t.response.data.error)})}}},created:function(){this.getArchives()}},pe={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{fluid:""}},[e.$store.state.uploadRunning?[r("br"),r("br"),r("br"),e._v(" "),r("v-alert",{attrs:{type:"info",value:!0}},[r("b",[e._v("Wait for upload to finish ...")]),e._v(" "),r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)]:e._e(),e._v(" "),0==e.archives.length?[r("br"),r("br"),r("br"),e._v(" "),r("v-alert",{attrs:{type:"info",value:!0}},[r("b",[e._v("No archived upload ...")])])]:e._e(),e._v(" "),[r("v-container",{attrs:{"grid-list-lg":""}},[r("v-dialog",{attrs:{"hide-overlay":"",persistent:"",width:"300"},model:{value:e.restoreDialog,callback:function(t){e.restoreDialog=t},expression:"restoreDialog"}},[r("v-card",{attrs:{color:"primary",dark:""}},[r("v-card-text",[e._v("\n            Restoring\n            "),r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",width:"500px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-card",[r("v-card-title",[e._v("\n            "+e._s(e.alertTitle)+"\n          ")]),e._v(" "),r("v-card-text",[e._v("\n            "+e._s(e.alertText)+"\n          ")]),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"success"},on:{click:function(t){e.dialog=!1}}},[e._v("OK")])],1)],1)],1),e._v(" "),e.archives.length>0?r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs12:"",sm12:"",md12:"","child-flex":""}},[r("v-card",{attrs:{color:"green lighten-4"}},[r("v-card-title",{staticStyle:{color:"black"},attrs:{"primary-title":""}},[e._v("\n              Archived Uploads\n            ")]),e._v(" "),r("v-card-text",[r("v-data-table",{staticClass:"elevation-1",staticStyle:{color:"red"},attrs:{headers:e.header,items:e.archives,"hide-actions":""},scopedSlots:e._u([{key:"items",fn:function(t){return[r("tr",[r("v-radio-group",{staticStyle:{height:"5px"},attrs:{color:"red"},model:{value:e.selectedArchive,callback:function(t){e.selectedArchive=t},expression:"selectedArchive"}},[r("td",[r("v-radio",{attrs:{value:t.item,color:"red"}})],1)]),e._v(" "),r("td",[e._v(e._s(t.item))])],1)]}}],null,!1,1011195848)})],1),e._v(" "),r("v-card-actions",{staticStyle:{float:"center"}},[r("v-btn",{attrs:{color:"error",dark:""},nativeOn:{click:function(t){return e.restoreArchive(t)}}},[r("v-icon",{attrs:{left:""}},[e._v("cached")]),e._v("Restore")],1)],1)],1)],1)],1):e._e()],1)]],2)},staticRenderFns:[]};var ge=r("VU/8")(he,pe,!1,function(e){r("VPxq")},null,null).exports,fe=r("gRE1"),me=r.n(fe),_e={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{"grid-list-xs":""}},[r("v-dialog",{attrs:{scrollable:"",persistent:"",overlay:!1,"max-width":"770px",transition:"dialog-transition"},model:{value:e.datasetLimit,callback:function(t){e.datasetLimit=t},expression:"datasetLimit"}},[r("v-card",[r("v-toolbar",{attrs:{color:"error",dark:""}},[r("v-toolbar-title",[r("v-icon",[e._v("info")]),e._v(" Datasets limit Warning\n        ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.datasetLimit=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[e._v("\n        You cant add more datasets as you have reached the datasets limit, contact system administrator for help\n      ")]),e._v(" "),r("v-card-actions",[r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"primary"},nativeOn:{click:function(t){e.datasetLimit=!1}}},[e._v("Ok")])],1)],1)],1)],1)},staticRenderFns:[]},$e=r("VU/8")({props:["datasetLimitWarn"],computed:{datasetLimit:{get:function(){return this.datasetLimitWarn},set:function(e){this.$emit("limitWarnStateChange",e)}}}},_e,!1,null,null,null).exports,Se={data:function(){return{name:"",host:"",username:"",password:"",sourceType:"",limitShareByOrgId:!1,shareWithAll:!1,shareToSameOrgid:!0,invalidCharacters:['"',"/","\\","."]}},methods:{sharingOptions:function(){this.shareWithAll&&(this.shareToSameOrgid=!1)},addDataSource:function(e){var t=this,r=new FormData,a=this.$store.state.clientId;r.append("host",this.host),r.append("sourceType",this.sourceType),r.append("source",e),r.append("orgId",this.$store.state.dhis.user.orgId),r.append("shareToSameOrgid",this.shareToSameOrgid),r.append("shareToAll",this.shareWithAll),r.append("limitByUserLocation",this.limitShareByOrgId),r.append("username",this.username),r.append("password",this.password),r.append("name",this.name),r.append("clientId",a),r.append("userID",this.$store.state.auth.userID);var s=this.$store.state.dataSources.find(function(e){return e.host===t.host});h.a.post("/addDataSource",r,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){tt.$emit("dataSourceSaved"),tt.$emit("dataSourceAddedSuccessfully"),tt.$emit("getDataSources"),s?(s.name=t.name,s.username=t.username,s.password=e.data.password,s.sourceType=t.sourceType):t.$store.state.dataSources.push({name:t.name,host:t.host,sourceType:t.sourceType,source:"syncServer",username:t.username,password:e.data.password})}).catch(function(e){console.log(e),tt.$emit("remoteServerFailedAdd")})}}},xe={mixins:[Se,p],data:function(){return{datasetLimitWarn:!1,errorDialog:!1,errorTitle:"",errorContent:"",dialog:!1,fileUploadPercentage:"",percentDialog:!1,uploadPrepaProgr:!1,UploadProgressTimer:"",uploadStatus:"1/3 Uploading CSV to the server",uploadPercent:null,uploadName:"",uploadNameErrors:[],confirmUpload:!1,confirmTitle:"",confirmMsg:"",file:"",uploadedFileName:"",e1:0,facility:null,code:null,lat:null,long:null,level1:null,level2:null,level3:null,level4:null,level5:null,level6:null,level7:null,showLevel3:!1,showLevel4:!1,showLevel5:!1,showLevel6:!1,showLevel7:!1,uploadedHeaders:[],mappedHeaders:[],invalidRowsHeader:[],invalidRowsContent:[],invalidRows:!1,valid:!1}},validations:{facility:{required:w.required},code:{required:w.required},uploadName:{required:w.required}},methods:{fileSelected:function(e){this.uploadedFileName=e.target.files[0].name,"text/csv"===e.target.files[0].type||"application/vnd.ms-excel"===e.target.files[0].type&&"csv"===e.target.files[0].name.slice(-3).toLowerCase()||(this.errorDialog=!0,this.errorTitle="Error",this.errorContent="Wrong file type uploaded,Only CSV format is supported",this.uploadedFileName=""),this.file=e.target.files[0];var t=new FileReader;t.addEventListener("load",function(){for(var e=t.result,r=e.byteLength,a=new Uint8Array(e,0),s="",o=0;o<r;o++){var i=String.fromCharCode(a[o]);if(null===i.match(/[^\r\n]+/g))break;s+=i}this.uploadedHeaders=s.split(",")}.bind(this),!1),t.readAsArrayBuffer(e.target.files[0])},ensureNameUnique:function(){if(this.uploadNameErrors=[],""===this.uploadName)return this.uploadNameErrors.push("Upload name is required");if(this.uploadName.length>35)return this.uploadNameErrors.push("Name must not exceed 35 characters");var e=!0,t=!1,r=void 0;try{for(var a,s=n()(this.invalidCharacters);!(e=(a=s.next()).done);e=!0){var o=a.value;if(-1!==this.uploadName.indexOf(o))return this.uploadNameErrors.push("Name is invalid")}}catch(e){t=!0,r=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw r}}var i=!0,c=!1,l=void 0;try{for(var u,d=n()(this.$store.state.dataSources);!(i=(u=d.next()).done);i=!0){if(u.value.name===this.uploadName)return this.uploadNameErrors.push("This Name Exists"),!1}}catch(e){c=!0,l=e}finally{try{!i&&d.return&&d.return()}finally{if(c)throw l}}},confirmSubmit:function(){this.confirmUpload=!0},checkUploadProgress:function(){var e=this,t=this.$store.state.clientId;h.a.get("/progress/uploadProgress/"+t).then(function(t){return t.data&&(t.data.status||t.data.percent||t.data.error)?null!==t.data.error?(e.$store.state.uploadRunning=!1,e.uploadPrepaProgr=!1,e.percentDialog=!1,e.$store.state.dialogError=!0,e.$store.state.errorTitle="Error",e.$store.state.errorDescription=t.data.error,clearInterval(e.UploadProgressTimer),void console.log(t.data.error)):(e.uploadStatus=t.data.status,t.data.percent&&(e.percentDialog||(e.uploadPrepaProgr=!1,e.percentDialog=!0),e.uploadPercent=t.data.percent),void(("Done"===t.data.status||t.data.status>=100)&&(e.clearProgress("uploadProgress"),e.addDataSource("upload"),clearInterval(e.UploadProgressTimer),e.$store.state.recoLevel=2,e.percentDialog=!1,e.dialog=!0,e.$store.state.uploadRunning=!1))):(e.$store.state.uploadRunning=!1,e.uploadPrepaProgr=!1,e.percentDialog=!1,e.$store.state.errorTitle="An error has occured",e.$store.state.errorDescription="You should delete this data source from view data source page then re-upload",e.$store.state.errorColor="error",e.$store.state.dialogError=!0,void clearInterval(e.UploadProgressTimer))}).catch(function(e){console.log(e)})},performExtraCheck:function(){var e=this;this.$store.state.dynamicProgress=!0,this.$store.state.progressTitle="Performing extra validations",this.getGeneralConfig(function(){e.datasetLimitWarn=!1,e.$store.state.dynamicProgress=!1,e.canAddDataset?e.submitCSV():(e.confirmUpload=!1,e.datasetLimitWarn=!0)})},submitCSV:function(){var e=this,t=new FormData;t.append("file",this.file),t.append("csvName",this.uploadName),t.append("facility",this.facility),t.append("code",this.code),t.append("lat",this.lat),t.append("long",this.long),t.append("level1",this.level1),t.append("level2",this.level2),t.append("level3",this.level3),t.append("level4",this.level4),t.append("level5",this.level5),t.append("level6",this.level6),t.append("level7",this.level7),t.append("clientId",this.$store.state.clientId),t.append("userID",this.$store.state.auth.userID),this.confirmUpload=!1,this.$store.state.uploadRunning=!0,this.uploadPrepaProgr=!0,this.host="",this.sourceType="upload",this.username="",this.password="",this.name=this.uploadName,h.a.post("/uploadCSV",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){this.fileUploadPercentage=parseInt(Math.round(100*e.loaded/e.total)),100===this.fileUploadPercentage&&(this.fileUploadPercentage="",this.uploadStatus="2/3 Validating CSV Data")}.bind(this)}).then(function(t){e.UploadProgressTimer=setInterval(e.checkUploadProgress,1e3)}).catch(function(t){if(Array.isArray(t.response.data.error)){e.invalidRows=!0;for(var r=0;r<t.response.data.error.length;r++){if(0===r){var a=d()(t.response.data.error[r].data),s=!0,o=!1,i=void 0;try{for(var c,l=n()(a);!(s=(c=l.next()).done);s=!0){var u=c.value;e.invalidRowsHeader.push({text:u,value:u})}}catch(t){o=!0,i=t}finally{try{!s&&l.return&&l.return()}finally{if(o)throw i}}e.invalidRowsHeader.push({text:"Reason",value:"reason"})}var v=me()(t.response.data.error[r].data),h={};for(var p in v)h[e.invalidRowsHeader[p].value]=v[p];h.reason=t.response.data.error[r].reason,e.invalidRowsContent.push(h)}}else e.$store.state.dialogError=!0,e.$store.state.errorTitle="Error",e.$store.state.errorDescription=t.response.data.error+". Reload page and retry";e.$store.state.uploadRunning=!1,e.uploadPrepaProgr=!1,e.percentDialog=!1,clearInterval(e.UploadProgressTimer)})},closeInvalidRows:function(){this.invalidRows=!1,this.invalidRowsHeader=[],this.invalidRowsContent=[],this.e1=1},closeDialog:function(e){this.$router.push({name:e}),this.dialog=!1},closeUploadWindow:function(){tt.$emit("dataSourceSaved")},showMoreLevel:function(){this.showLevel3?this.showLevel4?this.showLevel5?this.showLevel6?this.showLevel7||(this.showLevel7=!0):this.showLevel6=!0:this.showLevel5=!0:this.showLevel4=!0:this.showLevel3=!0}},components:{appDialogs:$e},computed:{uploadNameErrorsss:function(){var e=[];return this.$v.uploadName.$dirty?(!this.$v.uploadName.required&&e.push("Upload Name is required"),e):e},facilityErrors:function(){var e=[];return this.$v.facility.$dirty?(!this.$v.facility.required&&e.push("Facility is required"),e):e},codeErrors:function(){var e=[];return this.$v.code.$dirty?(!this.$v.code.required&&e.push("Code is required"),e):e},filteredItemFacility:function(){var e=this;return this.uploadedHeaders.filter(function(t){return t!==e.code&&t!==e.lat&&t!==e.long&&t!==e.level1&&t!==e.level2&&t!==e.level3&&t!==e.level4&&t!==e.level5&&t!==e.level6&&t!==e.level7})},filteredItemCode:function(){var e=this;return this.uploadedHeaders.filter(function(t){return t!==e.facility&&t!==e.lat&&t!==e.long&&t!==e.level1&&t!==e.level2&&t!==e.level3&&t!==e.level4&&t!==e.level5&&t!==e.level6&&t!==e.level7})},filteredItemLat:function(){var e=this;return this.uploadedHeaders.filter(function(t){return t!==e.facility&&t!==e.code&&t!==e.long&&t!==e.level1&&t!==e.level2&&t!==e.level3&&t!==e.level4&&t!==e.level5&&t!==e.level6&&t!==e.level7})},filteredItemLong:function(){var e=this;return this.uploadedHeaders.filter(function(t){return t!==e.facility&&t!==e.code&&t!==e.lat&&t!==e.level1&&t!==e.level2&&t!==e.level3&&t!==e.level4&&t!==e.level5&&t!==e.level6&&t!==e.level7})},filteredItemLevel1:function(){var e=this;return this.uploadedHeaders.filter(function(t){return t!==e.facility&&t!==e.code&&t!==e.lat&&t!==e.long&&t!==e.level2&&t!==e.level3&&t!==e.level4&&t!==e.level5&&t!==e.level6&&t!==e.level7})},filteredItemLevel2:function(){var e=this;return this.uploadedHeaders.filter(function(t){return t!==e.facility&&t!==e.code&&t!==e.lat&&t!==e.long&&t!==e.level1&&t!==e.level3&&t!==e.level4&&t!==e.level5&&t!==e.level6&&t!==e.level7})},filteredItemLevel3:function(){var e=this;return this.uploadedHeaders.filter(function(t){return t!==e.facility&&t!==e.code&&t!==e.lat&&t!==e.long&&t!==e.level1&&t!==e.level2&&t!==e.level4&&t!==e.level5&&t!==e.level6&&t!==e.level7})},filteredItemLevel4:function(){var e=this;return this.uploadedHeaders.filter(function(t){return t!==e.facility&&t!==e.code&&t!==e.lat&&t!==e.long&&t!==e.level1&&t!==e.level2&&t!==e.level3&&t!==e.level5&&t!==e.level6&&t!==e.level7})},filteredItemLevel5:function(){var e=this;return this.uploadedHeaders.filter(function(t){return t!==e.facility&&t!==e.code&&t!==e.lat&&t!==e.long&&t!==e.level1&&t!==e.level2&&t!==e.level3&&t!==e.level4&&t!==e.level6&&t!==e.level7})},filteredItemLevel6:function(){var e=this;return this.uploadedHeaders.filter(function(t){return t!==e.facility&&t!==e.code&&t!==e.lat&&t!==e.long&&t!==e.level1&&t!==e.level2&&t!==e.level3&&t!==e.level4&&t!==e.level5&&t!==e.level7})},filteredItemLevel7:function(){var e=this;return this.uploadedHeaders.filter(function(t){return t!==e.facility&&t!==e.code&&t!==e.lat&&t!==e.long&&t!==e.level1&&t!==e.level2&&t!==e.level3&&t!==e.level4&&t!==e.level5&&t!==e.level6})}},created:function(){this.$store.state.uploadProgressData.percentDialog&&(this.percentDialog=this.$store.state.uploadProgressData.percentDialog),this.$store.state.uploadProgressData.uploadPrepaProgr&&(this.uploadPrepaProgr=this.$store.state.uploadProgressData.uploadPrepaProgr),this.$store.state.uploadProgressData.UploadProgressTimer&&(this.UploadProgressTimer=this.$store.state.uploadProgressData.UploadProgressTimer),this.$store.state.uploadProgressData.uploadStatus&&(this.uploadStatus=this.$store.state.uploadProgressData.uploadStatus),this.$store.state.uploadProgressData.uploadPercent&&(this.uploadPercent=this.$store.state.uploadProgressData.uploadPercent),(this.percentDialog||this.uploadPrepaProgr)&&(this.UploadProgressTimer=setInterval(this.checkUploadProgress,1e3))},destroyed:function(){this.$store.state.uploadProgressData.dialog=this.dialog,this.$store.state.uploadProgressData.percentDialog=this.percentDialog,this.$store.state.uploadProgressData.uploadPrepaProgr=this.uploadPrepaProgr,this.$store.state.uploadProgressData.UploadProgressTimer=this.UploadProgressTimer,this.$store.state.uploadProgressData.uploadStatus=this.uploadStatus,this.$store.state.uploadProgressData.uploadPercent=this.uploadPercent,clearInterval(this.checkUploadProgress)}},ye={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{fluid:""}},[r("v-dialog",{attrs:{persistent:"",transition:"scale-transition","max-width":"500px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n          Information\n        ")])],1),e._v(" "),r("v-card-text",[e._v("\n        Data uploaded successfully\n      ")]),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"primary",dark:""},nativeOn:{click:function(t){return e.closeDialog("FacilityReconView")}}},[r("v-icon",{attrs:{left:""}},[e._v("list")]),e._v("\n          View Data\n        ")],1)],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",transition:"scale-transition","max-width":"1050px"},model:{value:e.invalidRows,callback:function(t){e.invalidRows=t},expression:"invalidRows"}},[r("v-card",[r("v-toolbar",{attrs:{color:"error",dark:""}},[r("v-toolbar-title",[r("v-icon",[e._v("error")]),e._v("Data Upload was not successful,review below invalid rows in your CSV\n        ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){return e.closeInvalidRows()}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.invalidRowsHeader,items:e.invalidRowsContent,light:""},scopedSlots:e._u([{key:"items",fn:function(t){return e._l(e.invalidRowsHeader,function(a){return r("td",[e._v(e._s(t.item[a.value]))])})}}])})],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",transition:"scale-transition","max-width":"500px"},model:{value:e.confirmUpload,callback:function(t){e.confirmUpload=t},expression:"confirmUpload"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n          Warning\n        ")])],1),e._v(" "),r("v-card-text",[e._v("\n        You are about to upload CSV data into the app, click proceed to upload\n      ")]),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"error"},nativeOn:{click:function(t){e.confirmUpload=!1}}},[e._v("Cancel")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"primary",dark:""},nativeOn:{click:function(t){return e.performExtraCheck(t)}}},[e._v("Proceed")])],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",transition:"scale-transition","max-width":"500px"},model:{value:e.errorDialog,callback:function(t){e.errorDialog=t},expression:"errorDialog"}},[r("v-card",[r("v-card-title",[e._v("\n        "+e._s(e.errorTitle)+"\n      ")]),e._v(" "),r("v-card-text",[e._v("\n        "+e._s(e.errorContent)+"\n      ")]),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"error"},nativeOn:{click:function(t){e.errorDialog=!1}}},[e._v("Ok")])],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{transition:"scale-transition",persistent:"",width:"300"},model:{value:e.uploadPrepaProgr,callback:function(t){e.uploadPrepaProgr=t},expression:"uploadPrepaProgr"}},[r("v-card",{attrs:{color:"primary",dark:""}},[r("v-card-text",[e._v("\n        "+e._s(e.uploadStatus)+"\n        "),e.fileUploadPercentage?r("v-progress-linear",{staticClass:"mb-0",attrs:{color:"white"},model:{value:e.fileUploadPercentage,callback:function(t){e.fileUploadPercentage=t},expression:"fileUploadPercentage"}}):r("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{transition:"scale-transition",persistent:"",width:"270"},model:{value:e.percentDialog,callback:function(t){e.percentDialog=t},expression:"percentDialog"}},[r("v-card",{attrs:{color:"white",dark:""}},[r("v-card-text",[r("center",[r("font",{staticStyle:{color:"blue"}},[e._v(e._s(e.uploadStatus))]),r("br"),e._v(" "),r("v-progress-circular",{attrs:{rotate:-90,size:100,width:15,value:e.uploadPercent,color:"primary"}},[r("v-avatar",{attrs:{color:"indigo",size:"50px"}},[r("span",{staticClass:"white--text"},[r("b",[e._v(e._s(e.uploadPercent)+"%")])])])],1)],1)],1)],1)],1),e._v(" "),e.$store.state.denyAccess?e._e():r("v-slide-y-transition",{attrs:{mode:"out-in"}},[r("v-stepper",{model:{value:e.e1,callback:function(t){e.e1=t},expression:"e1"}},[r("v-stepper-header",[r("v-stepper-step",{attrs:{step:"1",complete:e.e1>1}},[e._v("Upload CSV")]),e._v(" "),r("v-divider"),e._v(" "),r("v-stepper-step",{attrs:{step:"2",complete:e.e1>2}},[e._v("Map Headers")]),e._v(" "),r("v-btn",{attrs:{icon:""},nativeOn:{click:function(t){return e.closeUploadWindow()}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-stepper-items",[r("v-stepper-content",{attrs:{step:"1"}},[r("v-card",{staticClass:"mb-5"},[r("v-card-title",[e._v("Upload CSV (utf-8 only) - "),r("b",[e._v("Select a CSV file and upload")])]),e._v(" "),r("v-card-text",[r("v-text-field",{attrs:{label:"Enter Unique Name For Your Data","error-messages":e.uploadNameErrors,required:""},on:{blur:e.ensureNameUnique,input:e.ensureNameUnique},model:{value:e.uploadName,callback:function(t){e.uploadName=t},expression:"uploadName"}}),e._v(" "),r("input",{attrs:{type:"file"},on:{change:e.fileSelected}}),e._v(" "),r("br"),r("br"),e._v(" "),r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[e._v("\n                  Advanced Options\n                ")]),e._v(" "),r("v-card-text",[r("v-tooltip",{attrs:{top:""}},[e.$store.state.dhis.user.orgId?r("v-checkbox",{attrs:{slot:"activator",disabled:e.shareWithAll,color:"primary",label:"Share with other users of the same org unit as yours"},slot:"activator",model:{value:e.shareToSameOrgid,callback:function(t){e.shareToSameOrgid=t},expression:"shareToSameOrgid"}}):e._e(),e._v(" "),r("span",[e._v("\n                      Share this dataset with all other users that are on the same org unit as you\n                    ")])],1),e._v(" "),r("v-checkbox",{attrs:{color:"primary",label:"Share with all other users"},on:{change:e.sharingOptions},model:{value:e.shareWithAll,callback:function(t){e.shareWithAll=t},expression:"shareWithAll"}}),e._v(" "),r("v-tooltip",{attrs:{top:""}},[e.shareWithAll&&e.$store.state.dhis.user.orgId?r("v-checkbox",{attrs:{slot:"activator",color:"primary",label:"Limit orgs sharing by user orgid"},slot:"activator",model:{value:e.limitShareByOrgId,callback:function(t){e.limitShareByOrgId=t},expression:"limitShareByOrgId"}}):e._e(),e._v(" "),r("span",[e._v("\n                      if activated, other users will see locations (including location children) that has the same location id as their location id\n                    ")])],1)],1)],1)],1)],1),e._v(" "),e.uploadedFileName&&e.uploadName&&0===e.uploadNameErrors.length?r("v-btn",{attrs:{color:"primary"},nativeOn:{click:function(t){e.e1=2}}},[e._v("Continue")]):r("v-btn",{attrs:{color:"primary",disabled:""},nativeOn:{click:function(t){e.e1=2}}},[e._v("Continue")])],1),e._v(" "),r("v-stepper-content",{attrs:{step:"2"}},[r("b",[e._v("Map an appropriate CSV header against those on the app.")]),e._v(" "),r("v-container",{attrs:{fluid:""}},[r("v-layout",{ref:"form",attrs:{row:"",wrap:""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[r("v-flex",{attrs:{xs6:""}},[r("v-subheader",[e._v("Facility*")])],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-select",{attrs:{items:e.filteredItemFacility,"error-messages":e.facilityErrors,label:"Select",required:"","single-line":"",clearable:""},on:{blur:function(t){return e.$v.facility.$touch()},change:function(t){return e.$v.facility.$touch()}},model:{value:e.facility,callback:function(t){e.facility=t},expression:"facility"}})],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-subheader",[e._v("Code*")])],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-select",{attrs:{items:e.filteredItemCode,"error-messages":e.codeErrors,label:"Select",required:"","single-line":"",clearable:""},on:{blur:function(t){return e.$v.code.$touch()},change:function(t){return e.$v.code.$touch()}},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-subheader",[e._v("Latitude")])],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-select",{attrs:{items:e.filteredItemLat,label:"Select","single-line":"",clearable:""},model:{value:e.lat,callback:function(t){e.lat=t},expression:"lat"}})],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-subheader",[e._v("Longitude")])],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-select",{attrs:{items:e.filteredItemLong,label:"Select","single-line":"",clearable:""},model:{value:e.long,callback:function(t){e.long=t},expression:"long"}})],1),e._v(" "),[r("v-flex",{attrs:{xs6:""}},[r("v-subheader",[e._v("Level 1")])],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-select",{attrs:{items:e.filteredItemLevel1,label:"Select","single-line":"",clearable:""},model:{value:e.level1,callback:function(t){e.level1=t},expression:"level1"}})],1)],e._v(" "),[r("v-flex",{attrs:{xs6:""}},[r("v-subheader",[e._v("Level 2")])],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-select",{attrs:{items:e.filteredItemLevel2,label:"Select","single-line":"",clearable:""},model:{value:e.level2,callback:function(t){e.level2=t},expression:"level2"}})],1)],e._v(" "),e.showLevel3?[r("v-flex",{attrs:{xs6:""}},[r("v-subheader",[e._v("Level 3")])],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-select",{attrs:{items:e.filteredItemLevel3,label:"Select","single-line":"",clearable:""},model:{value:e.level3,callback:function(t){e.level3=t},expression:"level3"}})],1)]:e._e(),e._v(" "),e.showLevel4?[r("v-flex",{attrs:{xs6:""}},[r("v-subheader",[e._v("Level 4")])],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-select",{attrs:{items:e.filteredItemLevel4,label:"Select","single-line":"",clearable:""},model:{value:e.level4,callback:function(t){e.level4=t},expression:"level4"}})],1)]:e._e(),e._v(" "),e.showLevel5?[r("v-flex",{attrs:{xs6:""}},[r("v-subheader",[e._v("Level 5")])],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-select",{attrs:{items:e.filteredItemLevel5,label:"Select","single-line":"",clearable:""},model:{value:e.level5,callback:function(t){e.level5=t},expression:"level5"}})],1)]:e._e(),e._v(" "),e.showLevel6?[r("v-flex",{attrs:{xs6:""}},[r("v-subheader",[e._v("Level 6")])],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-select",{attrs:{items:e.filteredItemLevel6,label:"Select","single-line":"",clearable:""},model:{value:e.level6,callback:function(t){e.level6=t},expression:"level6"}})],1)]:e._e(),e._v(" "),e.showLevel7?[r("v-flex",{attrs:{xs6:""}},[r("v-subheader",[e._v("Level 7")])],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-select",{attrs:{items:e.filteredItemLevel7,label:"Select","single-line":"",clearable:""},model:{value:e.level7,callback:function(t){e.level7=t},expression:"level7"}})],1)]:e._e(),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-spacer"),e._v(" "),r("v-tooltip",{attrs:{top:""}},[e.showLevel7?e._e():r("v-btn",{attrs:{slot:"activator",color:"success",icon:""},on:{click:e.showMoreLevel},slot:"activator"},[r("v-icon",[e._v("add")])],1),e._v(" "),r("span",[e._v("Add More Level")])],1)],1)],2)],1),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs1:""}},[r("v-btn",{attrs:{color:"error"},nativeOn:{click:function(t){e.e1=1}}},[e._v("Go Back")])],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-btn",{attrs:{color:"primary",disabled:e.$v.$invalid},nativeOn:{click:function(t){e.confirmUpload=!0}}},[e._v("Upload")])],1)],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var be=r("VU/8")(xe,ye,!1,function(e){r("8qoT")},"data-v-379a4bb1",null).exports,we={mixins:[Se,p],validations:{host:{required:w.required},name:{required:w.required},sourceType:{required:w.required}},data:function(){return{datasetLimitWarn:!1,nameErrors:[]}},methods:{close:function(){tt.$emit("dataSourceSaved")},performExtraCheck:function(){var e=this;this.$store.state.dynamicProgress=!0,this.$store.state.progressTitle="Performing extra validations",this.getGeneralConfig(function(){e.datasetLimitWarn=!1,e.$store.state.dynamicProgress=!1,e.canAddDataset?e.addDataSource("syncServer"):e.datasetLimitWarn=!0})},ensureNameUnique:function(){if(this.nameErrors=[],""===this.name)return this.nameErrors.push("Name is required");if(this.name.length>35)return this.nameErrors.push("Name must not exceed 35 characters");var e=!0,t=!1,r=void 0;try{for(var a,s=n()(this.invalidCharacters);!(e=(a=s.next()).done);e=!0){var o=a.value;if(-1!==this.name.indexOf(o))return this.nameErrors.push("Name is invalid")}}catch(e){t=!0,r=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw r}}var i=!0,c=!1,l=void 0;try{for(var u,d=n()(this.$store.state.dataSources);!(i=(u=d.next()).done);i=!0){if(u.value.name===this.name)return this.nameErrors.push("This Name Exists"),!1}}catch(e){c=!0,l=e}finally{try{!i&&d.return&&d.return()}finally{if(c)throw l}}}}},De={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-card",{staticClass:"mx-auto",staticStyle:{"max-width":"500px"}},[r("v-system-bar",{attrs:{color:"deep-purple darken-4",dark:""}}),e._v(" "),r("v-toolbar",{attrs:{color:"deep-purple accent-4",cards:"",dark:"",flat:""}},[r("v-card-title",{staticClass:"title font-weight-regular"},[e._v("Add New Remote Source")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){return e.close()}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-form",{ref:"form",staticClass:"pa-3 pt-4"},[r("v-select",{attrs:{items:e.$store.state.remoteDataSources,required:"",label:"Source Type"},model:{value:e.sourceType,callback:function(t){e.sourceType=t},expression:"sourceType"}}),e._v(" "),r("v-text-field",{attrs:{box:"",required:"","error-messages":e.nameErrors,color:"deep-purple",label:"Source Name"},on:{blur:e.ensureNameUnique,input:e.ensureNameUnique},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),e._v(" "),r("v-text-field",{attrs:{box:"",required:"",color:"deep-purple",label:"Base URL"},model:{value:e.host,callback:function(t){e.host=t},expression:"host"}}),e._v(" "),r("v-text-field",{attrs:{box:"",color:"deep-purple",label:"Username"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e._v(" "),r("v-text-field",{staticStyle:{"min-height":"96px"},attrs:{box:"",color:"deep-purple",label:"Password",type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),[r("v-tooltip",{attrs:{top:""}},[e.$store.state.dhis.user.orgId?r("v-checkbox",{attrs:{slot:"activator",disabled:e.shareWithAll,color:"primary",label:"Share with other users of the same org unit as yours"},slot:"activator",model:{value:e.shareToSameOrgid,callback:function(t){e.shareToSameOrgid=t},expression:"shareToSameOrgid"}}):e._e(),e._v(" "),r("span",[e._v("\n                Share this dataset with all other users that are on the same org unit as you\n              ")])],1),e._v(" "),r("v-checkbox",{attrs:{color:"primary",label:"Share with all other users"},on:{change:e.sharingOptions},model:{value:e.shareWithAll,callback:function(t){e.shareWithAll=t},expression:"shareWithAll"}}),e._v(" "),r("v-tooltip",{attrs:{top:""}},[e.shareWithAll&&e.$store.state.dhis.user.orgId?r("v-checkbox",{attrs:{slot:"activator",color:"primary",label:"Limit orgs sharing by user orgid"},slot:"activator",model:{value:e.limitShareByOrgId,callback:function(t){e.limitShareByOrgId=t},expression:"limitShareByOrgId"}}):e._e(),e._v(" "),r("span",[e._v("\n                if activated, other users will see locations (including location children) that has the same location id as their location id\n              ")])],1)]],2),e._v(" "),r("v-divider"),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{flat:""},on:{click:function(t){return e.$refs.form.reset()}}},[e._v("\n            Clear\n          ")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{staticClass:"white--text",attrs:{disabled:e.$v.$invalid,color:"deep-purple accent-4",depressed:""},on:{click:e.performExtraCheck}},[e._v("\n            Add\n          ")])],1)],1)],1),e._v(" "),r("v-spacer")],1)],1)},staticRenderFns:[]},Pe=r("VU/8")(we,De,!1,null,null,null).exports,Ce={mixins:[p],data:function(){return{helpDialog:!1,datasetLimitWarn:!1,selectedComponent:"",dataSources:[{text:"Upload CSV",value:"upload"},{text:"Remote Source",value:"remote"}],dataSource:"",addDataSource:!0,alertSuccess:!1,alertError:!1,alertMsg:""}},methods:{limitWarnStateChange:function(e){this.datasetLimitWarn=e},sourceSelected:function(e){this.addDataSource=!0,"upload"===e?this.selectedComponent="FacilityReconUpload":"remote"===e&&(this.selectedComponent="FacilityReconRemoteSources")}},computed:{canUseUploadWay:function(){return-1!==this.$store.state.config.generalConfig.datasetsAdditionWays.indexOf("CSV Upload")},canUseRemoteWay:function(){return-1!==this.$store.state.config.generalConfig.datasetsAdditionWays.indexOf("Remote Servers Sync")}},components:{FacilityReconUpload:be,FacilityReconRemoteSources:Pe,appDialogs:$e},created:function(){var e=this;tt.$on("dataSourceSaved",function(){e.addDataSource=!1,e.dataSource=""}),tt.$on("dataSourceAddedSuccessfully",function(){e.alertSuccess=!0,e.alertMsg="Data Source Added Successfully",setTimeout(function(){e.alertSuccess=!1},3e3)}),tt.$on("remoteServerFailedAdd",function(){e.alertError=!0,e.alertMsg="Data Source Failed To Be Added"})}},ke={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{fluid:""}},[r("v-dialog",{attrs:{scrollable:"",persistent:"",overlay:!1,"max-width":"700px",transition:"dialog-transition"},model:{value:e.helpDialog,callback:function(t){e.helpDialog=t},expression:"helpDialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[r("v-icon",[e._v("info")]),e._v(" About this page\n        ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.helpDialog=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[e._v("\n        This page let you load data from various sources into the app for reconciliation\n        "),r("v-list",[e._v("1. Select to add remote source if you have a DHIS2 or FHIR server that you want to use its data on this app")]),e._v(" "),r("v-list",[e._v("2. Select Upload CSV if you have a CSV file and want to upload its data on the app")]),e._v(" "),r("v-list",[e._v("3. The system requires CSV data to have atleast 2 levels above facility")]),e._v(" "),r("v-list",[e._v("4. Level 1 is the highest level on the hierarchy i.e Country")]),e._v(" "),r("v-list",[e._v("\n          5. Base URL under remote sources section refer to the URL i.e http://localhost:3447/fhir and not http://localhost:3447/fhir/Location.\n          Same applies to DHIS2 base URL\n        ")])],1)],1)],1),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-card",[r("v-card-title",{attrs:{"primary-title":""}},[r("v-toolbar",{staticStyle:{"font-weight":"bold","font-size":"18px"},attrs:{color:"white"}},[e._v("\n            Choose way to add data source\n          ")]),e._v(" "),r("v-spacer")],1),e._v(" "),r("v-card-text",[r("v-radio-group",{attrs:{row:""},on:{change:e.sourceSelected},model:{value:e.dataSource,callback:function(t){e.dataSource=t},expression:"dataSource"}},[e.canUseUploadWay?r("v-radio",{attrs:{disabled:!e.canAddDataset,color:"primary",label:"Upload CSV",value:"upload"}}):e._e(),e._v(" "),e.canUseRemoteWay?r("v-radio",{attrs:{disabled:!e.canAddDataset,color:"primary",label:"Remote Source",value:"remote"}}):e._e()],1)],1)],1)],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs1:"","text-xs-right":""}},[r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",flat:"",icon:"",color:"primary"},on:{click:function(t){e.helpDialog=!0}},slot:"activator"},[r("v-icon",[e._v("help")])],1),e._v(" "),r("span",[e._v("Help")])],1)],1)],1),e._v(" "),r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs6:""}},[r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"success",dismissible:"",transition:"scale-transition"},model:{value:e.alertSuccess,callback:function(t){e.alertSuccess=t},expression:"alertSuccess"}},[e._v("\n        "+e._s(e.alertMsg)+"\n      ")]),e._v(" "),r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"error",dismissible:"",transition:"scale-transition"},model:{value:e.alertError,callback:function(t){e.alertError=t},expression:"alertError"}},[e._v("\n        "+e._s(e.alertMsg)+"\n      ")])],1),e._v(" "),r("v-flex",[e.addDataSource?r(e.selectedComponent,{tag:"component"}):e._e()],1)],1),e._v(" "),r("appDialogs",{attrs:{datasetLimitWarn:e.datasetLimitWarn},on:{limitWarnStateChange:e.limitWarnStateChange}})],1)},staticRenderFns:[]},Ie=r("VU/8")(Ce,ke,!1,null,null,null).exports,Te={mixins:[p],data:function(){return{syncType:"",mode:"",helpDialog:!1,deleteConfirm:!1,editDialog:!1,server:{name:"",userID:{}},shareDialog:!1,shareSource:{},users:[],sharedUsers:[],limitLocationId:"",limitLocationName:"No limit",locationTree:[],loadingLocationTree:!1,searchUsers:"",syncServersHeader:[{sortable:!1},{text:"Source Name",value:"name"},{text:"Base URL",value:"host"},{text:"Source Type",value:"sourceType"},{text:"User Name",value:"username"},{text:"Password",value:"password"},{text:"Last Sync",value:"lastsync"},{text:"Owner",value:"owner",sortable:!1},{text:"Shared To",value:"shareStatus"},{text:"Created Time",value:"createdTime"}],uploadSourcesHeader:[{sortable:!1},{text:"Source Name",align:"left",value:"name"},{text:"Owner",value:"owner",sortable:!1},{text:"Shared To",value:"shareStatus"},{text:"Created Time",value:"createdTime"}],dataSources:[{text:"Upload CSV",value:"upload"},{text:"Remote Source",value:"remote"}],usersHeader:[{sortable:!1},{text:"Username",value:"userName",sortable:!0},{text:"Firstname",value:"firstName",sortable:!0},{text:"Surname",value:"surname",sortable:!0}],dataSource:"",addDataSource:!0,syncProgrIndeter:!1,syncProgrPercent:!1,syncStatus:"Waiting for sync status",syncPercent:null,syncProgressTimer:"",syncRunning:!1,alertSuccess:!1,alertError:!1,alertMsg:""}},filters:{mergeUsers:function(e){if(!e||0===e.length)return"";var t="",r=!0,a=!1,s=void 0;try{for(var o,i=n()(e);!(r=(o=i.next()).done);r=!0){var c=o.value;t?t+=", "+c.userName:t=c.userName}}catch(e){a=!0,s=e}finally{try{!r&&i.return&&i.return()}finally{if(a)throw s}}return t}},methods:{sourceSelected:function(e){this.addDataSource=!0,"upload"===e?this.selectedComponent="FacilityReconUpload":"remote"===e&&(this.selectedComponent="FacilityReconRemoteSources")},editDataSource:function(e){return 0===d()(this.server).length?(this.$store.state.dialogError=!0,this.$store.state.errorTitle="Info",void(this.$store.state.errorDescription="Please select data source")):this.server.userID._id!==this.$store.state.auth.userID?(this.$store.state.dialogError=!0,this.$store.state.errorTitle="Info",void(this.$store.state.errorDescription="You are not the owner of this data source, ask the owner to edit any details")):void("upload"!==this.server.source&&(this.editDialog=!0))},saveEdit:function(){var e=this,t=new FormData,r=this.$store.state.clientId;t.append("host",this.server.host),t.append("sourceType",this.server.sourceType),t.append("source",this.server.source),t.append("username",this.server.username),t.append("password",this.server.password),t.append("userID",this.server.userID._id),t.append("name",this.server.name),t.append("id",this.server._id),t.append("clientId",r),this.editDialog=!1,h.a.post("/addDataSource",t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){e.server.password=t.data.password})},validateDelete:function(){return 0===d()(this.server).length?(this.$store.state.dialogError=!0,this.$store.state.errorTitle="Info",void(this.$store.state.errorDescription="Please select data source")):this.server.userID._id!==this.$store.state.auth.userID&&"Admin"!==this.$store.state.auth.role?(this.$store.state.dialogError=!0,this.$store.state.errorTitle="Info",void(this.$store.state.errorDescription="You are not the owner of this data source, ask the owner to remove you from the share")):void(this.deleteConfirm=!0)},deleteDataSource:function(){var e=this;this.deleteConfirm=!1;var t=this.$store.state.auth.userID,r=this.server.userID._id;h.a.get("/deleteDataSource/"+this.server._id+"/"+this.server.name+"/"+r+"/"+t).then(function(t){e.server={},tt.$emit("getDataSources")})},share:function(e,t){var r=this;if("showDialog"===t)this.limitLocationId="",this.limitLocationName="No limit",this.sharedUsers=[],this.shareSource=e,this.getLocationTree(),e.hasOwnProperty("shared")&&e.shared.users.length>0&&e.shared.users.forEach(function(e){r.sharedUsers.push(e._id)}),this.shareDialog=!0;else if("saveShare"===t){if(0===this.sharedUsers.length)return this.$store.state.dialogError=!0,this.$store.state.errorTitle="Info",void(this.$store.state.errorDescription="Please select atleast one user");var a=new FormData;a.append("shareSource",this.shareSource._id),a.append("users",s()(this.sharedUsers)),a.append("userID",this.$store.state.auth.userID),a.append("role",this.$store.state.auth.role),a.append("orgId",this.$store.state.dhis.user.orgId),a.append("limitLocationId",this.limitLocationId),this.$store.state.loadingServers=!0,this.shareDialog=!1,h.a.post("/shareDataSource",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){r.$store.state.loadingServers=!1,r.$store.state.dataSources=e.data}).catch(function(e){console.log(e),r.$store.state.loadingServers=!1})}},locationSelected:function(e){this.limitLocationId=e.id,"parent"!==e.id?this.limitLocationName=e.data.text:(this.limitLocationName="No limit",this.limitLocationId="")},getLocationTree:function(){var e=this,t=this.shareSource.userID._id;this.loadingLocationTree=!0;var r=this.toTitleCase(this.shareSource.name);h.a.get("/getTree/"+r+"/"+t).then(function(t){t.data&&(e.locationTree=[{text:"Select location to limit sharing",id:"parent",children:t.data}]),e.loadingLocationTree=!1})},getUsers:function(){var e=this;h.a.get("/getUsers").then(function(t){e.users=t.data})},exportCSV:function(){var e=this,t=this.server.userID._id;h.a.get("/getUploadedCSV/"+t+"/"+this.server.name).then(function(t){var r=new Blob([t.data]);if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(r,e.server.name+".csv");else{var a=window.document.createElement("a");a.href=window.URL.createObjectURL(r,{type:"text/plain"}),a.download=e.server.name+".csv",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}).catch(function(t){e.$store.state.dialogError=!0,e.$store.state.errorTitle="Error",e.$store.state.errorDescription=t.response.data})},sync:function(e){return 0===d()(this.server).length?(this.$store.state.dialogError=!0,this.$store.state.errorTitle="Info",void(this.$store.state.errorDescription="Please select data source")):this.server.userID._id!==this.$store.state.auth.userID?(this.$store.state.dialogError=!0,this.$store.state.errorTitle="Info",void(this.$store.state.errorDescription="Only data source owner can run the sync")):void("upload"!==this.server.source&&(this.mode=e,"DHIS2"===this.server.sourceType?this.syncType="dhisSync":"FHIR"===this.server.sourceType&&(this.syncType="fhirSync"),setTimeout(function(){tt.$emit("runRemoteSync")},100)))}},computed:{remoteServers:function(){var e=[],t=!0,r=!1,a=void 0;try{for(var s,o=n()(this.$store.state.dataSources);!(t=(s=o.next()).done);t=!0){var i=s.value;"syncServer"===i.source&&e.push(i)}}catch(e){r=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw a}}return e},uploadedSources:function(){var e=[],t=!0,r=!1,a=void 0;try{for(var s,o=n()(this.$store.state.dataSources);!(t=(s=o.next()).done);t=!0){var i=s.value;"upload"===i.source&&e.push(i)}}catch(e){r=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw a}}return e}},components:{FacilityReconUpload:be,FacilityReconRemoteSources:Pe,appRemoteSync:O,"liquor-tree":ee.a},created:function(){var e=this;this.getUsers(),tt.$on("dataSourceSaved",function(){e.addDataSource=!1,e.dataSource=""}),tt.$on("dataSourceAddedSuccessfully",function(){e.alertSuccess=!0,e.alertMsg="Data Source Added Successfully",setTimeout(function(){e.alertSuccess=!1},3e3)}),tt.$on("remoteServerFailedAdd",function(){e.alertError=!0,e.alertMsg="Data Source Failed To Be Added"})}},Le={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{fluid:""}},[r("v-dialog",{attrs:{width:"530px"},model:{value:e.deleteConfirm,callback:function(t){e.deleteConfirm=t},expression:"deleteConfirm"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n          Info\n        ")])],1),e._v(" "),r("v-card-text",[e._v("\n        This will delete the dataset from the database. Are you sure you want to delete "+e._s(e.server.name)+" "+e._s(e.server.host)+"\n      ")]),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"error"},on:{click:function(t){e.deleteConfirm=!1}}},[e._v("Cancel")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"success"},on:{click:e.deleteDataSource}},[e._v("Yes")])],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",width:"530px"},model:{value:e.editDialog,callback:function(t){e.editDialog=t},expression:"editDialog"}},[r("v-card",{attrs:{width:"530px"}},[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n          Editing "+e._s(e.server.host)+"\n        ")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.editDialog=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs1:""}},[r("v-text-field",{attrs:{label:"Name",disabled:""},model:{value:e.server.name,callback:function(t){e.$set(e.server,"name",t)},expression:"server.name"}})],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-text-field",{attrs:{label:"Host"},model:{value:e.server.host,callback:function(t){e.$set(e.server,"host",t)},expression:"server.host"}})],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-select",{attrs:{items:e.$store.state.remoteDataSources,label:"Source Type"},model:{value:e.server.sourceType,callback:function(t){e.$set(e.server,"sourceType",t)},expression:"server.sourceType"}})],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-text-field",{attrs:{label:"User Name"},model:{value:e.server.username,callback:function(t){e.$set(e.server,"username",t)},expression:"server.username"}})],1),e._v(" "),r("v-flex",{attrs:{xs1:""}},[r("v-text-field",{attrs:{label:"Password",type:"password"},model:{value:e.server.password,callback:function(t){e.$set(e.server,"password",t)},expression:"server.password"}})],1)],1)],1),e._v(" "),r("v-card-actions",{staticStyle:{float:"center"}},[r("v-btn",{staticStyle:{color:"white"},attrs:{color:"error"},nativeOn:{click:function(t){e.editDialog=!1}}},[r("v-icon",{attrs:{dark:"",left:""}},[e._v("cancel")]),e._v("Cancel\n        ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"primary",dark:""},nativeOn:{click:function(t){return e.saveEdit("match")}}},[r("v-icon",{attrs:{left:""}},[e._v("save")]),e._v("Save\n        ")],1)],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",width:"530px"},model:{value:e.shareDialog,callback:function(t){e.shareDialog=t},expression:"shareDialog"}},[r("v-card",{attrs:{width:"530px"}},[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n          Sharing "+e._s(e.shareSource.name)+"\n        ")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.shareDialog=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[e.loadingLocationTree?[r("v-progress-linear",{attrs:{indeterminate:!0}})]:[r("v-card-text",[r("p",[r("liquor-tree",{ref:"locationTree",attrs:{data:e.locationTree,options:{}},on:{"node:selected":e.locationSelected}})],1)])],e._v(" "),r("v-icon",{attrs:{small:""}},[e._v("lock")]),e._v(" Limiting Sharing to: "),r("b",[e._v(e._s(e.limitLocationName))]),e._v(" "),r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchUsers,callback:function(t){e.searchUsers=t},expression:"searchUsers"}}),e._v(" "),r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.usersHeader,items:e.users,search:e.searchUsers,"item-key":"firstName"},scopedSlots:e._u([{key:"items",fn:function(t){return[t.item.userName!==e.$store.state.auth.username?r("tr",[r("td",[r("v-checkbox",{attrs:{value:t.item._id},model:{value:e.sharedUsers,callback:function(t){e.sharedUsers=t},expression:"sharedUsers"}})],1),e._v(" "),r("td",[e._v(e._s(t.item.userName))]),e._v(" "),r("td",[e._v(e._s(t.item.firstName))]),e._v(" "),r("td",[e._v(e._s(t.item.surname))])]):e._e()]}}])})],2),e._v(" "),r("v-card-actions",{staticStyle:{float:"center"}},[r("v-btn",{staticStyle:{color:"white"},attrs:{color:"error",disabled:e.loadingLocationTree},nativeOn:{click:function(t){e.shareDialog=!1}}},[r("v-icon",{attrs:{dark:"",left:""}},[e._v("cancel")]),e._v("Cancel\n        ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"primary",disabled:e.loadingLocationTree},nativeOn:{click:function(t){return e.share("","saveShare")}}},[r("v-icon",{attrs:{left:""}},[e._v("share")]),e._v("Share\n        ")],1)],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{scrollable:"",persistent:"",overlay:!1,"max-width":"700px",transition:"dialog-transition"},model:{value:e.helpDialog,callback:function(t){e.helpDialog=t},expression:"helpDialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[r("v-icon",[e._v("info")]),e._v(" About this page\n        ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.helpDialog=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[e._v("\n        This page let you visualize various data sets you have added into the app as well as synchronize remote servers with the app\n        "),r("v-list",[e._v("1. Use Force Full Sync to fetch all data from the remote server and update the app")]),e._v(" "),r("v-list",[e._v("2. Use Sync (Update) to pull updated records from the remote server and update the app")]),e._v(" "),r("v-list",[e._v("3. You may proceed to the 'Data Source Pair' page after you have added atleast two data sources")]),e._v(" "),r("v-list",[e._v("4. You may come back to this page and add more sources at any time")])],1)],1)],1),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-spacer"),e._v(" "),r("v-flex",{attrs:{xs1:"","text-xs-right":""}},[r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",flat:"",icon:"",color:"primary"},on:{click:function(t){e.helpDialog=!0}},slot:"activator"},[r("v-icon",[e._v("help")])],1),e._v(" "),r("span",[e._v("Help")])],1)],1)],1),e._v(" "),r("v-layout",{attrs:{column:""}},[r("v-flex",{attrs:{xs6:""}},[r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"success",dismissible:"",transition:"scale-transition"},model:{value:e.alertSuccess,callback:function(t){e.alertSuccess=t},expression:"alertSuccess"}},[e._v("\n        "+e._s(e.alertMsg)+"\n      ")]),e._v(" "),r("v-alert",{staticStyle:{width:"500px"},attrs:{type:"error",dismissible:"",transition:"scale-transition"},model:{value:e.alertError,callback:function(t){e.alertError=t},expression:"alertError"}},[e._v("\n        "+e._s(e.alertMsg)+"\n      ")])],1)],1),e._v(" "),r("v-layout",{attrs:{row:"",wrap:""}},[r("v-spacer"),e._v(" "),r("v-flex",[r("v-card",{attrs:{color:"cyan lighten-5"}},[r("v-card-title",{attrs:{"primary-title":""}},[r("v-toolbar",{staticStyle:{"font-weight":"bold","font-size":"18px"},attrs:{color:"white"}},[e._v("\n            Remote Sources\n          ")]),e._v(" "),r("v-spacer")],1),e._v(" "),r("v-card-actions",[e.remoteServers.length>0?r("v-btn",{attrs:{color:"primary",round:""},on:{click:function(t){return e.sync("full")}}},[r("v-icon",{attrs:{left:""}},[e._v("sync")]),e._v("Force Full Sync\n          ")],1):r("v-btn",{attrs:{color:"primary",round:"",disabled:""},on:{click:function(t){return e.sync("full")}}},[r("v-icon",{attrs:{left:""}},[e._v("sync")]),e._v("Force Full Sync\n          ")],1),e._v(" "),e.remoteServers.length>0?r("v-btn",{attrs:{color:"primary lighten-1",round:""},on:{click:function(t){return e.sync("update")}}},[r("v-icon",{attrs:{left:""}},[e._v("sync")]),e._v("Sync (Update)\n          ")],1):r("v-btn",{attrs:{color:"primary lighten-1",round:"",disabled:""},on:{click:function(t){return e.sync("update")}}},[r("v-icon",{attrs:{left:""}},[e._v("sync")]),e._v("Sync (Update)\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),e.remoteServers.length>0?r("v-btn",{attrs:{color:"success",round:""},on:{click:e.editDataSource}},[r("v-icon",{attrs:{left:""}},[e._v("edit")]),e._v("Edit\n          ")],1):r("v-btn",{attrs:{color:"success",round:"",disabled:""},on:{click:e.editDataSource}},[r("v-icon",{attrs:{left:""}},[e._v("edit")]),e._v("Edit\n          ")],1),e._v(" "),e.remoteServers.length>0?r("v-btn",{attrs:{color:"error",round:""},on:{click:e.validateDelete}},[r("v-icon",{attrs:{left:""}},[e._v("delete")]),e._v("Delete\n          ")],1):r("v-btn",{attrs:{color:"error",round:"",disabled:""},on:{click:e.validateDelete}},[r("v-icon",{attrs:{left:""}},[e._v("delete")]),e._v("Delete\n          ")],1)],1),e._v(" "),r("v-card-text",[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.syncServersHeader,items:e.remoteServers,dark:"",loading:e.$store.state.loadingServers},scopedSlots:e._u([{key:"items",fn:function(t){return[r("v-radio-group",{staticStyle:{height:"5px"},model:{value:e.server,callback:function(t){e.server=t},expression:"server"}},[r("td",[r("v-radio",{attrs:{value:t.item,color:"blue"}})],1)]),e._v(" "),r("td",[e._v(e._s(t.item.name))]),e._v(" "),r("td",[e._v(e._s(t.item.host))]),e._v(" "),r("td",[e._v(e._s(t.item.sourceType))]),e._v(" "),r("td",[e._v(e._s(t.item.username))]),e._v(" "),t.item.username?r("td",[e._v("*****")]):r("td"),e._v(" "),r("td",[e._v(e._s(t.item.lastUpdate))]),e._v(" "),r("td",[e._v(e._s(t.item.userID.userName))]),e._v(" "),r("td",[e._v("\n                "+e._s(e._f("mergeUsers")(t.item.shared.users))+"\n              ")]),e._v(" "),r("td",[e._v("\n                "+e._s(t.item.createdTime)+"\n              ")]),e._v(" "),t.item.userID._id===e.$store.state.auth.userID?r("td",[r("v-btn",{attrs:{color:"success",flat:""},on:{click:function(r){return e.share(t.item,"showDialog")}}},[r("v-icon",[e._v("share")]),e._v(" Share\n                ")],1)],1):e._e()]}}])},[r("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"})],1)],1),e._v(" "),r("v-card-title",{attrs:{"primary-title":""}},[r("v-toolbar",{staticStyle:{"font-weight":"bold","font-size":"18px"},attrs:{color:"white"}},[e._v("\n            Uploaded Sources\n          ")])],1),e._v(" "),r("v-card-actions",[r("v-tooltip",{attrs:{top:""}},[e.uploadedSources.length>0?r("v-btn",{attrs:{slot:"activator",color:"success",round:""},on:{click:e.exportCSV},slot:"activator"},[r("v-icon",{attrs:{left:""}},[e._v("file_copy")]),e._v("Export\n            ")],1):r("v-btn",{attrs:{slot:"activator",color:"success",round:"",disabled:""},on:{click:e.exportCSV},slot:"activator"},[r("v-icon",{attrs:{left:""}},[e._v("file_copy")]),e._v("Export\n            ")],1),e._v(" "),r("span",[e._v("Export Original CSV")])],1),e._v(" "),r("v-spacer"),e._v(" "),e.uploadedSources.length>0?r("v-btn",{attrs:{color:"error",round:""},on:{click:e.validateDelete}},[r("v-icon",{attrs:{left:""}},[e._v("delete")]),e._v("Delete\n          ")],1):r("v-btn",{attrs:{color:"error",round:"",disabled:""},on:{click:e.validateDelete}},[r("v-icon",{attrs:{left:""}},[e._v("delete")]),e._v("Delete\n          ")],1)],1),e._v(" "),r("v-card-text",[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.uploadSourcesHeader,items:e.uploadedSources,dark:"",loading:e.$store.state.loadingServers},scopedSlots:e._u([{key:"items",fn:function(t){return[r("v-radio-group",{staticStyle:{height:"5px"},model:{value:e.server,callback:function(t){e.server=t},expression:"server"}},[r("td",[r("v-radio",{attrs:{value:t.item,color:"blue"}})],1)]),e._v(" "),r("td",[e._v(e._s(t.item.name))]),e._v(" "),r("td",[e._v(e._s(t.item.userID.userName))]),e._v(" "),r("td",[e._v("\n                "+e._s(e._f("mergeUsers")(t.item.shared.users))+"\n              ")]),e._v(" "),r("td",[e._v("\n                "+e._s(t.item.createdTime)+"\n              ")]),e._v(" "),t.item.userID._id===e.$store.state.auth.userID?r("td",[r("v-btn",{attrs:{color:"success",flat:""},on:{click:function(r){return e.share(t.item,"showDialog")}}},[r("v-icon",[e._v("share")]),e._v(" Share\n                ")],1)],1):e._e()]}}])},[r("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"})],1)],1)],1)],1),e._v(" "),r("v-spacer")],1),e._v(" "),e.server.name?r("appRemoteSync",{attrs:{syncType:e.syncType,serverName:e.server.name,userID:e.$store.state.auth.userID,sourceOwner:e.server.userID._id,mode:e.mode}}):e._e()],1)},staticRenderFns:[]},Ae=r("VU/8")(Te,Le,!1,null,null,null).exports,Ne={mixins:[p,f],data:function(){return{confirmPairDeleteDialog:!1,helpDialog:!1,alertSuccess:!1,alertError:!1,alertMsg:"",pairLimitWarn:!1,shareDialog:!1,mapSourcePairLevels:!1,pairLevelsMapping:{},sharePair:{},source1:{},source2:{},searchPairs:"",searchSources:"",searchUsers:"",users:[],sharedUsers:[],activeDataSourcePair:{},pairLevelsMappingHeader:[{text:"Source 1 Levels",value:"headerSource1Levels",sortable:!1},{text:"Source 2 Levels",value:"headerSource1Levels",sortable:!1}],source1Headers:[{sortable:!1},{text:"Source 1",value:"headerSource1",sortable:!1}],source2Headers:[{sortable:!1},{text:"Source 2",value:"headerSource2",sortable:!1}],sourcePairHeaders:[{text:"Pair",value:"pair"},{text:"Owner",value:"owner",sortable:!1},{text:"Active",value:"active"},{text:"Shared To",value:"shareStatus"}],usersHeader:[{text:"Username",value:"username",sortable:!0},{text:"Firstname",value:"fname",sortable:!0},{text:"Surname",value:"sname",sortable:!0}],source1Levels:[],source2Levels:[]}},filters:{mergeUsers:function(e){if(!e||0===e.length)return"";var t="",r=!0,a=!1,s=void 0;try{for(var o,i=n()(e);!(r=(o=i.next()).done);r=!0){var c=o.value;t=t?","+c.userName:c.userName}}catch(e){a=!0,s=e}finally{try{!r&&i.return&&i.return()}finally{if(a)throw s}}return t}},methods:{confirmDeletePair:function(){this.confirmPairDeleteDialog=!0},deletePair:function(){var e=this;this.confirmPairDeleteDialog=!1;var t="pairId="+this.activeDataSourcePair._id+"&userID="+this.activeDataSourcePair.owner.id+"&source1Name="+this.activeDataSourcePair.source1.name+"&source2Name="+this.activeDataSourcePair.source2.name;h.a.delete("/deleteSourcePair?"+t).then(function(t){e.$store.state.errorTitle="Pair Deletion",e.$store.state.errorDescription="Pair deleted successfully",e.$store.state.dialogError=!0,setTimeout(function(){tt.$emit("getDataSourcePair")},500)}).catch(function(t){e.$store.state.errorTitle="Pair Deletion",e.$store.state.errorDescription="An error occured while deleting pair, please retry",e.$store.state.errorColor="error",e.$store.state.dialogError=!0,console.log(s()(t))})},reset:function(){var e=this;this.source1={},this.source2={},this.activeDataSourcePair={},this.$store.state.dynamicProgress=!0,this.$store.state.progressTitle="Reseting Data Source Pairs";var t=this.$store.state.auth.userID;h.a.get("/resetDataSourcePair/"+t).then(function(t){tt.$emit("getDataSourcePair"),e.$store.state.dynamicProgress=!1,e.alertSuccess=!0,e.alertMsg="Data Source Pair Reseted Successfully"}).catch(function(t){e.alertError=!0,e.alertMsg="Something went wrong while reseting data source pairs",console.log(t)})},checkLevels:function(){var e=this;this.pairLevelsMapping={};var t=this.source1.name,r=this.source2.name;t=this.toTitleCase(t),r=this.toTitleCase(r);var a=s()({source1LimitOrgId:this.getLimitOrgIdOnDataSource(this.source1),source2LimitOrgId:this.getLimitOrgIdOnDataSource(this.source2)}),o=s()({source1Owner:this.source1.userID._id,source2Owner:this.source2.userID._id});h.a.get("/countLevels/"+t+"/"+r+"/"+o+"/"+a).then(function(t){return 1===t.data.totalSource1Levels?(e.$store.state.errorTitle="No data for you",e.$store.state.errorDescription="Cant create this pair, "+e.source1.name+" has no data for you",void(e.$store.state.dialogError=!0)):1===t.data.totalSource2Levels?(e.$store.state.errorTitle="No data for you",e.$store.state.errorDescription="Cant create this pair, "+e.source2.name+" has no data for you",void(e.$store.state.dialogError=!0)):void(t.data.totalSource1Levels>t.data.totalSource2Levels?(e.$store.state.errorTitle="Levels mismatch",e.$store.state.errorDescription="Make sure source1 has the same or less levels as source2",e.$store.state.dialogError=!0):e.createDatasourcePair(e.source1,e.source2))})},mappingSelected:function(e){var t=this;this.source2Levels=this.source2Levels.filter(function(r){return r.value!==t.pairLevelsMapping[e]})},clearMappingSelection:function(e){this.source2Levels.push({text:this.$store.state.levelMapping.source2[this.pairLevelsMapping[e]],value:this.pairLevelsMapping[e]});var t=d()(this.pairLevelsMapping).filter(function(t){return t!==e}),r={},a=!0,s=!1,o=void 0;try{for(var i,c=n()(t);!(a=(i=c.next()).done);a=!0){var l=i.value;r[l]=this.pairLevelsMapping[l]}}catch(e){s=!0,o=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw o}}this.pairLevelsMapping=r},closeLevelMappingDialog:function(){for(var e in this.pairLevelsMapping)this.source2Levels.push({text:this.$store.state.levelMapping.source2[this.pairLevelsMapping[e]],value:this.pairLevelsMapping[e]});this.mapSourcePairLevels=!1},share:function(e,t){var r=this;if("showDialog"===t)this.sharedUsers=[],this.sharePair=e,e.hasOwnProperty("shared")&&e.shared.users.length>0&&e.shared.users.forEach(function(e){r.sharedUsers.push(e._id)}),this.shareDialog=!0;else if("saveShare"===t){if(0===this.sharedUsers.length)return this.$store.state.dialogError=!0,this.$store.state.errorTitle="Info",void(this.$store.state.errorDescription="Please select atleast one user");var a=new FormData;a.append("sharePair",this.sharePair._id),a.append("users",s()(this.sharedUsers)),a.append("userID",this.$store.state.auth.userID),a.append("orgId",this.$store.state.dhis.user.orgId),this.$store.state.loadingServers=!0,this.shareDialog=!1,h.a.post("/shareSourcePair",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){r.$store.state.loadingServers=!1,r.$store.state.dataSourcePairs=e.data}).catch(function(e){console.log(e),r.$store.state.loadingServers=!1})}},getUsers:function(){var e=this;h.a.get("/getUsers").then(function(t){e.users=t.data})}},computed:{dataSources2:function(){if(this.$store.state.config.generalConfig.reconciliation.fixSource2){var e="",t=!0,r=!1,a=void 0;try{for(var s,o=n()(this.$store.state.dataSources);!(t=(s=o.next()).done);t=!0){var i=s.value;i._id===this.$store.state.config.generalConfig.reconciliation.fixSource2To&&(e=i)}}catch(e){r=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw a}}return[e]}return this.$store.state.dataSources},canCreatePair:function(){return!this.$store.state.dhis.user.orgId||!this.$store.state.config.generalConfig.reconciliation.singlePair||0===this.$store.state.dataSourcePairs.length},canDeletePair:function(){return"{}"!==s()(this.activeDataSourcePair)&&this.activeDataSourcePair.owner.id===this.$store.state.auth.userID}},created:function(){var e=this;for(var t in this.canCreatePair||(this.pairLimitWarn=!0),this.getUsers(),this.source1=this.$store.state.dataSources.find(function(t){return t._id===e.$store.state.activePair.source1.id}),this.source2=this.$store.state.dataSources.find(function(t){return t._id===e.$store.state.activePair.source2.id}),this.activeDataSourcePair=this.getActiveDataSourcePair(),this.source1||(this.source1={}),this.source2||(this.source2={}),this.$store.state.levelMapping.source2)"code"!==t&&this.source2Levels.push({text:this.$store.state.levelMapping.source2[t],value:t});for(var r in this.$store.state.levelMapping.source1)"code"!==r&&this.source1Levels.push({text:this.$store.state.levelMapping.source1[r],value:r})}},Me={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{attrs:{fluid:""}},[r("center",[r("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:e.confirmPairDeleteDialog,callback:function(t){e.confirmPairDeleteDialog=t},expression:"confirmPairDeleteDialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"error",dark:""}},[r("v-toolbar-title",[e._v("\n            Confirm deleting\n          ")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.confirmPairDeleteDialog=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[e._v("\n          Are you sure you want to delete this data source pair\n        ")]),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"primary"},nativeOn:{click:function(t){e.confirmPairDeleteDialog=!1}}},[e._v("Cancel")]),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"error"},nativeOn:{click:function(t){return e.deletePair(t)}}},[e._v("Ok")])],1)],1)],1),e._v(" "),r("v-alert",{staticStyle:{width:"1000px"},attrs:{type:"success",dismissible:"",transition:"scale-transition"},model:{value:e.alertSuccess,callback:function(t){e.alertSuccess=t},expression:"alertSuccess"}},[e._v("\n      "+e._s(e.alertMsg)+"\n    ")]),e._v(" "),r("v-alert",{staticStyle:{width:"1000px"},attrs:{type:"error",dismissible:"",transition:"scale-transition"},model:{value:e.alertError,callback:function(t){e.alertError=t},expression:"alertError"}},[e._v("\n      "+e._s(e.alertMsg)+"\n    ")]),e._v(" "),r("v-dialog",{attrs:{scrollable:"",persistent:"",overlay:!1,"max-width":"770px",transition:"dialog-transition"},model:{value:e.pairLimitWarn,callback:function(t){e.pairLimitWarn=t},expression:"pairLimitWarn"}},[r("v-card",[r("v-toolbar",{attrs:{color:"error",dark:""}},[r("v-toolbar-title",[r("v-icon",[e._v("info")]),e._v(" Pair creation limit\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.pairLimitWarn=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[e._v("\n          You cant create more pairs as this account is limited to one pair only at a time.\n        ")]),e._v(" "),r("v-card-actions",[r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"primary"},nativeOn:{click:function(t){e.pairLimitWarn=!1}}},[e._v("Ok")])],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{scrollable:"",persistent:"",overlay:!1,"max-width":"770px",transition:"dialog-transition"},model:{value:e.mapSourcePairLevels,callback:function(t){e.mapSourcePairLevels=t},expression:"mapSourcePairLevels"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[r("v-icon",[e._v("info")]),e._v(" Data sources has different level counts, please map Levels to proceed\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){return e.closeLevelMappingDialog(t)}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[r("v-data-table",{attrs:{headers:e.pairLevelsMappingHeader,items:e.source1Levels},scopedSlots:e._u([{key:"items",fn:function(t){return[r("tr",[r("td",[e._v(e._s(t.item.text))]),e._v(" "),r("td",[e.pairLevelsMapping[t.item.value]?[e._v("\n                    "+e._s(e.$store.state.levelMapping.source2[e.pairLevelsMapping[t.item.value]])+"\n                    "),r("v-icon",{attrs:{small:""},on:{click:function(r){return e.clearMappingSelection(t.item.value)}}},[e._v("close")])]:r("v-select",{attrs:{items:e.source2Levels,clearable:""},on:{change:function(r){return e.mappingSelected(t.item.value)}},model:{value:e.pairLevelsMapping[t.item.value],callback:function(r){e.$set(e.pairLevelsMapping,t.item.value,r)},expression:"pairLevelsMapping[props.item.value]"}})],2)])]}}])})],1),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"error",round:""},on:{click:e.closeLevelMappingDialog}},[r("v-icon",{attrs:{left:""}},[e._v("cancel")]),e._v(" Cancel\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"primary",round:""}},[r("v-icon",{attrs:{left:""}},[e._v("save")]),e._v("Save Mapping\n          ")],1)],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{scrollable:"",persistent:"",overlay:!1,"max-width":"700px",transition:"dialog-transition"},model:{value:e.helpDialog,callback:function(t){e.helpDialog=t},expression:"helpDialog"}},[r("v-card",[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[r("v-icon",[e._v("info")]),e._v(" About this page\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.helpDialog=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[e._v("\n          This page let you choose a pair of data sources to use for reconciliation\n          "),r("v-list",[e._v("1. Source 1 is the source while source 2 is the target")])],1)],1)],1),e._v(" "),r("v-dialog",{attrs:{persistent:"",width:"530px"},model:{value:e.shareDialog,callback:function(t){e.shareDialog=t},expression:"shareDialog"}},[r("v-card",{attrs:{width:"530px"}},[r("v-toolbar",{attrs:{color:"primary",dark:""}},[r("v-toolbar-title",[e._v("\n            Sharing "),e.sharePair.hasOwnProperty("source1")?[e._v(e._s(e.sharePair.source1.name)+" - "+e._s(e.sharePair.source2.name))]:e._e()],2),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.shareDialog=!1}}},[r("v-icon",[e._v("close")])],1)],1),e._v(" "),r("v-card-text",[r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchUsers,callback:function(t){e.searchUsers=t},expression:"searchUsers"}}),e._v(" "),r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.usersHeader,items:e.users,search:e.searchUsers},scopedSlots:e._u([{key:"items",fn:function(t){return[t.item.userName!==e.$store.state.auth.username?r("tr",[r("td",[r("v-checkbox",{attrs:{value:t.item._id},model:{value:e.sharedUsers,callback:function(t){e.sharedUsers=t},expression:"sharedUsers"}})],1),r("td",[e._v(e._s(t.item.userName))]),e._v(" "),r("td",[e._v(e._s(t.item.firstName))]),e._v(" "),r("td",[e._v(e._s(t.item.surname))])]):e._e()]}}])})],1),e._v(" "),r("v-card-actions",{staticStyle:{float:"center"}},[r("v-btn",{staticStyle:{color:"white"},attrs:{color:"error"},nativeOn:{click:function(t){e.shareDialog=!1}}},[r("v-icon",{attrs:{dark:"",left:""}},[e._v("cancel")]),e._v("Cancel\n          ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"primary",dark:""},nativeOn:{click:function(t){return e.share("","saveShare")}}},[r("v-icon",{attrs:{left:""}},[e._v("share")]),e._v("Share\n          ")],1)],1)],1)],1),e._v(" "),r("v-layout",{attrs:{row:""}},[r("v-flex",{attrs:{xs11:""}},[e._v("\n        Create/Choose a pair of data sources to use for reconciliation. Source 1 is the source while source 2 is the target\n      ")]),e._v(" "),r("v-flex",{attrs:{xs1:"","text-xs-right":""}},[r("v-tooltip",{attrs:{top:""}},[r("v-btn",{attrs:{slot:"activator",flat:"",icon:"",color:"primary"},on:{click:function(t){e.helpDialog=!0}},slot:"activator"},[r("v-icon",[e._v("help")])],1),e._v(" "),r("span",[e._v("Help")])],1)],1)],1),e._v(" "),r("v-layout",{attrs:{column:""}},[r("v-flex",[r("v-card",{staticStyle:{width:"1000px"},attrs:{color:"cyan lighten-5"}},[r("v-card-title",{attrs:{"primary-title":""}},[r("v-toolbar",{staticStyle:{"font-weight":"bold","font-size":"18px"},attrs:{color:"white lighten-2"}},[e._v("\n              Choose Data Source Pair\n            ")])],1),e._v(" "),r("v-card-text",{staticStyle:{float:"center"}},[r("v-layout",{staticStyle:{float:"center"},attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs6:""}},[r("v-data-table",{attrs:{headers:e.source1Headers,items:e.$store.state.dataSources,loading:e.$store.state.loadingServers,dark:""},scopedSlots:e._u([{key:"items",fn:function(t){return[r("v-radio-group",{staticStyle:{height:"5px"},model:{value:e.source1,callback:function(t){e.source1=t},expression:"source1"}},[r("td",[r("v-radio",{attrs:{value:t.item,color:"blue"}})],1)]),e._v(" "),r("td",[e._v(e._s(t.item.name))])]}}])},[r("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"})],1)],1),e._v(" "),r("v-flex",{attrs:{xs6:""}},[r("v-data-table",{attrs:{headers:e.source2Headers,items:e.dataSources2,"item-key":"id",loading:e.$store.state.loadingServers},scopedSlots:e._u([{key:"items",fn:function(t){return[r("v-radio-group",{staticStyle:{height:"5px"},model:{value:e.source2,callback:function(t){e.source2=t},expression:"source2"}},[r("td",[r("v-radio",{attrs:{value:t.item,color:"blue"}})],1)]),e._v(" "),r("td",[e._v(e._s(t.item.name))])]}}])},[r("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"})],1)],1)],1)],1),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{color:"error",round:""},on:{click:e.reset}},[r("v-icon",{attrs:{left:""}},[e._v("refresh")]),e._v(" Reset\n            ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{disabled:!e.canCreatePair,color:"primary",round:""},on:{click:e.checkLevels}},[r("v-icon",{attrs:{left:""}},[e._v("save")]),e._v(" Save\n            ")],1)],1)],1)],1),e._v(" "),r("v-flex",[r("v-card",{staticStyle:{width:"1000px"},attrs:{color:"cyan lighten-4"}},[r("v-card-title",{attrs:{"primary-title":""}},[r("v-toolbar",{staticStyle:{"font-weight":"bold","font-size":"18px"},attrs:{color:"white lighten-2"}},[e._v("\n              Existing Data Source Pairs\n              "),r("v-spacer"),e._v(" "),r("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.searchPairs,callback:function(t){e.searchPairs=t},expression:"searchPairs"}})],1)],1),e._v(" "),r("v-card-text",{staticStyle:{float:"center"}},[r("v-data-table",{attrs:{headers:e.sourcePairHeaders,items:e.$store.state.dataSourcePairs,search:e.searchPairs,loading:e.$store.state.loadingServers},scopedSlots:e._u([{key:"items",fn:function(t){return[r("td",[e._v(e._s(t.item.source1.name)+" - "+e._s(t.item.source2.name))]),e._v(" "),r("td",[e._v(e._s(t.item.userID.userName))]),e._v(" "),r("v-radio-group",{staticStyle:{height:"5px"},model:{value:e.activeDataSourcePair,callback:function(t){e.activeDataSourcePair=t},expression:"activeDataSourcePair"}},[r("td",[r("v-radio",{attrs:{value:t.item,color:"blue"}})],1)]),e._v(" "),r("td",[e._v("\n                  "+e._s(e._f("mergeUsers")(t.item.shared.users))+"\n                ")]),e._v(" "),t.item.userID._id===e.$store.state.auth.userID?r("td",[r("v-btn",{attrs:{flat:"",color:"primary"},on:{click:function(r){return e.share(t.item,"showDialog")}}},[r("v-icon",[e._v("share")]),e._v("Share\n                  ")],1)],1):e._e()]}}])},[r("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"})],1)],1),e._v(" "),r("v-card-actions",[r("v-btn",{attrs:{disabled:!e.canDeletePair,color:"error",round:""},on:{click:e.confirmDeletePair}},[r("v-icon",{attrs:{left:""}},[e._v("delete")]),e._v("Delete Pair\n            ")],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-btn",{attrs:{color:"primary",round:""},on:{click:e.activatePair}},[r("v-icon",{attrs:{left:""}},[e._v("save")]),e._v("Activate Pair\n            ")],1)],1)],1)],1)],1)],1)],1)},staticRenderFns:[]},Re=r("VU/8")(Ne,Me,!1,null,null,null).exports,Oe={mixins:[p],methods:{getDHIS2UserData:function(e){var t=this,r=this.$store.state.dhis.dev.auth;""===r.username&&(r=""),h.a.get(this.$store.state.dhis.host+"api/me",{auth:r}).then(function(a){var s=a.data.organisationUnits;s.length>0&&(t.$store.state.dhis.user.orgId=s.shift().id,h.a.get(t.$store.state.dhis.host+"api/organisationUnits/"+t.$store.state.dhis.user.orgId,{auth:r}).then(function(r){return t.$store.state.dhis.user.orgName=r.data.displayName,e(a)}))}).catch(function(e){t.$store.state.dialogError=!0,t.$store.state.errorTitle="Error",e.response&&e.response.data&&401===e.response.data.httpStatusCode?(t.$store.state.errorDescription="Unauthorized, ensure that your DHIS2 login is active",t.$router.push({name:"Logout"})):t.$store.state.errorDescription="Unauthorized, please reload the app"})}},created:function(){var e=this;this.setDHIS2Credentials(),this.getRoles(),this.getDHIS2UserData(function(t){var r=void 0,a=void 0;if(t.data.userCredentials.userRoles.find(function(t){return t.id===e.$store.state.config.generalConfig.externalAuth.adminRole})){var s=e.roles.find(function(e){return"Admin"===e.text});r=s.value,a=s.text}else{var o=e.roles.find(function(e){return"Data Manager"===e.text});r=o.value,a=o.text}h.a.get("/getUser/"+t.data.userCredentials.username).then(function(s){if(s.data.userID)e.$store.state.auth.username=t.data.userCredentials.username,e.$store.state.auth.userID=s.data.userID,e.$store.state.auth.role=a,e.$store.state.initializingApp=!0,e.$store.state.denyAccess=!1,tt.$emit("getConfig");else{var o=new FormData;o.append("firstName",t.data.firstName),o.append("otherName",""),o.append("password",t.data.surname),o.append("userName",t.data.userCredentials.username),o.append("surname",t.data.surname),o.append("role",r),h.a.post("/addUser",o,{headers:{"Content-Type":"multipart/form-data"}}).then(function(r){h.a.get("/getUser/"+t.data.userCredentials.username).then(function(r){r.data.userID&&(e.$store.state.auth.username=t.data.userCredentials.username,e.$store.state.auth.userID=r.data.userID,e.$store.state.auth.role=r.data.role,e.$store.state.initializingApp=!0,e.$store.state.denyAccess=!1,tt.$emit("getConfig"))})})}})})}},Ue={render:function(){var e=this.$createElement;return(this._self._c||e)("div")},staticRenderFns:[]},Fe=r("VU/8")(Oe,Ue,!1,null,null,null).exports,Ee=r("//Fk"),qe=r.n(Ee),He=r("NYxO");o.default.use(He.a);var Ve=new He.a.Store({state:{auth:{username:"",userID:"",role:"",token:""},levelMapping:{source1:{},source2:{}},config:{userConfig:{reconciliation:{useCSVHeader:!0}},generalConfig:{reconciliation:{parentConstraint:{enabled:!0,idAutoMatch:!0,nameAutoMatch:!1},singlePair:!1,singleDataSource:!1,fixSource2To:null,fixSource2:!1},recoProgressNotification:{enabled:!1},selfRegistration:!1,datasetsAdditionWays:["CSV Upload","Remote Servers Sync"],datasetsAutosyncTime:"*/15 * * * *",authDisabled:!1,authMethod:"dhis2",externalAuth:{pullOrgUnits:!0,shareOrgUnits:!0,shareByOrgId:!0,datasetName:null,adminRole:null}}},signupFields:{},customSignupFields:{},recoStatus:{status:"in-progress"},recalculateScores:!1,dialogError:!1,errorTitle:"",errorDescription:"",errorColor:"primary",clientId:null,denyAccess:!0,source2Hierarchy:"",source1Hierarchy:"",uploadRunning:!1,dhis:{user:{orgId:"",orgName:""},host:"",dev:{auth:{username:"",password:""}}},dataSourcePairs:[],activePair:{source1:{},source2:{}},source1TotalAllRecords:0,source2TotalAllRecords:0,totalAllMapped:0,totalAllFlagged:0,totalAllNoMatch:0,totalAllIgnore:0,source1TotalAllNotMapped:0,source2TotalRecords:0,recoLevel:2,totalSource1Levels:"",totalSource2Levels:"",matchedContent:[],noMatchContent:[],ignoreContent:[],flagged:[],source1Parents:[],source2UnMatched:[],source1UnMatched:[],scoreResults:[],levelArray:[],scoresProgressData:{},uploadProgressData:{},dataSources:[],remoteDataSources:["DHIS2","FHIR"],loadingServers:!1,dynamicProgress:!1,initializingApp:!1}});h.a.interceptors.request.use(function(e){var t=Ve.state.auth.token;return t&&(e.headers.Authorization="Bearer "+t),e},function(e){return qe.a.reject(e)}),h.a.interceptors.response.use(function(e){return e},function(e){return 401===e.response.status&&(Ve.state.auth.token="",$.a.remove("token"),We.push("login")),qe.a.reject(e)}),o.default.use(b.a);var Ge=new b.a({routes:[{path:"/",name:"FacilityReconHome",component:le},{path:"/addUser",name:"AddUser",component:Y},{path:"/UsersList",name:"UsersList",component:B},{path:"/ChangePassword",name:"ChangePassword",component:X},{path:"/login",name:"Login",component:C},{path:"dhis2Auth",name:"DHIS2Auth",component:Fe},{path:"/Signup",name:"Signup",component:T},{path:"/Configure",name:"Configure",component:E},{path:"/logout",name:"Logout",component:V},{path:"/ViewDataSources",name:"ViewDataSources",component:Ae},{path:"/AddDataSources",name:"AddDataSources",component:Ie},{path:"/dataSourcesPair",name:"DataSourcesPair",component:Re},{path:"/view",name:"FacilityReconView",component:ae},{path:"/scores",name:"FacilityReconScores",component:le},{path:"/recoStatus",name:"FacilityRecoStatus",component:ve},{path:"/dbAdmin",name:"FacilityReconDbAdmin",component:ge}]});Ge.beforeEach(function(e,t,r){if(Ve.state.auth.token||$.a.get("token")&&"null"!==$.a.get("token")&&$.a.get("userID")&&"null"!==$.a.get("userID"))r();else{if("/Login"===e.path||"/Signup"===e.path||Ve.state.config.generalConfig.authDisabled)return r();r({path:"/Login"})}});var We=Ge,Be=r("3EgV"),ze=r.n(Be),je=r("ESwS"),Ye=r.n(je),Ke=(r("7zck"),r("J/Fn")),Je=r.n(Ke),Xe=r("TXmL");o.default.use(Xe.a);var Ze,Qe,et=new Xe.a({locale:Object({NODE_ENV:"production",BACKEND_SERVER:""}).VUE_APP_I18N_LOCALE||"en",fallbackLocale:Object({NODE_ENV:"production",BACKEND_SERVER:""}).VUE_APP_I18N_FALLBACK_LOCALE||"en",messages:(Ze=r("hFeb"),Qe={},Ze.keys().forEach(function(e){var t=e.match(/([A-Za-z0-9-_]+)\./i);if(t&&t.length>1){var r=t[1];Qe[r]=Ze(e)}}),Qe)});r.d(t,"eventBus",function(){return tt}),o.default.use(Ye.a),o.default.use(ze.a,{theme:{primary:"#3F51B5",secondary:"#7986CB",accent:"#9c27b0",error:"#f44336",warning:"#ffeb3b",info:"#2196f3",success:"#4caf50"}}),o.default.config.productionTip=!1;var tt=new o.default;function rt(e){var t=location.href.split("api").shift();h.a.post(t+"api/dataStore/GOFR/config",e)}!function(e){if(!(location.href.split("api").length>=2))return e(!1);var t=location.href.split("api").shift();h.a.get(t+"api/dataStore/GOFR/config").then(function(t){e(t.data),t.data.BACKEND_SERVER||rt({BACKEND_SERVER:Je.a.BACKEND_SERVER})}).catch(function(t){return console.log(s()(t)),rt({BACKEND_SERVER:Je.a.BACKEND_SERVER}),e(!1)})}(function(e){e&&e.BACKEND_SERVER?h.a.defaults.baseURL=e.BACKEND_SERVER:("."===Je.a.BACKEND_HOST&&(Je.a.BACKEND_HOST=window.location.hostname,Je.a.BACKEND_PROTOCOL=window.location.protocol.replace(":","")),h.a.defaults.baseURL=Je.a.BACKEND_PROTOCOL+"://"+Je.a.BACKEND_HOST+":"+Je.a.BACKEND_PORT);var t=s()(Ve.state.config.generalConfig);h.a.get("/getGeneralConfig?defaultGenerConfig="+t).then(function(e){e||(e.data={}),new o.default({el:"#app",router:We,store:Ve,components:{App:y},data:function(){return{config:e.data}},i18n:et,template:'<App :generalConfig="config" />'})})})},NuBg:function(e,t){e.exports={App:{title:"Facility Reconciliation",initApp:"Initializing App",source:"Source",menu:{createPair:{msg:"Create and Manage Data Source Pair",tooltip:"Select data sources to start mathing"},reconcile:{msg:"Reconcile",tooltip:"Perform location matching of your selected data sources"},recoStatus:{msg:"Reconciliation Status",tooltip:"Matching Status"},archive:{msg:"Archived Uploads",tooltip:"Access to backup data"},account:{msg:"Account"},addUser:{msg:"Add User",tooltip:"Create new user account"},usersList:{msg:"Users List",tooltip:"Enable and Disable user accounts"},changePassword:{msg:"Change Password"},logout:{msg:"Logout"},configure:{msg:"configure System"},dataSourcesParent:{msg:"Data Sources",tooltip:"Upload CSV data and add remote DHIS2 or FHIR servers"},viewDataSources:{msg:"View Data Sources"},addDataSources:{msg:"Add Data Sources"},view:{msg:"View",tooltip:"Explore data sources contents"},recoParent:{msg:"Reconcile"}}}}},VPxq:function(e,t){},hFeb:function(e,t,r){var a={"./en.json":"NuBg","./fr.json":"oBab"};function s(e){return r(o(e))}function o(e){var t=a[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}s.keys=function(){return Object.keys(a)},s.resolve=o,e.exports=s,s.id="hFeb"},mNhd:function(e,t){},oBab:function(e,t){e.exports={App:{title:"Facility Reconciliation",initApp:"Initialisation de l'App",source:"la source",menu:{createPair:{msg:"Créer et gérer une paire de sources de données",tooltip:"Select data sources to start mathing"},reconcile:{msg:"Réconcilier",tooltip:"Effectuer une correspondance d'emplacement de vos sources de données sélectionnées"},recoStatus:{msg:"État de rapprochement",tooltip:"Statut de correspondance"},archive:{msg:"Téléchargements archivés",tooltip:"Accès aux données de sauvegarde"},account:{msg:"Account"},addUser:{msg:"Add User",tooltip:"Create new user account"},usersList:{msg:"Users List",tooltip:"Enable and Disable user accounts"},changePassword:{msg:"Change Password"},logout:{msg:"Connectez - Out"},configure:{msg:"configurer le système"},dataSourcesParent:{msg:"Les sources de données",tooltip:"Télécharger des données CSV et ajouter des serveurs DHIS2 ou FHIR distants"},viewDataSources:{msg:"Afficher les sources de données"},addDataSources:{msg:"Ajouter des sources de données"},view:{msg:"Vue",tooltip:"Explorer le contenu des sources de données"},recoParent:{msg:"Réconcilier"}}}}},wxqd:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEMAAAAbCAYAAAAnFzLpAAAGGklEQVRYR+1YaVCTVxQ9BBLWEBYRGhAjFPetVRRoQVnFZRQtYq1Tl6kzij/q2k7dZtTSxW3sVGeqVtHOuLXQYnFBFscNFwqIYikKRRkpq2GRGJCEJJ37RV6SJhBQ63Qs59/7ct9795137vJi4bNktwa94Biw6CVDp4ReMvSiopeMXjJMJ8leZTyPMoQ2AhxePoNNzbx9H3vP5bPxByHD8V7gEDb++MA5VNbLelSnlkaPgf+bYtyrrMfe9Hw0t7T1aP6LGndbGc72NsjbuZjt92N2EdYducDGa2ICER89ho2jNh1FWU1jt/0LGOiJo6tmMvsvk7NxMOtWt+ebMrQSCOAt8YWnxAcOIhFsbe2gULShqaEeTVIp7v1+G0qFjvD/DBmerkJcTJgPnoUFd66l350Fqe954SXxwdtBwbC2sel0CfkTGa5lZaCpQdqzPuPfVgZ5493HEWO4MJHijwqtg88De6EQkTFx4POt2HSNRoMnzY9hLxSBx9MSTmh72obUYz8A0Jhuuuhy+rs5QWRnzcXvU2U7BFaWKN4T3+0wCV57GFWNT7ib9vVwhoOtAA8fPUa9rNXk+cjO3oavc1LZDkW72sjWVmAFD2cHuDnaQdGuwqPmFtQ2ytGuNrR18xAjZNJUtLbIUZh3AzUVFWhvV4LPFyAwLBLunl5s7Utpp1FXXWlMBsX9ssljYWetdUyl1iCnpBKrEjNwZuNcuAptue/mcsa4Tw6C8siMcYNgzbdkG9/9S4otP13h1tSHv58YJ1bPYp8SkrJx6LwuZ0j6irByegCiRvtwF6MPeZsSV4oeYn/GTdwur2U/iVxcIWtqglqtMrAXe0vwTsQk9u1WznWUFhUakrF1QThi9SqC/gq1TXLwrSzh4qCNQXNkFJbXYaSkr0kV0I1OSzhhkGC7IoMuIHX9+/Bwsu80ajQaYMrnx1BS1WA2siR+A+EfHMrsLpxNhbSmWkfGiP59cXJtHDMg2R2/XISymgYM8eqD2KChsNSLNXNk0EJ0S2fySiGys0Hcu0M5aXfgdF4plh9IZ+OuyKALoovqwL70m0i7+SccbARcCIaPHIBWhRLL9qWZJYJnyUPE9FiInJ052xa5HGnJx6FWqXRk7FwUiZjxg9hiaw5nIeXGXTaODRqCrfN1DpkjI7+sGnN3/sKFGYGcztg0j61HZZfKbwe6ImNR2ChsiAtmtt9nFmBHynWjPGGWCVhg/IRQePv6aU01wKX006ir0oYsK60pn8UxWVOSC/g0EWrS3jNY8Xi48+0SFq/myFh9KBMnc+4Z+Hf5iwWgEkqQPVVg9Ir93SKDVEv+Pau63BxpcwuSrhXjyMVC1DTJzfJgYUFEhKOfjy+zvZP3G+4WFrAxIyN3x2KWD0jes75OMtpA/zDmyIjb/jNIHfo4sjIGgYO0WbwnZJD9/NCR2DA72CBU6btSpcap3BJ8cyqn046Xx+MhYGIEPCUDtILQaJB/9TIelOiUb6AM6i6plyAU3K9B7LZkIzLOb/kQlNUJ5siI3nwMpdWGyexFyKA9vVwdsTjyLVDIUonVR1WDDLO3JRuphM/nIzA8Gu5iMWeuUqlw40IWqh6WG52PKSN1/RwM6+fGGVDtpjDRByXPot3x4FvyukWGqXb8Rcno8EdoK+CqXvzksazU02+7UnOw52wuc9va1g4hUVPg5OrKfWtrbUV25jk0SOuMiDBQxq6PojDdfyAzWnEwHadyS9l4ZsBg7FgYwcbmlPEyyXC0szb5aHN3skf2VwtZC085inIVwcHRESGTpoG6UQK9R65mpnHVozMwZQz3dsOv6+YwOyqtSVeL8aC2EX5vuCAmYDBTRXfC5GWSsXpGALd/RkEZiiukqGzQvoYnDu/PhU0HtqVcA5VdepSFTY0xeJfIZTIolYpOicg8mWzYdCXMC8Xc4GEmJ+SVVUPsIoTY2eGVhwmRQV1xVyive4y47clcu0+JMigsqkv7f/6YlLjPuB2nmq4fi7JWBahB2nziEuZNGIGNz+r9qwyT0BESjoxREnejakKHp34o8fwtUJdMeGlk9IjO18y42/9nvGbn7rqa/B8Oa+6MvcrQY+hvaNExIn99uskAAAAASUVORK5CYII="}},["NHnr"]);
//# sourceMappingURL=app.8049fa39c176a9c3c906.js.map